!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("postRobot",[],n):"object"==typeof exports?exports.postRobot=n():e.postRobot=n()}(this,function(){return function(e){function n(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var r={};return n.m=e,n.c=r,n.i=function(e){return e},n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:t})},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=39)}([function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(29);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})});var o=r(13);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,n,r){"use strict";function t(e,n){D.domainMatches=D.domainMatches||new R.WeakMap,D.domainMatches.set(e,n),k||(k=setTimeout(function(){D.domainMatches=new R.WeakMap,k=null},1))}function o(e){var n=e.location;if(!n)throw new Error("Can not read window location");var r=n.protocol;if(!r)throw new Error("Can not read window protocol");if(r===I.FILE_PROTOCOL)return"file://";var t=n.host;if(!t)throw new Error("Can not read window host");return r+"//"+t}function i(e){e=e||window;var n=o(e);return n&&e.mockDomain&&0===e.mockDomain.indexOf(I.MOCK_PROTOCOL)?e.mockDomain:n}function a(e){if(D.domainMatches.has(e)){var n=D.domainMatches.get(e);if(n)return!0}var r=!1;try{o(e)===o(window)&&(r=!0)}catch(e){}return r||t(e,r),r}function s(e){if(D.domainMatches.has(e))return D.domainMatches.get(e);var n=!1;try{i(window)===i(e)&&(n=!0)}catch(e){}return t(e,n),n}function u(e){if(e)try{if(e.parent&&e.parent!==e)return e.parent}catch(e){return}}function c(e){if(e&&!u(e))try{return e.opener}catch(e){return}}function d(e){var n=[];try{for(;e.parent!==e;)n.push(e.parent),e=e.parent}catch(e){}return n}function f(e,n){if(!e||!n)return!1;var r=u(n);return r?r===e:d(n).indexOf(e)!==-1}function l(e){var n=[],r=void 0;try{r=e.frames}catch(n){r=e}var t=void 0;try{t=r.length}catch(e){}if(0===t)return n;if(t){for(var o=0;o<t;o++){var i=void 0;try{i=r[o]}catch(e){continue}n.push(i)}return n}for(var a=0;a<100;a++){var s=void 0;try{s=r[a]}catch(e){return n}if(!s)return n;n.push(s)}return n}function w(e){for(var n=[],r=l(e),t=Array.isArray(r),o=0,r=t?r:r[Symbol.iterator]();;){var i;if(t){if(o>=r.length)break;i=r[o++]}else{if(o=r.next(),o.done)break;i=o.value}var a=i;n.push(a);for(var s=w(a),u=Array.isArray(s),c=0,s=u?s:s[Symbol.iterator]();;){var d;if(u){if(c>=s.length)break;d=s[c++]}else{if(c=s.next(),c.done)break;d=c.value}var f=d;n.push(f)}}return n}function p(e){var n=w(e);n.push(e);for(var r=d(e),t=Array.isArray(r),o=0,r=t?r:r[Symbol.iterator]();;){var i;if(t){if(o>=r.length)break;i=r[o++]}else{if(o=r.next(),o.done)break;i=o.value}var a=i;n.push(a);for(var s=l(a),u=Array.isArray(s),c=0,s=u?s:s[Symbol.iterator]();;){var f;if(u){if(c>=s.length)break;f=s[c++]}else{if(c=s.next(),c.done)break;f=c.value}var p=f;n.indexOf(p)===-1&&n.push(p)}}return n}function m(e){if(e){try{if(e.top)return e.top}catch(e){}if(u(e)===e)return e;try{if(f(window,e))return window.top}catch(e){}try{if(f(e,window))return window.top}catch(e){}for(var n=w(e),r=Array.isArray(n),t=0,n=r?n:n[Symbol.iterator]();;){var o;if(r){if(t>=n.length)break;o=n[t++]}else{if(t=n.next(),t.done)break;o=t.value}var i=o;try{if(i.top)return i.top}catch(e){}if(u(i)===i)return i}}}function g(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{if(e===window)return!1}catch(e){return!0}try{if(!e)return!0}catch(e){return!0}try{if(e.closed)return!0}catch(e){return!e||"Call was rejected by callee.\r\n"!==e.message}if(n&&s(e))try{if(e.mockclosed)return!0}catch(e){}try{if(!e.parent||!e.top)return!0}catch(e){}return!1}function h(e){return e=e||window,e.navigator.mockUserAgent||e.navigator.userAgent}function v(e,n){for(var r=l(e),t=r,o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var u=a;try{if(s(u)&&u.name===n&&r.indexOf(u)!==-1)return u}catch(e){}}try{if(r.indexOf(e.frames[n])!==-1)return e.frames[n]}catch(e){}try{if(r.indexOf(e[n])!==-1)return e[n]}catch(e){}}function y(e,n){var r=v(e,n);if(r)return r;for(var t=l(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var s=a,u=y(s,n);if(u)return u}}function O(e,n){var r=void 0;return r=v(e,n),r?r:y(m(e),n)}function S(e,n){var r=u(n);if(r)return r===e;for(var t=l(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var s=a;if(s===n)return!0}return!1}function b(e,n){return e===c(n)}function E(e){e=e||window;var n=c(e);if(n)return n;var r=u(e);return r?r:void 0}function _(e){for(var n=[],r=e;r;)r=E(r),r&&n.push(r);return n}function T(e,n){var r=E(n);if(r)return r===e;if(n===e)return!1;if(m(n)===n)return!1;for(var t=l(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var s=a;if(s===n)return!0}return!1}function A(){return Boolean(c(window))}function P(){return Boolean(u(window))}function N(){return Boolean(!P()&&!A())}function M(e,n){for(var r=e,t=Array.isArray(r),o=0,r=t?r:r[Symbol.iterator]();;){var i;if(t){if(o>=r.length)break;i=r[o++]}else{if(o=r.next(),o.done)break;i=o.value}for(var a=i,s=n,u=Array.isArray(s),c=0,s=u?s:s[Symbol.iterator]();;){var d;if(u){if(c>=s.length)break;d=s[c++]}else{if(c=s.next(),c.done)break;d=c.value}var f=d;if(a===f)return!0}}}function C(e,n){var r=m(e),t=m(n);try{if(r&&t)return r===t}catch(e){}var o=p(e),i=p(n);if(M(o,i))return!0;var a=c(r),s=c(t);return(!a||!M(p(a),i))&&((!s||!M(p(s),o))&&void 0)}function W(e,n){return"string"==typeof e?!(0,j.isRegex)(n)&&(!Array.isArray(n)&&(e===I.WILDCARD||n===e)):(0,j.isRegex)(e)?(0,j.isRegex)(n)?e.toString()===n.toString():!Array.isArray(n)&&n.match(e):!!Array.isArray(e)&&(!(0,j.isRegex)(n)&&(Array.isArray(n)?JSON.stringify(e)===JSON.stringify(n):e.indexOf(n)!==-1))}Object.defineProperty(n,"__esModule",{value:!0}),n.getActualDomain=o,n.getDomain=i,n.isActuallySameDomain=a,n.isSameDomain=s,n.getParent=u,n.getOpener=c,n.getParents=d,n.isAncestorParent=f,n.getFrames=l,n.getAllChildFrames=w,n.getAllFramesInWindow=p,n.getTop=m,n.isWindowClosed=g,n.getUserAgent=h,n.getFrameByName=v,n.findChildFrameByName=y,n.findFrameByName=O,n.isParent=S,n.isOpener=b,n.getAncestor=E,n.getAncestors=_,n.isAncestor=T,n.isPopup=A,n.isIframe=P,n.isFullpage=N,n.isSameTopWindow=C,n.matchDomain=W;var R=r(4),j=r(22),D=window.__crossDomainUtils__=window.__crossDomainUtils__||{};D.domainMatches=D.domainMatches||new R.WeakMap;var k=void 0,I={MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",WILDCARD:"*"}},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(16);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})});var o=r(7);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(11);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(33);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(17);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[e]}})});var u=r(34);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.global=void 0;var t=r(0),o=n.global=window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT]=window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT]||{};o.registerSelf=function(){}},function(e,n,r){"use strict";function t(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n.default=e,n}Object.defineProperty(n,"__esModule",{value:!0});var o=r(18);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=t(o);n.default=i},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(30);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})});var o=r(15);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(14);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,n,r){"use strict";function t(){u.global.initialized||((0,s.listenForMessages)(),r(10).openTunnelToOpener(),(0,a.initOnReady)(),(0,a.listenForMethods)()),u.global.initialized=!0}Object.defineProperty(n,"__esModule",{value:!0}),n.Promise=n.cleanUpWindow=void 0;var o=r(27);Object.defineProperty(n,"cleanUpWindow",{enumerable:!0,get:function(){return o.cleanUpWindow}}),n.init=t;var i=r(37);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(2);Object.defineProperty(n,"Promise",{enumerable:!0,get:function(){return a.Promise}});var s=r(5),u=r(3);t()},function(e,n,r){"use strict";function t(e){if(!e)return e;var n=!1;return function(){if(!n)return n=!0,e.apply(this,arguments)}}function o(){}function i(e,n){try{return!!e[n]}catch(e){return!1}}function a(e,n){try{return e[n]}catch(e){return}}function s(e,n,r){return e.addEventListener?e.addEventListener(n,r):e.attachEvent("on"+n,r),{cancel:function(){e.removeEventListener?e.removeEventListener(n,r):e.detachEvent("on"+n,r)}}}function u(e,n,r){return"function"==typeof e.apply?e.apply(n,r):e(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9])}function c(e,n,r){if(!e)return r;for(var t=0;t<e.length;t++)if(n(e[t]))return e[t];return r}function d(e,n){for(var r=[],t=0;t<e.length;t++)r.push(n(e[t]));return r}function f(e,n){n=n||Boolean;for(var r=0;r<e.length;r++)if(n(e[r]))return!0;return!1}function l(e){var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(r);return n}function w(e){var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(e[r]);return n}function p(e,n){for(var r in e)if(e.hasOwnProperty(r)&&e[r]===n)return r}function m(){var e="0123456789abcdef";return"xxxxxxxxxx".replace(/./g,function(){return e.charAt(Math.floor(Math.random()*e.length))})}function g(e){var n={};return function(){var r=JSON.stringify(Array.prototype.slice.call(arguments));return n.hasOwnProperty(r)||(n[r]=e.apply(this,arguments)),n[r]}}function h(e,n){if(!n)return e;for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);return e}function v(e,n){if(Array.isArray(e))for(var r=0;r<e.length;r++)n(e[r],r);else if("object"===("undefined"==typeof e?"undefined":M(e))&&null!==e)for(var t in e)e.hasOwnProperty(t)&&n(e[t],t)}function y(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(r>=100)throw new Error("Self-referential object passed, or object contained too many layers");var t=Array.isArray(e)?[]:{};return v(e,function(e,o){var i=n(e,o);void 0!==i?t[o]=i:"object"===("undefined"==typeof e?"undefined":M(e))&&null!==e?t[o]=y(e,n,r+1):t[o]=e}),t}function O(e,n){function r(){t=setTimeout(r,n),e.call()}var t=void 0;return t=setTimeout(r,n),{cancel:function(){clearTimeout(t)}}}function S(e,n,r){var t=O(function(){e-=n,e=e<=0?0:e,0===e&&t.cancel(),r(e)},n);return O}function b(e){var n=void 0;return e.match(/^(https?|mock|file):\/\//)?(n=e,n=n.split("/").slice(0,3).join("/")):(0,W.getDomain)()}function E(e,n){var r=void 0;try{r=e[n]}catch(e){}return r}function _(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function T(e){var n=new C.WeakMap;return function(r){var t=n.get(r);return"undefined"!=typeof t?t:(t=e.call(this,r),"undefined"!=typeof t&&n.set(r,t),t)}}function A(){return(0,W.isPopup)()?R.CONSTANTS.WINDOW_TYPES.POPUP:(0,W.isIframe)()?R.CONSTANTS.WINDOW_TYPES.IFRAME:R.CONSTANTS.WINDOW_TYPES.FULLPAGE}function P(){var e=void 0,n=void 0;try{if("{}"!==JSON.stringify({})&&(e=Object.prototype.toJSON,delete Object.prototype.toJSON),"{}"!==JSON.stringify({}))throw new Error("Can not correctly serialize JSON objects");if("[]"!==JSON.stringify([])&&(n=Array.prototype.toJSON,delete Array.prototype.toJSON),"[]"!==JSON.stringify([]))throw new Error("Can not correctly serialize JSON objects")}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}var r=JSON.stringify.apply(this,arguments);try{e&&(Object.prototype.toJSON=e),n&&(Array.prototype.toJSON=n)}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}return r}function N(){return JSON.parse.apply(this,arguments)}Object.defineProperty(n,"__esModule",{value:!0});var M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.once=t,n.noop=o,n.safeHasProp=i,n.safeGetProp=a,n.listen=s,n.apply=u,n.find=c,n.map=d,n.some=f,n.keys=l,n.values=w,n.getByValue=p,n.uniqueID=m,n.memoize=g,n.extend=h,n.each=v,n.replaceObject=y,n.safeInterval=O,n.intervalTimeout=S,n.getDomainFromUrl=b,n.safeGet=E,n.isRegex=_,n.weakMapMemoize=T,n.getWindowType=A,n.jsonStringify=P,n.jsonParse=N;var C=r(4),W=r(1),R=r(0)},function(e,n,r){"use strict";function t(e,n,r){function t(){if(o){if(a)return r(s);if(i)return n(u)}}var o=!1,i=!1,a=!1,s=void 0,u=void 0;try{e(function(e){u=e,i=!0,t()},function(e){s=e,a=!0,t()})}catch(e){return r(e)}o=!0,t()}function o(e){d.push(e),f=f||setTimeout(i,1)}function i(){f=null;var e=d;d=[];for(var n=function(n){var r=e[n];return r.silentReject?"continue":(r.handlers.push({onError:function(e){r.silentReject||a(e)}}),void r.dispatch())},r=0;r<e.length;r++){n(r)}}function a(e){if(l.indexOf(e)===-1){l.push(e),setTimeout(function(){throw e},1);for(var n=0;n<c.length;n++)c[n](e)}}function s(e){try{if(!e)return!1;if(window.Window&&e instanceof window.Window)return!1;if(window.constructor&&e instanceof window.constructor)return!1;if(w){var n=w.call(e);if("[object Window]"===n||"[object global]"===n||"[object DOMWindow]"===n)return!1}if(e&&e.then instanceof Function)return!0}catch(e){return!1}return!1}function u(){window.Promise=p}Object.defineProperty(n,"__esModule",{value:!0}),n.patchPromise=u;var c=[],d=[],f=void 0,l=[],w={}.toString,p=n.SyncPromise=function(e){if(this.resolved=!1,this.rejected=!1,this.silentReject=!1,this.handlers=[],o(this),e){var n=this;t(e,function(e){return n.resolve(e)},function(e){return n.reject(e)})}};p.resolve=function(e){return s(e)?e:(new p).resolve(e)},p.reject=function(e){return(new p).reject(e)},p.prototype.resolve=function(e){if(this.resolved||this.rejected)return this;if(s(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this},p.prototype.reject=function(e){if(this.resolved||this.rejected)return this;if(s(e))throw new Error("Can not reject promise with another promise");return e||(e=new Error("Expected reject to be called with Error, got "+e)),this.rejected=!0,this.value=e,this.dispatch(),this},p.prototype.asyncReject=function(e){this.silentReject=!0,this.reject(e)},p.prototype.dispatch=function(){var e=this;if(this.resolved||this.rejected)for(var n=function(){var n=e.handlers.shift(),r=!1,t=void 0,o=void 0;try{e.resolved?t=n.onSuccess?n.onSuccess(e.value):e.value:e.rejected&&(n.onError?t=n.onError(e.value):(r=!0,o=e.value))}catch(e){r=!0,o=e}if(t===e)throw new Error("Can not return a promise from the the then handler of the same promise");return n.promise?void(r?n.promise.reject(o):s(t)?t.then(function(e){n.promise.resolve(e)},function(e){n.promise.reject(e)}):n.promise.resolve(t)):"continue"};this.handlers.length;){n()}},p.prototype.then=function(e,n){if(e&&"function"!=typeof e&&!e.call)throw new Error("Promise.then expected a function for success handler");if(n&&"function"!=typeof n&&!n.call)throw new Error("Promise.then expected a function for error handler");var r=new p(null,this);return this.handlers.push({promise:r,onSuccess:e,onError:n}),this.silentReject=!0,this.dispatch(),r},p.prototype.catch=function(e){return this.then(null,e)},p.prototype.finally=function(e){return this.then(function(n){return p.try(e).then(function(){return n})},function(n){return p.try(e).then(function(){throw n})})},p.all=function(e){for(var n=new p,r=e.length,t=[],o=function(o){var i=s(e[o])?e[o]:p.resolve(e[o]);i.then(function(e){t[o]=e,r-=1,0===r&&n.resolve(t)},function(e){n.reject(e)})},i=0;i<e.length;i++)o(i);return r||n.resolve(t),n},p.onPossiblyUnhandledException=function(e){c.push(e)},p.try=function(e){return p.resolve().then(e)},p.delay=function(e){return new p(function(n){setTimeout(n,e)})},p.hash=function(e){var n={},r=[],t=function(t){e.hasOwnProperty(t)&&r.push(p.resolve(e[t]).then(function(e){n[t]=e}))};for(var o in e)t(o);return p.all(r).then(function(){return n})},p.promisifyCall=function(){var e=Array.prototype.slice.call(arguments),n=e.shift();if("function"!=typeof n)throw new Error("Expected promisifyCall to be called with a function");return new p(function(r,t){return e.push(function(e,n){return e?t(e):r(n)}),n.apply(null,e)})}},function(e,n,r){"use strict";function t(){return!!(0,m.getUserAgent)(window).match(/MSIE|trident|edge/i)||!g.CONFIG.ALLOW_POSTMESSAGE_POPUP}function o(e){return(!e||!(0,m.isSameTopWindow)(window,e))&&(!e||!(0,m.isSameDomain)(e))}function i(e){return!e||(0,m.getDomain)()!==(0,h.getDomainFromUrl)(e)}function a(e){var n=e.win,r=e.domain;return t()&&o(n)&&i(r)}function s(e){e=e||(0,h.getDomainFromUrl)(e);var n=e.replace(/[^a-zA-Z0-9]+/g,"_"),r=g.CONSTANTS.BRIDGE_NAME_PREFIX+"_"+n;return r}function u(){return window.name&&window.name===s((0,m.getDomain)())}function c(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.CONFIG.BRIDGE_TIMEOUT;v.global.remoteWindows.set(e,{sendMessagePromise:new h.promise.Promise})}function d(e){return v.global.remoteWindows.get(e)}function f(e,n,r){var t=d(e);if(!t)throw new Error("Window not found to register sendMessage to");var o=function(t,o,i){if(t!==e)throw new Error("Remote window does not match window");if(!(0,m.matchDomain)(i,n))throw new Error("Remote domain "+i+" does not match domain "+n);r(o)};t.sendMessagePromise.resolve(o),t.sendMessagePromise=h.promise.Promise.resolve(o)}function l(e,n){var r=d(e);if(!r)throw new Error("Window not found on which to reject sendMessage");r.sendMessagePromise.asyncReject(n)}function w(e,n,r){var t=(0,m.isOpener)(window,e),o=(0,m.isOpener)(e,window);if(!t&&!o)throw new Error("Can only send messages to and from parent and popup windows");var i=d(e);if(!i)throw new Error("Window not found to send message to");return i.sendMessagePromise.then(function(t){return t(e,n,r)})}Object.defineProperty(n,"__esModule",{value:!0}),n.documentBodyReady=void 0,n.needsBridgeForBrowser=t,n.needsBridgeForWin=o,n.needsBridgeForDomain=i,n.needsBridge=a,n.getBridgeName=s,n.isBridge=u,n.registerRemoteWindow=c,n.findRemoteWindow=d,n.registerRemoteSendMessage=f,n.rejectRemoteSendMessage=l,n.sendBridgeMessage=w;var p=r(4),m=r(1),g=r(0),h=r(2),v=r(3),y=r(5);n.documentBodyReady=new h.promise.Promise(function(e){if(window.document&&window.document.body)return e(window.document.body);var n=setInterval(function(){if(window.document&&window.document.body)return clearInterval(n),e(window.document.body)},10)});v.global.remoteWindows=v.global.remoteWindows||new p.WeakMap,v.global.receiveMessage=function(e){return(0,y.receiveMessage)(e)}},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(23);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})});var o=r(24);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(9);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(26);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.log=void 0;var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=r(7),i=r(0),a=["debug","info","warn","error"];Function.prototype.bind&&window.console&&"object"===t(console.log)&&["log","info","warn","error"].forEach(function(e){console[e]=this.bind(console[e],console)},Function.prototype.call);var s=n.log={clearLogs:function(){if(window.console&&window.console.clear&&window.console.clear(),i.CONFIG.LOG_TO_PAGE){var e=document.getElementById("postRobotLogs");e&&e.parentNode.removeChild(e)}},writeToPage:function(e,n){setTimeout(function(){var r=document.getElementById("postRobotLogs");r||(r=document.createElement("div"),r.id="postRobotLogs",r.style.cssText="width: 800px; font-family: monospace; white-space: pre-wrap;",document.body.appendChild(r));var t=document.createElement("div"),i=(new Date).toString().split(" ")[4],a=(0,o.map)(n,function(e){if("string"==typeof e)return e;if(!e)return Object.prototype.toString.call(e);var n=void 0;try{n=(0,o.jsonStringify)(e,0,2)}catch(e){n="[object]"}return"\n\n"+n+"\n\n"}).join(" "),s=i+" "+e+" "+a;t.innerHTML=s;var u={log:"#ddd",warn:"orange",error:"red",info:"blue",debug:"#aaa"}[e];t.style.cssText="margin-top: 10px; color: "+u+";",r.childNodes.length?r.insertBefore(t,r.childNodes[0]):r.appendChild(t)})},logLevel:function(e,n){setTimeout(function(){try{var r=window.LOG_LEVEL||i.CONFIG.LOG_LEVEL;if(a.indexOf(e)<a.indexOf(r))return;if(n=Array.prototype.slice.call(n),n.unshift(""+window.location.host+window.location.pathname),n.unshift("::"),n.unshift(""+(0,o.getWindowType)().toLowerCase()),n.unshift("[post-robot]"),i.CONFIG.LOG_TO_PAGE&&s.writeToPage(e,n),!window.console)return;if(window.console[e]||(e="log"),!window.console[e])return;window.console[e].apply(window.console,n)}catch(e){}},1)},debug:function(){s.logLevel("debug",arguments)},info:function(){s.logLevel("info",arguments)},warn:function(){s.logLevel("warn",arguments)},error:function(){s.logLevel("error",arguments)}}},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(28);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})})},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=n.CONSTANTS={POST_MESSAGE_TYPE:{REQUEST:"postrobot_message_request",RESPONSE:"postrobot_message_response",ACK:"postrobot_message_ack"},POST_MESSAGE_ACK:{SUCCESS:"success",ERROR:"error"},POST_MESSAGE_NAMES:{METHOD:"postrobot_method",READY:"postrobot_ready",OPEN_TUNNEL:"postrobot_open_tunnel"},WINDOW_TYPES:{FULLPAGE:"fullpage",POPUP:"popup",IFRAME:"iframe"},WINDOW_PROPS:{POSTROBOT:"__postRobot__"},SERIALIZATION_TYPES:{METHOD:"postrobot_method",ERROR:"postrobot_error"},SEND_STRATEGIES:{POST_MESSAGE:"postrobot_post_message",BRIDGE:"postrobot_bridge",GLOBAL:"postrobot_global"},MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",BRIDGE_NAME_PREFIX:"__postrobot_bridge__",POSTROBOT_PROXY:"__postrobot_proxy__",WILDCARD:"*"};n.POST_MESSAGE_NAMES_LIST=Object.keys(t.POST_MESSAGE_NAMES).map(function(e){return t.POST_MESSAGE_NAMES[e]})},function(e,n,r){"use strict";function t(){f.global.responseListeners={},f.global.requestListeners={}}function o(e,n){f.global.responseListeners[e]=n}function i(e){return f.global.responseListeners[e]}function a(e){delete f.global.responseListeners[e]}function s(e){var n=e.name,r=e.win,t=e.domain;if(r===w.CONSTANTS.WILDCARD&&(r=null),t===w.CONSTANTS.WILDCARD&&(t=null),!n)throw new Error("Name required to get request listener");var o=f.global.requestListeners[n];if(o)for(var i=[r,f.global.WINDOW_WILDCARD],a=0;a<i.length;a++){var s=i[a],u=s&&o.get(s);if(u){for(var c=[t,w.CONSTANTS.WILDCARD],l=0;l<c.length;l++){var m=c[l];if(m&&(m=m.toString(),u[m]))return u[m]}if(u[p])for(var g=u[p],h=Array.isArray(g),v=0,g=h?g:g[Symbol.iterator]();;){var y;if(h){if(v>=g.length)break;y=g[v++]}else{if(v=g.next(),v.done)break;y=v.value}var O=y,S=O.regex,b=O.listener;if((0,d.matchDomain)(S,t))return b}}}}function u(e,n){var r=e.name,t=e.win,o=e.domain;if(!r||"string"!=typeof r)throw new Error("Name required to add request listener");if(Array.isArray(t))for(var i=t,a=Array.isArray(i),d=0,i=a?i:i[Symbol.iterator]();;){var m;if(a){if(d>=i.length)break;m=i[d++]}else{if(d=i.next(),d.done)break;m=d.value}var g=m;u({name:r,domain:o,win:g},n)}else{if(!Array.isArray(o)){var h=s(e);if(t&&t!==w.CONSTANTS.WILDCARD||(t=f.global.WINDOW_WILDCARD),o=o||w.CONSTANTS.WILDCARD,h)throw t&&o?new Error("Request listener already exists for "+r+" on domain "+o+" for specified window"):t?new Error("Request listener already exists for "+r+" for specified window"):o?new Error("Request listener already exists for "+r+" on domain "+o):new Error("Request listener already exists for "+r);var v=f.global.requestListeners,y=v[r];y||(y=new c.WeakMap,v[r]=y);var O=y.get(t);O||(O={},y.set(t,O));var S=o.toString();O[S]=n;var b=O[p],E=void 0;return(0,l.isRegex)(o)&&(b||(b=[],O[p]=b),E={regex:o,listener:n},b.push(E)),{cancel:function(){delete O[S],0===Object.keys(O).length&&y.delete(t),E&&b.splice(b.indexOf(E,1))}}}for(var _=o,T=Array.isArray(_),A=0,_=T?_:_[Symbol.iterator]();;){var P;if(T){if(A>=_.length)break;P=_[A++]}else{if(A=_.next(),A.done)break;P=A.value}var N=P;u({name:r,win:t,domain:N},n)}}}Object.defineProperty(n,"__esModule",{value:!0}),n.resetListeners=t,n.addResponseListener=o,n.getResponseListener=i,n.deleteResponseListener=a,n.getRequestListener=s,n.addRequestListener=u;var c=r(4),d=r(1),f=r(3),l=r(2),w=r(0);f.global.responseListeners=f.global.responseListeners||{},f.global.requestListeners=f.global.requestListeners||{},f.global.WINDOW_WILDCARD=f.global.WINDOW_WILDCARD||new function(){};var p="__domain_regex__"},function(e,n,r){"use strict";function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=(0,c.uniqueID)(),o=(0,c.getWindowType)(),i=(0,s.getDomain)(window);return a({},n,r,{sourceDomain:i,id:n.id||t,windowType:o})}function i(e,n,r){return c.promise.run(function(){n=o(e,n,{data:(0,c.serializeMethods)(e,r,n.data),domain:r});var i=void 0;if(i=u.POST_MESSAGE_NAMES_LIST.indexOf(n.name)!==-1||n.type===u.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===n.ack?"error":"info",c.log.logLevel(i,["\n\n\t","#send",n.type.replace(/^postrobot_message_/,""),"::",n.name,"::",r||u.CONSTANTS.WILDCARD,"\n\n",n]),u.CONFIG.MOCK_MODE)return delete n.target,window[u.CONSTANTS.WINDOW_PROPS.POSTROBOT].postMessage({origin:(0,s.getDomain)(window),source:window,data:(0,c.jsonStringify)(n,0,2)});if(e===window)throw new Error("Attemping to send message to self");if((0,s.isWindowClosed)(e))throw new Error("Window is closed");c.log.debug("Running send message strategies",n);var a=[],f=(0,c.jsonStringify)(t({},u.CONSTANTS.WINDOW_PROPS.POSTROBOT,n),0,2);return c.promise.map(Object.keys(d.SEND_MESSAGE_STRATEGIES),function(n){return c.promise.run(function(){if(!u.CONFIG.ALLOWED_POST_MESSAGE_METHODS[n])throw new Error("Strategy disallowed: "+n);return d.SEND_MESSAGE_STRATEGIES[n](e,f,r)}).then(function(){return a.push(n+": success"),!0},function(e){return a.push(n+": "+(e.stack||e.toString())+"\n"),!1})}).then(function(e){var r=(0,c.some)(e),t=n.type+" "+n.name+" "+(r?"success":"error")+":\n  - "+a.join("\n  - ")+"\n";if(c.log.debug(t),!r)throw new Error(t)})})}Object.defineProperty(n,"__esModule",{value:!0});var a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e};n.buildMessage=o,n.sendMessage=i;var s=r(1),u=r(0),c=r(2),d=r(32)},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.promise=n.Promise=void 0;var t=r(8),o=r(17),i=n.Promise=t.SyncPromise,a=n.promise={Promise:i,run:function(e){return i.resolve().then(e)},nextTick:function(e){return new i(function(n,r){(0,o.nextTick)(function(){return a.run(e).then(n,r)})})},method:function(e){return function(){var n=this,r=arguments;return i.resolve().then(function(){return e.apply(n,r)})}},nodeify:function(e,n){return n?void e.then(function(e){n(null,e)},function(e){n(e)}):e},map:function(e,n){for(var r=[],t=function(t){r.push(a.run(function(){return n(e[t])}))},o=0;o<e.length;o++)t(o);return i.all(r)}}},function(e,n,r){"use strict";function t(e){s.push(e),window.postMessage(a,i.CONSTANTS.WILDCARD)}Object.defineProperty(n,"__esModule",{value:!0}),n.nextTick=t;var o=r(7),i=r(0),a="__nextTick__postRobot__"+(0,o.uniqueID)(),s=[];window.addEventListener("message",function(e){if(e.data===a){var n=s.shift();n.call()}})},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(21);Object.defineProperty(n,"WeakMap",{enumerable:!0,get:function(){return t.WeakMap}})},function(e,n,r){"use strict";function t(){if(!window.WeakMap)return!1;if(!window.Object.freeze)return!1;try{var e=new window.WeakMap,n={},r="__testvalue__";return window.Object.freeze(n),e.set(n,r),e.get(n)===r}catch(e){return!1}}Object.defineProperty(n,"__esModule",{value:!0}),n.hasNativeWeakMap=t},function(e,n,r){"use strict";function t(e){try{if(e&&e.self===e)return!0}catch(e){}return!1}function o(e){try{if(e&&e!==window&&e.closed)return!0}catch(e){return!e||"Call was rejected by callee.\r\n"!==e.message}return!1}Object.defineProperty(n,"__esModule",{value:!0}),n.isWindow=t,n.isClosedWindow=o},function(e,n,r){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.WeakMap=void 0;var o=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),i=r(20),a=r(19),s=Object.defineProperty,u=Date.now()%1e9;n.WeakMap=function(){function e(){if(t(this,e),u+=1,this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__"+u,(0,a.hasNativeWeakMap)())try{this.weakmap=new window.WeakMap}catch(e){}this.keys=[],this.values=[]}return o(e,[{key:"_cleanupClosedWindows",value:function(){for(var e=this.weakmap,n=this.keys,r=0;r<n.length;r++){var t=n[r];if((0,i.isClosedWindow)(t)){if(e)try{e.delete(t)}catch(e){}n.splice(r,1),this.values.splice(r,1),r-=1}}}},{key:"set",value:function(e,n){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{r.set(e,n)}catch(e){delete this.weakmap}if((0,i.isWindow)(e)){this._cleanupClosedWindows();var t=this.keys,o=this.values,a=t.indexOf(e);a===-1?(t.push(e),o.push(n)):o[a]=n}else{var u=this.name,c=e[u];c&&c[0]===e?c[1]=n:s(e,u,{value:[e,n],writable:!0})}}},{key:"get",value:function(e){
if(!e)throw new Error("WeakMap expected key");var n=this.weakmap;if(n)try{if(n.has(e))return n.get(e)}catch(e){delete this.weakmap}if((0,i.isWindow)(e)){var r=this.keys,t=r.indexOf(e);if(t===-1)return;return this.values[t]}var o=e[this.name];if(o&&o[0]===e)return o[1]}},{key:"delete",value:function(e){if(!e)throw new Error("WeakMap expected key");var n=this.weakmap;if(n)try{n.delete(e)}catch(e){delete this.weakmap}if((0,i.isWindow)(e)){this._cleanupClosedWindows();var r=this.keys,t=r.indexOf(e);t!==-1&&(r.splice(t,1),this.values.splice(t,1))}else{var o=e[this.name];o&&o[0]===e&&(o[0]=o[1]=void 0)}}},{key:"has",value:function(e){if(!e)throw new Error("WeakMap expected key");var n=this.weakmap;if(n)try{return n.has(e)}catch(e){delete this.weakmap}if((0,i.isWindow)(e))return this._cleanupClosedWindows(),this.keys.indexOf(e)!==-1;var r=e[this.name];return!(!r||r[0]!==e)}}]),e}()},function(e,n,r){"use strict";function t(e){return"[object RegExp]"===Object.prototype.toString.call(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.isRegex=t},function(e,n,r){"use strict";function t(e){try{d.global.tunnelWindows[e]&&delete d.global.tunnelWindows[e].source}catch(e){}delete d.global.tunnelWindows[e]}function o(){for(var e=d.global.tunnelWindows,n=Object.keys(e),r=Array.isArray(n),o=0,n=r?n:n[Symbol.iterator]();;){var i;if(r){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var a=i,s=e[a];try{(0,c.noop)(s.source)}catch(e){t(a);continue}(0,u.isWindowClosed)(s.source)&&t(a)}}function i(e){return o(),d.global.tunnelWindowId+=1,d.global.tunnelWindows[d.global.tunnelWindowId]=e,d.global.tunnelWindowId}function a(e){return d.global.tunnelWindows[e]}var s=r(0),u=r(1),c=r(2),d=r(3),f=r(6);d.global.tunnelWindows=d.global.tunnelWindows||{},d.global.tunnelWindowId=0,d.global.openTunnelToParent=function(e){var n=(0,u.getParent)(window);if(!n)throw new Error("No parent window found to open tunnel to");var r=i(e);return(0,f.send)(n,s.CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL,{name:e.name,sendMessage:function(){var e=a(r);try{(0,c.noop)(e&&e.source)}catch(e){return void t(r)}if(e&&e.source&&!(0,u.isWindowClosed)(e.source)){try{e.canary()}catch(e){return}e.sendMessage.apply(this,arguments)}}},{domain:s.CONSTANTS.WILDCARD})}},function(e,n,r){"use strict";function t(){return o.SyncPromise.try(function(){var e=(0,i.getOpener)(window);if(e&&(0,c.needsBridge)({win:e}))return(0,c.registerRemoteWindow)(e),d(e).then(function(n){return n?window.name?n[a.CONSTANTS.WINDOW_PROPS.POSTROBOT].openTunnelToParent({name:window.name,source:window,canary:function(){},sendMessage:function(e){try{(0,s.noop)(window)}catch(e){return}window&&!window.closed&&(0,u.receiveMessage)({data:e,origin:this.origin,source:this.source})}}).then(function(n){var r=n.source,t=n.origin,o=n.data;if(r!==e)throw new Error("Source does not match opener");(0,c.registerRemoteSendMessage)(r,t,o.sendMessage)}).catch(function(n){throw(0,c.rejectRemoteSendMessage)(e,n),n}):(0,c.rejectRemoteSendMessage)(e,new Error("Can not register with opener: window does not have a name")):(0,c.rejectRemoteSendMessage)(e,new Error("Can not register with opener: no bridge found in opener"))})})}Object.defineProperty(n,"__esModule",{value:!0}),n.openTunnelToOpener=t;var o=r(8),i=r(1),a=r(0),s=r(2),u=r(5),c=r(9),d=(0,s.weakMapMemoize)(function(e){return o.SyncPromise.try(function(){for(var n=(0,i.getFrames)(e),r=Array.isArray(n),t=0,n=r?n:n[Symbol.iterator]();;){var s;if(r){if(t>=n.length)break;s=n[t++]}else{if(t=n.next(),t.done)break;s=t.value}var u=s;try{if(u&&u!==window&&(0,i.isSameDomain)(u)&&u[a.CONSTANTS.WINDOW_PROPS.POSTROBOT])return u}catch(e){continue}}try{var d=(0,i.getFrameByName)(e,(0,c.getBridgeName)((0,i.getDomain)()));if(!d)return;return(0,i.isSameDomain)(d)&&d[a.CONSTANTS.WINDOW_PROPS.POSTROBOT]?d:new o.SyncPromise(function(e){var n=void 0,r=void 0;n=setInterval(function(){return(0,i.isSameDomain)(d)&&d[a.CONSTANTS.WINDOW_PROPS.POSTROBOT]?(clearInterval(n),clearTimeout(r),e(d)):void setTimeout(function(){return clearInterval(n),e()},2e3)},100)})}catch(e){return}})})},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=n.openBridge=void 0,o=n.linkUrl=void 0,i=n.isBridge=void 0,a=n.needsBridge=void 0,s=n.needsBridgeForBrowser=void 0,u=n.needsBridgeForWin=void 0,c=n.needsBridgeForDomain=void 0,d=n.openTunnelToOpener=void 0,f=n.destroyBridges=void 0,l=r(10);n.openBridge=t=l.openBridge,n.linkUrl=o=l.linkUrl,n.isBridge=i=l.isBridge,n.needsBridge=a=l.needsBridge,n.needsBridgeForBrowser=s=l.needsBridgeForBrowser,n.needsBridgeForWin=u=l.needsBridgeForWin,n.needsBridgeForDomain=c=l.needsBridgeForDomain,n.openTunnelToOpener=d=l.openTunnelToOpener,n.destroyBridges=f=l.destroyBridges},function(e,n,r){"use strict";function t(e,n){(0,w.on)(d.CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL,{source:e,domain:n},function(e){var r=e.origin,t=e.data;if(r!==n)throw new Error("Domain "+n+" does not match origin "+r);if(!t.name)throw new Error("Register window expected to be passed window name");if(!t.sendMessage)throw new Error("Register window expected to be passed sendMessage method");if(!l.global.popupWindowsByName[t.name])throw new Error("Window with name "+t.name+" does not exist, or was not opened by this window");if(!l.global.popupWindowsByName[t.name].domain)throw new Error("We do not have a registered domain for window "+t.name);if(l.global.popupWindowsByName[t.name].domain!==r)throw new Error("Message origin "+r+" does not matched registered window origin "+l.global.popupWindowsByName[t.name].domain);return(0,m.registerRemoteSendMessage)(l.global.popupWindowsByName[t.name].win,n,t.sendMessage),{sendMessage:function(e){if(window&&!window.closed){var n=l.global.popupWindowsByName[t.name];n&&(0,p.receiveMessage)({data:e,origin:n.domain,source:n.win})}}}})}function o(e,n){f.log.debug("Opening bridge:",e,n);var r=document.createElement("iframe");return r.setAttribute("name",e),r.setAttribute("id",e),r.setAttribute("style","display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;"),r.setAttribute("frameborder","0"),r.setAttribute("border","0"),r.setAttribute("scrolling","no"),r.setAttribute("allowTransparency","true"),r.setAttribute("tabindex","-1"),r.setAttribute("hidden","true"),r.setAttribute("title",""),r.setAttribute("role","presentation"),r.src=n,r}function i(e,n){return n=n||(0,f.getDomainFromUrl)(e),l.global.bridges[n]?l.global.bridges[n]:(l.global.bridges[n]=f.promise.run(function(){if((0,c.getDomain)()===n)throw new Error("Can not open bridge on the same domain as current domain: "+n);var r=(0,m.getBridgeName)(n),i=(0,c.getFrameByName)(window,r);if(i)throw new Error("Frame with name "+r+" already exists on page");var a=o(r,e);return m.documentBodyReady.then(function(r){return new f.promise.Promise(function(e,n){setTimeout(e,1)}).then(function(){r.appendChild(a);var o=a.contentWindow;return t(o,n),new f.promise.Promise(function(e,n){a.onload=e,a.onerror=n}).then(function(){return(0,f.onWindowReady)(o,d.CONFIG.BRIDGE_TIMEOUT,"Bridge "+e)}).then(function(){return o})})})}),l.global.bridges[n])}function a(e,n){var r=l.global.popupWindowsByWin.get(e);r&&(r.domain=(0,f.getDomainFromUrl)(n),(0,m.registerRemoteWindow)(e))}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,n){var r=[],t=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(t=(a=s.next()).done)&&(r.push(a.value),!n||r.length!==n);t=!0);}catch(e){o=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(o)throw i}}return r}return function(n,r){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.openBridge=i,n.linkUrl=a;var u=r(4),c=r(1),d=r(0),f=r(2),l=r(3),w=r(6),p=r(5),m=r(9);l.global.bridges=l.global.bridges||{},l.global.popupWindowsByWin=l.global.popupWindowsByWin||new u.WeakMap,l.global.popupWindowsByName=l.global.popupWindowsByName||{};var g=window.open;window.open=function(e,n,r,t){var o=e;if(e&&0===e.indexOf(d.CONSTANTS.MOCK_PROTOCOL)){var i=e.split("|"),a=s(i,2);o=a[0],e=a[1]}o&&(o=(0,f.getDomainFromUrl)(o));var u=g.call(this,e,n,r,t);if(!u)return u;e&&(0,m.registerRemoteWindow)(u);for(var w=Object.keys(l.global.popupWindowsByName),p=Array.isArray(w),h=0,w=p?w:w[Symbol.iterator]();;){var v;if(p){if(h>=w.length)break;v=w[h++]}else{if(h=w.next(),h.done)break;v=h.value}var y=v;(0,c.isWindowClosed)(l.global.popupWindowsByName[y].win)&&delete l.global.popupWindowsByName[y]}if(n&&u){var O=l.global.popupWindowsByWin.get(u)||l.global.popupWindowsByName[n]||{};O.name=O.name||n,O.win=O.win||u,O.domain=O.domain||o,l.global.popupWindowsByWin.set(u,O),l.global.popupWindowsByName[n]=O}return u}},function(e,n,r){"use strict";function t(e){var n=o.global.requestPromises.get(e);if(n)for(var r=n,t=Array.isArray(r),i=0,r=t?r:r[Symbol.iterator]();;){var a;if(t){if(i>=r.length)break;a=r[i++]}else{if(i=r.next(),i.done)break;a=i.value}var s=a;s.reject(new Error("No response from window - cleaned up"))}o.global.popupWindowsByWin&&o.global.popupWindowsByWin.delete(e),o.global.remoteWindows&&o.global.remoteWindows.delete(e),o.global.requestPromises.delete(e),o.global.methods.delete(e),o.global.readyPromises.delete(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.cleanUpWindow=t;var o=r(3)},function(e,n,r){"use strict";function t(e,n){if(!i.CONFIG.ALLOW_POSTMESSAGE_POPUP&&(0,o.isSameTopWindow)(e,n)===!1)throw new Error("Can not send and receive post messages between two different windows (disabled to emulate IE)")}Object.defineProperty(n,"__esModule",{value:!0}),n.emulateIERestrictions=t;var o=r(1),i=r(0)},function(e,n,r){"use strict";function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}Object.defineProperty(n,"__esModule",{value:!0}),n.CONFIG=void 0;var o,i=r(13),a=n.CONFIG={ALLOW_POSTMESSAGE_POPUP:!0,LOG_LEVEL:"info",BRIDGE_TIMEOUT:5e3,ACK_TIMEOUT:1e3,RES_TIMEOUT:1e4,LOG_TO_PAGE:!1,MOCK_MODE:!1,ALLOWED_POST_MESSAGE_METHODS:(o={},t(o,i.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE,!0),t(o,i.CONSTANTS.SEND_STRATEGIES.BRIDGE,!0),t(o,i.CONSTANTS.SEND_STRATEGIES.GLOBAL,!0),o)};0===window.location.href.indexOf(i.CONSTANTS.FILE_PROTOCOL)&&(a.ALLOW_POSTMESSAGE_POPUP=!0)},function(e,n,r){"use strict";function t(e){try{e=(0,c.jsonParse)(e)}catch(e){return}if(e&&(e=e[u.CONSTANTS.WINDOW_PROPS.POSTROBOT],e&&e.type&&f.RECEIVE_MESSAGE_TYPES[e.type]))return e}function o(e){if(!window||window.closed)throw new Error("Message recieved in closed window");try{if(!e.source)return}catch(e){return}var n=e.source,r=e.origin,o=e.data,i=t(o);if(i&&(0!==i.sourceDomain.indexOf(u.CONSTANTS.MOCK_PROTOCOL)&&0!==i.sourceDomain.indexOf(u.CONSTANTS.FILE_PROTOCOL)||(r=i.sourceDomain),d.global.receivedMessages.indexOf(i.id)===-1)){d.global.receivedMessages.push(i.id);var a=void 0;if(a=u.POST_MESSAGE_NAMES_LIST.indexOf(i.name)!==-1||i.type===u.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===i.ack?"error":"info",c.log.logLevel(a,["\n\n\t","#receive",i.type.replace(/^postrobot_message_/,""),"::",i.name,"::",r,"\n\n",i]),(0,s.isWindowClosed)(n))return c.log.debug("Source window is closed - can not send "+i.type+" "+i.name);i.data&&(i.data=(0,c.deserializeMethods)(n,r,i.data)),f.RECEIVE_MESSAGE_TYPES[i.type](n,r,i)}}function i(e){try{e.source}catch(e){return}e={source:e.source||e.sourceElement,origin:e.origin||e.originalEvent.origin,data:e.data};try{r(12).emulateIERestrictions(e.source,window)}catch(e){return}o(e)}function a(){(0,c.listen)(window,"message",i)}Object.defineProperty(n,"__esModule",{value:!0}),n.receiveMessage=o,n.messageListener=i,n.listenForMessages=a;var s=r(1),u=r(0),c=r(2),d=r(3),f=r(31);d.global.receivedMessages=d.global.receivedMessages||[]},function(e,n,r){"use strict";function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}Object.defineProperty(n,"__esModule",{value:!0}),n.RECEIVE_MESSAGE_TYPES=void 0;var o,i=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},a=r(1),s=r(0),u=r(2),c=r(15),d=r(14);n.RECEIVE_MESSAGE_TYPES=(o={},t(o,s.CONSTANTS.POST_MESSAGE_TYPE.ACK,function(e,n,r){var t=(0,d.getResponseListener)(r.hash);if(!t)throw new Error("No handler found for post message ack for message: "+r.name+" from "+n+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,a.matchDomain)(t.domain,n))throw new Error("Ack origin "+n+" does not match domain "+t.domain);t.ack=!0}),t(o,s.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,function(e,n,r){function t(t){return r.fireAndForget||(0,a.isWindowClosed)(e)?u.promise.Promise.resolve():(0,c.sendMessage)(e,i({target:r.originalSource,hash:r.hash,name:r.name},t),n)}var o=(0,d.getRequestListener)({name:r.name,win:e,domain:n});return u.promise.Promise.all([t({type:s.CONSTANTS.POST_MESSAGE_TYPE.ACK}),u.promise.run(function(){if(!o)throw new Error("No handler found for post message: "+r.name+" from "+n+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,a.matchDomain)(o.domain,n))throw new Error("Request origin "+n+" does not match domain "+o.domain);var t=r.data;return o.handler({source:e,origin:n,data:t})}).then(function(e){return t({type:s.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:s.CONSTANTS.POST_MESSAGE_ACK.SUCCESS,data:e})},function(e){var n=e.stack,r=e.message,o=void 0;return o=n?r&&n.indexOf(r)===-1?r+"\n"+n:n:r,t({type:s.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:s.CONSTANTS.POST_MESSAGE_ACK.ERROR,error:o})})]).catch(function(e){return o&&o.handleError?o.handleError(e):void u.log.error(e.stack||e.toString())})}),t(o,s.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,function(e,n,r){var t=(0,d.getResponseListener)(r.hash);if(!t)throw new Error("No handler found for post message response for message: "+r.name+" from "+n+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,a.matchDomain)(t.domain,n))throw new Error("Response origin "+n+" does not match domain "+t.domain);if((0,d.deleteResponseListener)(r.hash),r.ack===s.CONSTANTS.POST_MESSAGE_ACK.ERROR)return t.respond(new Error(r.error));if(r.ack===s.CONSTANTS.POST_MESSAGE_ACK.SUCCESS){var o=r.data||r.response;return t.respond(null,{source:e,origin:n,data:o})}}),o)},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SEND_MESSAGE_STRATEGIES=void 0;var t=r(1),o=r(0),i=n.SEND_MESSAGE_STRATEGIES={};i[o.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE]=function(e,n,i){try{r(12).emulateIERestrictions(window,e)}catch(e){return}var a=void 0;a=Array.isArray(i)?i:i?[i]:[o.CONSTANTS.WILDCARD],a=a.map(function(n){if(0===n.indexOf(o.CONSTANTS.MOCK_PROTOCOL)){if(window.location.protocol===o.CONSTANTS.FILE_PROTOCOL)return o.CONSTANTS.WILDCARD;if(!(0,t.isActuallySameDomain)(e))throw new Error("Attempting to send messsage to mock domain "+n+", but window is actually cross-domain");return(0,t.getActualDomain)(e)}return 0===n.indexOf(o.CONSTANTS.FILE_PROTOCOL)?o.CONSTANTS.WILDCARD:n}),a.forEach(function(r){return e.postMessage(n,r)})};var a=r(10).sendBridgeMessage;i[o.CONSTANTS.SEND_STRATEGIES.BRIDGE]=function(e,n,r){if((0,t.isSameDomain)(e))throw new Error("Post message through bridge disabled between same domain windows");if((0,t.isSameTopWindow)(window,e)!==!1)throw new Error("Can only use bridge to communicate between two different windows, not between frames");return a(e,n,r)},i[o.CONSTANTS.SEND_STRATEGIES.GLOBAL]=function(e,n,r){if(!(0,t.isSameDomain)(e))throw new Error("Post message through global disabled between different domain windows");if((0,t.isSameTopWindow)(window,e)!==!1)throw new Error("Can only use global to communicate between two different windows, not between frames");var i=e[o.CONSTANTS.WINDOW_PROPS.POSTROBOT];if(!i)throw new Error("Can not find postRobot global on foreign window");return i.receiveMessage({source:window,origin:(0,t.getDomain)(),data:n})}},function(e,n,r){"use strict";function t(e,n){return"object"===("undefined"==typeof e?"undefined":d(e))&&null!==e&&e.__type__===n}function o(e,n,r,t){var o=(0,p.uniqueID)(),i=v.global.methods.get(e);return i||(i={},v.global.methods.set(e,i)),i[o]={domain:n,method:r},{__type__:w.CONSTANTS.SERIALIZATION_TYPES.METHOD,__id__:o,__name__:t}}function i(e){return{__type__:w.CONSTANTS.SERIALIZATION_TYPES.ERROR,__message__:e.stack||e.message||e.toString()}}function a(e,n,r){return(0,p.replaceObject)({obj:r},function(r,t){return"function"==typeof r?o(e,n,r,t):r instanceof Error?i(r):void 0}).obj}function s(e,n,r){function t(){var t=Array.prototype.slice.call(arguments);return g.log.debug("Call foreign method",r.__name__,t),(0,m.send)(e,w.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{id:r.__id__,name:r.__name__,args:t},{domain:n,timeout:1/0}).then(function(e){var n=e.data;return g.log.debug("Got foreign method result",r.__name__,n.result),n.result},function(e){throw g.log.debug("Got foreign method error",e.stack||e.toString()),e})}return t.__name__=r.__name__,t.__xdomain__=!0,t.source=e,t.origin=n,t}function u(e,n,r){return new Error(r.__message__)}function c(e,n,r){return(0,p.replaceObject)({obj:r},function(r,o){return t(r,w.CONSTANTS.SERIALIZATION_TYPES.METHOD)?s(e,n,r):t(r,w.CONSTANTS.SERIALIZATION_TYPES.ERROR)?u(e,n,r):void 0}).obj}Object.defineProperty(n,"__esModule",{value:!0}),n.listenForMethods=void 0;var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.serializeMethod=o,n.serializeMethods=a,n.deserializeMethod=s,n.deserializeError=u,n.deserializeMethods=c;var f=r(4),l=r(1),w=r(0),p=r(7),m=r(6),g=r(11),h=r(16),v=r(3);v.global.methods=v.global.methods||new f.WeakMap;n.listenForMethods=(0,p.once)(function(){(0,m.on)(w.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{window:w.CONSTANTS.WILDCARD,origin:w.CONSTANTS.WILDCARD},function(e){var n=e.source,r=e.origin,t=e.data,o=v.global.methods.get(n);if(!o)throw new Error("Could not find any methods this window has privileges to call");var i=o[t.id];if(!i)throw new Error("Could not find method with id: "+t.id);if(!(0,l.matchDomain)(i.domain,r))throw new Error("Method domain "+i.domain+" does not match origin "+r);return g.log.debug("Call local method",t.name,t.args),h.promise.run(function(){return i.method.apply({source:n,origin:r,data:t},t.args)}).then(function(e){return{result:e,id:t.id,name:t.name}})})})},function(e,n,r){"use strict";function t(){(0,u.on)(s.CONSTANTS.POST_MESSAGE_NAMES.READY,{window:s.CONSTANTS.WILDCARD,domain:s.CONSTANTS.WILDCARD},function(e){var n=e.source,r=f.global.readyPromises.get(n);r?r.resolve(e):(r=(new d.SyncPromise).resolve(e),f.global.readyPromises.set(n,r))});var e=(0,a.getAncestor)();e&&(0,u.send)(e,s.CONSTANTS.POST_MESSAGE_NAMES.READY,{},{domain:s.CONSTANTS.WILDCARD,timeout:1/0}).catch(function(e){c.log.debug(e.stack||e.toString())})}function o(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Window",t=f.global.readyPromises.get(e);return t?t:(t=new d.SyncPromise,f.global.readyPromises.set(e,t),setTimeout(function(){return t.reject(new Error(r+" did not load after "+n+"ms"))},n),t)}Object.defineProperty(n,"__esModule",{value:!0}),n.initOnReady=t,n.onWindowReady=o;var i=r(4),a=r(1),s=r(0),u=r(6),c=r(11),d=r(8),f=r(3);f.global.readyPromises=f.global.readyPromises||new i.WeakMap},function(e,n,r){"use strict";function t(e){var n=f.promise.run(function(){if(!e.name)throw new Error("Expected options.name");if(c.CONFIG.MOCK_MODE)e.window=window;else if("string"==typeof e.window){var n=document.getElementById(e.window);if(!n)throw new Error("Expected options.window "+e.window+" to be a valid element id");if("iframe"!==n.tagName.toLowerCase())throw new Error("Expected options.window "+e.window+" to be an iframe");if(!n.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");e.window=n.contentWindow}else if(e.window instanceof HTMLElement){if("iframe"!==e.window.tagName.toLowerCase())throw new Error("Expected options.window "+e.window+" to be an iframe");if(!e.window.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");e.window=e.window.contentWindow}if(!e.window)throw new Error("Expected options.window to be a window object, iframe, or iframe element id.");e.domain=e.domain||c.CONSTANTS.WILDCARD;var r=e.name+"_"+(0,f.uniqueID)();if((0,d.addResponseListener)(r,e),(0,u.isWindowClosed)(e.window))throw new Error("Target window is closed");var t=!1,o=l.global.requestPromises.get(e.window);o||(o=[],l.global.requestPromises.set(e.window,o));var i=f.promise.run(function(){if((0,u.isAncestor)(window,e.window))return(0,f.onWindowReady)(e.window)}).then(function(){return new f.promise.Promise(function(n,a){if(e.respond=function(e,r){return e||(t=!0,o.splice(o.indexOf(i,1))),e?a(e):n(r)},(0,d.sendMessage)(e.window,{hash:r,type:c.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,name:e.name,data:e.data,fireAndForget:e.fireAndForget},e.domain).catch(a),e.fireAndForget)return n();var s=c.CONFIG.ACK_TIMEOUT,l=e.timeout||c.CONFIG.RES_TIMEOUT,w=(0,f.safeInterval)(function(){return e.ack&&t?w.cancel():(0,u.isWindowClosed)(e.window)?(w.cancel(),a(e.ack?new Error("Window closed for "+e.name+" before response"):new Error("Window closed for "+e.name+" before ack"))):(s-=100,l-=100,s<=0&&!e.ack?(w.cancel(),a(new Error("No ack for postMessage "+e.name+" in "+c.CONFIG.ACK_TIMEOUT+"ms"))):l<=0&&!t?(w.cancel(),a(new Error("No response for postMessage "+e.name+" in "+(e.timeout||c.CONFIG.RES_TIMEOUT)+"ms"))):void 0)},100)})});return i.catch(function(){(0,d.deleteResponseListener)(r)}),o.push(i),i});return n}function o(e,n,r,o){return o=o||{},o.window=e,o.name=n,o.data=r,t(o)}function i(e,n,r){var t=(0,u.getAncestor)();return t?o(t,e,n,r):new f.promise.Promise(function(e,n){return n(new Error("Window does not have a parent"))})}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.window)throw new Error("Expected options.window");return{send:function(n,r){return o(e.window,n,r,e)}}}Object.defineProperty(n,"__esModule",{value:!0}),n.send=void 0,n.request=t,n.sendToParent=i,n.client=a;var s=r(4),u=r(1),c=r(0),d=r(5),f=r(2),l=r(3);l.global.requestPromises=l.global.requestPromises||new s.WeakMap,n.send=o},function(e,n,r){"use strict";function t(){a.CONFIG.MOCK_MODE=!0}function o(){a.CONFIG.MOCK_MODE=!1}function i(){delete window[a.CONSTANTS.WINDOW_PROPS.POSTROBOT],window.removeEventListener("message",s.messageListener)}Object.defineProperty(n,"__esModule",{value:!0}),n.CONSTANTS=n.CONFIG=void 0,n.enableMockMode=t,n.disableMockMode=o;var a=r(0);Object.defineProperty(n,"CONFIG",{enumerable:!0,get:function(){return a.CONFIG}}),Object.defineProperty(n,"CONSTANTS",{enumerable:!0,get:function(){return a.CONSTANTS}}),n.disable=i;var s=r(5)},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.util=n.bridge=n.parent=void 0;var t=r(35);Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})});var o=r(38);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(36);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(7);Object.defineProperty(n,"util",{enumerable:!0,get:function(){return a.util}});var s=r(1),u=(n.parent=(0,s.getAncestor)(),n.bridge=void 0);n.bridge=u=r(25)},function(e,n,r){"use strict";function t(e){if(!e.name)throw new Error("Expected options.name");e.handler=e.handler||u.noop,e.errorHandler=e.errorHandler||function(e){throw e},e.source&&(e.window=e.source),e.domain=e.domain||d.CONSTANTS.WILDCARD;var n=(0,c.addRequestListener)({name:e.name,win:e.window,domain:e.domain},e);if(e.once){var r=e.handler;e.handler=(0,u.once)(function(){return n.cancel(),r.apply(this,arguments)})}if(e.handleError=function(n){e.errorHandler(n)},e.window&&e.errorOnClose)var t=(0,u.safeInterval)(function(){(0,s.isWindowClosed)(e.window)&&(t.cancel(),e.handleError(new Error("Post message target window is closed")))},50);return{cancel:function(){n.cancel()}}}function o(e,n,r,o){return"function"==typeof n&&(o=r,r=n,n={}),n=n||{},n.name=e,n.handler=r||n.handler,n.errorHandler=o||n.errorHandler,t(n)}function i(e,n,r,o){"function"==typeof n&&(o=r,r=n,n={}),n=n||{},n.name=e,n.handler=r||n.handler,n.errorHandler=o||n.errorHandler,n.once=!0;var i=new u.promise.Promise(function(e,r){n.handler=n.handler||function(n){return e(n)},n.errorHandler=n.errorHandler||r}),a=t(n);return(0,u.extend)(i,a),i}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{on:function(n,r,t){return o(n,e,r,t)}}}Object.defineProperty(n,"__esModule",{value:!0}),n.on=void 0,n.listen=t,n.once=i,n.listener=a;var s=r(1),u=r(2),c=r(5),d=r(0);n.on=o},function(e,n,r){"use strict";function t(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n.default=e,n}Object.defineProperty(n,"__esModule",{value:!0});var o=r(6);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=t(o);n.default=i}])});
//# sourceMappingURL=post-robot.ie.min.js.map