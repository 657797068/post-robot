!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("postRobot",[],r):"object"==typeof exports?exports.postRobot=r():e.postRobot=r()}(this,function(){return function(e){function r(t){if(n[t])return n[t].exports;var o=n[t]={exports:{},id:t,loaded:!1};return e[t].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var n={};return r.m=e,r.c=n,r.p="",r(0)}([function(e,r,n){"use strict";function t(){s.global.initialized||(i.util.listen(window,"message",a.messageListener),(0,u.openTunnelToOpener)(),(0,i.initOnReady)(),(0,i.listenForMethods)()),s.global.initialized=!0}Object.defineProperty(r,"__esModule",{value:!0}),r.Promise=void 0;var o=n(1);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(8);Object.defineProperty(r,"Promise",{enumerable:!0,get:function(){return i.Promise}});var a=n(6),s=n(15),u=n(23);t(),r["default"]=e.exports},function(e,r,n){"use strict";function t(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r["default"]=e,r}Object.defineProperty(r,"__esModule",{value:!0}),r.winutil=r.util=r.openTunnelToOpener=r.needsBridgeForDomain=r.needsBridgeForWin=r.needsBridgeForBrowser=r.needsBridge=r.isBridge=r.linkUrl=r.openBridge=r.reset=r.parent=void 0;var o=n(2);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(25);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(26);Object.keys(a).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})});var s=n(6);Object.defineProperty(r,"reset",{enumerable:!0,get:function(){return s.resetListeners}});var u=n(23);Object.defineProperty(r,"openBridge",{enumerable:!0,get:function(){return u.openBridge}}),Object.defineProperty(r,"linkUrl",{enumerable:!0,get:function(){return u.linkUrl}}),Object.defineProperty(r,"isBridge",{enumerable:!0,get:function(){return u.isBridge}}),Object.defineProperty(r,"needsBridge",{enumerable:!0,get:function(){return u.needsBridge}}),Object.defineProperty(r,"needsBridgeForBrowser",{enumerable:!0,get:function(){return u.needsBridgeForBrowser}}),Object.defineProperty(r,"needsBridgeForWin",{enumerable:!0,get:function(){return u.needsBridgeForWin}}),Object.defineProperty(r,"needsBridgeForDomain",{enumerable:!0,get:function(){return u.needsBridgeForDomain}}),Object.defineProperty(r,"openTunnelToOpener",{enumerable:!0,get:function(){return u.openTunnelToOpener}});var c=n(12);Object.defineProperty(r,"util",{enumerable:!0,get:function(){return c.util}});var d=n(14),f=t(d);r.parent=(0,d.getAncestor)(),r.winutil=f},function(e,r,n){"use strict";function t(e){return c.promise.nodeify(new c.promise.Promise(function(r,n){if(!e.name)throw new Error("Expected options.name");if(!e.window)throw new Error("Expected options.window");if(s.CONFIG.MOCK_MODE)e.window=window;else if("string"==typeof e.window){var t=document.getElementById(e.window);if(!t)throw new Error("Expected options.window "+e.window+" to be a valid element id");if("iframe"!==t.tagName.toLowerCase())throw new Error("Expected options.window "+e.window+" to be an iframe");if(e.window=t.contentWindow,!e.window)throw new Error("Expected options.window")}e.domain=e.domain||"*";var o=e.name+"_"+c.util.uniqueID();if(u.listeners.response[o]=e,(0,c.isWindowClosed)(e.window))throw new Error("Target window is closed");var i=!1;return e.respond=function(e,t){return e||(i=!0),e?n(e):r(t)},c.promise.run(function(){return(0,c.isAncestor)(window,e.window)?(0,c.onWindowReady)(e.window):void 0}).then(function(){if((0,u.sendMessage)(e.window,{hash:o,type:s.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,name:e.name,data:e.data,fireAndForget:e.fireAndForget},e.domain)["catch"](n),e.fireAndForget)return r();var t=c.util.intervalTimeout(s.CONFIG.ACK_TIMEOUT,100,function(r){return e.ack||(0,c.isWindowClosed)(e.window)?t.cancel():r?void 0:n(new Error("No ack for postMessage "+e.name+" in "+s.CONFIG.ACK_TIMEOUT+"ms"))});e.timeout&&!function(){var r=c.util.intervalTimeout(e.timeout,100,function(t){return i||(0,c.isWindowClosed)(e.window)?r.cancel():t?void 0:n(new Error("Post message response timed out after "+e.timeout+" ms"))},e.timeout)}()})["catch"](n)}),e.callback)}function o(e,r,n,o,i){return i||(o||"function"!=typeof n?"function"==typeof o&&(i=o,o={}):(i=n,o={},n={})),o=o||{},o.window=e,o.name=r,o.data=n,o.callback=i,t(o)}function i(e,r,n,t){var i=(0,c.getAncestor)();return i?o(i,e,r,n,t):new c.promise.Promise(function(e,r){return r(new Error("Window does not have a parent"))})}function a(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!e.window)throw new Error("Expected options.window");return{send:function(r,n,t){return o(e.window,r,n,e,t)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.send=void 0,r.request=t,r.sendToParent=i,r.client=a;var s=n(3),u=n(6),c=n(8);r.send=o},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(4);Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(5);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,r,n){"use strict";function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}Object.defineProperty(r,"__esModule",{value:!0}),r.CONFIG=void 0;var o,i=n(5),a=r.CONFIG={ALLOW_POSTMESSAGE_POPUP:!0,LOG_LEVEL:"info",BRIDGE_TIMEOUT:5e3,ACK_TIMEOUT:1e3,LOG_TO_PAGE:!1,MOCK_MODE:!1,ALLOWED_POST_MESSAGE_METHODS:(o={},t(o,i.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE,!0),t(o,i.CONSTANTS.SEND_STRATEGIES.BRIDGE,!0),t(o,i.CONSTANTS.SEND_STRATEGIES.GLOBAL,!0),o)};0===window.location.href.indexOf(i.CONSTANTS.FILE_PROTOCOL)&&(a.ALLOW_POSTMESSAGE_POPUP=!0)},function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=r.CONSTANTS={POST_MESSAGE_TYPE:{REQUEST:"postrobot_message_request",RESPONSE:"postrobot_message_response",ACK:"postrobot_message_ack"},POST_MESSAGE_ACK:{SUCCESS:"success",ERROR:"error"},POST_MESSAGE_NAMES:{METHOD:"postrobot_method",READY:"postrobot_ready",OPEN_TUNNEL:"postrobot_open_tunnel"},WINDOW_TYPES:{FULLPAGE:"fullpage",POPUP:"popup",IFRAME:"iframe"},WINDOW_PROPS:{POSTROBOT:"__postRobot__"},SERIALIZATION_TYPES:{METHOD:"postrobot_method"},SEND_STRATEGIES:{POST_MESSAGE:"postrobot_post_message",BRIDGE:"postrobot_bridge",GLOBAL:"postrobot_global"},MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",BRIDGE_NAME_PREFIX:"__postrobot_bridge__",POSTROBOT_PROXY:"__postrobot_proxy__"};r.POST_MESSAGE_NAMES_LIST=Object.keys(n.POST_MESSAGE_NAMES).map(function(e){return n.POST_MESSAGE_NAMES[e]})},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(7);Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(21);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(24);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,r,n){"use strict";function t(e){try{e=(0,s.jsonParse)(e)}catch(r){return}if(e&&(e=e[a.CONSTANTS.WINDOW_PROPS.POSTROBOT],e&&e.type&&d.RECEIVE_MESSAGE_TYPES[e.type]))return e}function o(e){if(!window||window.closed)throw new Error("Message recieved in closed window");try{if(!e.source)return}catch(r){return}var n=e.source,o=e.origin,i=e.data,u=t(i);if(u&&(0!==u.sourceDomain.indexOf(a.CONSTANTS.MOCK_PROTOCOL)&&0!==u.sourceDomain.indexOf(a.CONSTANTS.FILE_PROTOCOL)||(o=u.sourceDomain),-1===c.global.receivedMessages.indexOf(u.id))){c.global.receivedMessages.push(u.id);var f=void 0;if(f=-1!==a.POST_MESSAGE_NAMES_LIST.indexOf(u.name)||u.type===a.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===u.ack?"error":"info",s.log.logLevel(f,["\n\n	","#receive",u.type.replace(/^postrobot_message_/,""),"::",u.name,"::",o,"\n\n",u]),(0,s.isWindowClosed)(n))return s.log.debug("Source window is closed - can not send "+u.type+" "+u.name);u.data&&(u.data=(0,s.deserializeMethods)(n,o,u.data)),d.RECEIVE_MESSAGE_TYPES[u.type](n,o,u)}}function i(e){try{e.source}catch(r){return}e={source:e.source||e.sourceElement,origin:e.origin||e.originalEvent.origin,data:e.data};try{(0,u.emulateIERestrictions)(e.source,window)}catch(r){return}o(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.receiveMessage=o,r.messageListener=i;var a=n(3),s=n(8),u=n(18),c=n(15),d=n(20);c.global.receivedMessages=c.global.receivedMessages||[]},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(9);Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var o=n(12);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(13);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(14);Object.keys(a).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})});var s=n(16);Object.keys(s).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}})});var u=n(11);Object.keys(u).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return u[e]}})});var c=n(17);Object.keys(c).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return c[e]}})})},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.promise=r.Promise=void 0;var t=n(10),o=n(11),i=r.Promise=t.SyncPromise,a=r.promise={Promise:i,run:function(e){return i.resolve().then(e)},nextTick:function(e){return new i(function(r,n){(0,o.nextTick)(function(){return a.run(e).then(r,n)})})},method:function(e){return function(){var r=this,n=arguments;return i.resolve().then(function(){return e.apply(r,n)})}},nodeify:function(e,r){return r?void e.then(function(e){r(null,e)},function(e){r(e)}):e},deNodeify:function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),t=1;r>t;t++)n[t-1]=arguments[t];return new i(function(r,t){try{return n.length<e.length?e.apply(void 0,n.concat([function(e,n){return e?t(e):r(n)}])):a.run(function(){return e.apply(void 0,n)}).then(r,t)}catch(o){return t(o)}})},map:function(e,r){for(var n=[],t=function(t){n.push(a.run(function(){return r(e[t])}))},o=0;o<e.length;o++)t(o);return i.all(n)}}},function(e,r){"use strict";function n(e,r,n){function t(){if(a){if(u)return n(o);if(s)return r(i)}}var o,i,a=!1,s=!1,u=!1;try{e(function(e){i=e,s=!0,t()},function(e){o=e,u=!0,t()})}catch(c){return n(c)}a=!0,t()}function t(e){d.push(e),u=u||setTimeout(o,1)}function o(){u=null;var e=d;d=[];for(var r=0;r<e.length;r++){var n=e[r];n.hasHandlers||(n.handlers.push({onError:function(e){if(!n.hasHandlers){i(e);for(var r=0;r<c.length;r++)c[r](n.value)}}}),n.dispatch())}}function i(e){-1===f.indexOf(e)&&(f.push(e),setTimeout(function(){throw e},1))}function a(e){try{if(!e)return!1;if(window.Window&&e instanceof window.Window)return!1;if(window.constructor&&e instanceof window.constructor)return!1;if(l){var r=l.call(e);if("[object Window]"===r||"[object global]"===r||"[object DOMWindow]"===r)return!1}if(e&&e.then instanceof Function)return!0}catch(n){return!1}return!1}function s(){window.Promise=w}Object.defineProperty(r,"__esModule",{value:!0}),r.patchPromise=s;var u,c=[],d=[],f=[],l={}.toString,w=r.SyncPromise=function(e){if(this.resolved=!1,this.rejected=!1,this.hasHandlers=!1,this.handlers=[],t(this),e){var r=this;n(e,function(e){return r.resolve(e)},function(e){return r.reject(e)})}};w.resolve=function(e){return a(e)?e:(new w).resolve(e)},w.reject=function(e){return(new w).reject(e)},w.prototype.resolve=function(e){if(this.resolved||this.rejected)return this;if(a(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this},w.prototype.reject=function(e){if(this.resolved||this.rejected)return this;if(a(e))throw new Error("Can not reject promise with another promise");return this.rejected=!0,this.value=e,this.dispatch(),this},w.prototype.asyncReject=function(e){return this.hasHandlers=!0,this.reject(e)},w.prototype.dispatch=function(){var e=this;if(this.resolved||this.rejected)for(var r=function(){var r=e.handlers.shift();try{e.resolved?n=r.onSuccess?r.onSuccess(e.value):e.value:r.onError?n=r.onError(e.value):t=e.value}catch(o){t=o}if(n===e)throw new Error("Can not return a promise from the the then handler of the same promise");return r.promise?void(t?r.promise.reject(t):a(n)?n.then(function(e){r.promise.resolve(e)},function(e){r.promise.reject(e)}):r.promise.resolve(n)):"continue"};this.handlers.length;){var n,t;r()}},w.prototype.then=function(e,r){if(e&&"function"!=typeof e&&!e.call)throw new Error("Promise.then expected a function for success handler");if(r&&"function"!=typeof r&&!r.call)throw new Error("Promise.then expected a function for error handler");var n=new w(null,this);return this.handlers.push({promise:n,onSuccess:e,onError:r}),this.hasHandlers=!0,this.dispatch(),n},w.prototype["catch"]=function(e){return this.then(null,e)},w.prototype["finally"]=function(e){return this.then(function(r){return w["try"](e).then(function(){return r})},function(r){return w["try"](e).then(function(){throw r})})},w.all=function(e){for(var r=new w,n=e.length,t=[],o=function(o){var i=a(e[o])?e[o]:w.resolve(e[o]);i.then(function(e){t[o]=e,n-=1,0===n&&r.resolve(t)},function(e){r.reject(e)})},i=0;i<e.length;i++)o(i);return n||r.resolve(t),r},w.onPossiblyUnhandledException=function(e){c.push(e)},w["try"]=function(e){return w.resolve().then(e)},w.delay=function(e){return new w(function(r){setTimeout(r,e)})},w.hash=function(e){var r={},n=[];for(var t in e)e.hasOwnProperty(t)&&n.push(w.resolve(e[t]).then(function(e){r[t]=e}));return w.all(n).then(function(){return r})}},function(e,r,n){"use strict";function t(e){a.push(e),window.postMessage(i,"*")}Object.defineProperty(r,"__esModule",{value:!0}),r.nextTick=t;var o=n(12),i="__nextTick__postRobot__"+o.util.uniqueID(),a=[];window.addEventListener("message",function(e){if(e.data===i){var r=a.shift();r.call()}})},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.util=void 0;var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=n(3),i=r.util={once:function(e){if(!e)return e;var r=!1;return function(){return r?void 0:(r=!0,e.apply(this,arguments))}},noop:function(){},safeHasProp:function(e,r){try{return!!e[r]}catch(n){return!1}},safeGetProp:function(e,r){try{return e[r]}catch(n){return}},listen:function(e,r,n){return e.addEventListener?e.addEventListener(r,n):e.attachEvent("on"+r,n),{cancel:function(){e.removeEventListener?e.removeEventListener(r,n):e.detachEvent("on"+r,n)}}},apply:function(e,r,n){return"function"==typeof e.apply?e.apply(r,n):e(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9])},find:function(e,r,n){if(!e)return n;for(var t=0;t<e.length;t++)if(r(e[t]))return e[t];return n},map:function(e,r){for(var n=[],t=0;t<e.length;t++)n.push(r(e[t]));return n},some:function(e,r){r=r||Boolean;for(var n=0;n<e.length;n++)if(r(e[n]))return!0;return!1},keys:function(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(n);return r},values:function(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(e[n]);return r},getByValue:function(e,r){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===r)return n},uniqueID:function(){var e="0123456789abcdef";return"xxxxxxxxxx".replace(/./g,function(){return e.charAt(Math.floor(Math.random()*e.length))})},memoize:function(e){var r={};return function(){var n=JSON.stringify(Array.prototype.slice.call(arguments));return r.hasOwnProperty(n)||(r[n]=e.apply(this,arguments)),r[n]}},extend:function(e,r){if(!r)return e;for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);return e},each:function(e,r){if(Array.isArray(e))for(var n=0;n<e.length;n++)r(e[n],n);else if("object"===("undefined"==typeof e?"undefined":t(e))&&null!==e)for(var o in e)e.hasOwnProperty(o)&&r(e[o],o)},replaceObject:function(e,r){var n=arguments.length<=2||void 0===arguments[2]?1:arguments[2];if(n>=100)throw new Error("Self-referential object passed, or object contained too many layers");var o=Array.isArray(e)?[]:{};return i.each(e,function(e,a){var s=r(e,a);void 0!==s?o[a]=s:"object"===("undefined"==typeof e?"undefined":t(e))&&null!==e?o[a]=i.replaceObject(e,r,n+1):o[a]=e}),o},safeInterval:function(e,r){function n(){t=setTimeout(n,r),e.call()}var t=void 0;return t=setTimeout(n,r),{cancel:function(){clearTimeout(t)}}},intervalTimeout:function(e,r,n){var t=i.safeInterval(function(){e-=r,e=0>=e?0:e,0===e&&t.cancel(),n(e)},r);return t},getDomain:function(e){if(e=e||window,e.mockDomain&&0===e.mockDomain.indexOf(o.CONSTANTS.MOCK_PROTOCOL))return e.mockDomain;if(!e.location.protocol)throw new Error("Can not read window protocol");if(e.location.protocol===o.CONSTANTS.FILE_PROTOCOL)return e.location.protocol+"//"+e.location.host;if(!e.location.host)throw new Error("Can not read window host");return e.location.protocol+"//"+e.location.host},getDomainFromUrl:function(e){var r=void 0;return e.match(/^(https?|mock|file):\/\//)?(r=e,r=r.split("/").slice(0,3).join("/")):this.getDomain()},safeGet:function(e,r){var n=void 0;try{n=e[r]}catch(t){}return n}}},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.log=void 0;var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=n(12),i=n(14),a=n(3),s=["debug","info","warn","error"];Function.prototype.bind&&window.console&&"object"===t(console.log)&&["log","info","warn","error"].forEach(function(e){console[e]=this.bind(console[e],console)},Function.prototype.call);var u=r.log={clearLogs:function(){if(window.console&&window.console.clear&&window.console.clear(),a.CONFIG.LOG_TO_PAGE){var e=document.getElementById("postRobotLogs");e&&e.parentNode.removeChild(e)}},writeToPage:function(e,r){setTimeout(function(){var n=document.getElementById("postRobotLogs");n||(n=document.createElement("div"),n.id="postRobotLogs",n.style.cssText="width: 800px; font-family: monospace; white-space: pre-wrap;",document.body.appendChild(n));var t=document.createElement("div"),a=(new Date).toString().split(" ")[4],s=o.util.map(r,function(e){if("string"==typeof e)return e;if(!e)return Object.prototype.toString.call(e);var r=void 0;try{r=(0,i.jsonStringify)(e,0,2)}catch(n){r="[object]"}return"\n\n"+r+"\n\n"}).join(" "),u=a+" "+e+" "+s;t.innerHTML=u;var c={log:"#ddd",warn:"orange",error:"red",info:"blue",debug:"#aaa"}[e];t.style.cssText="margin-top: 10px; color: "+c+";",n.childNodes.length?n.insertBefore(t,n.childNodes[0]):n.appendChild(t)})},logLevel:function(e,r){try{if(s.indexOf(e)<s.indexOf(a.CONFIG.LOG_LEVEL))return;if(r=Array.prototype.slice.call(r),r.unshift(""+window.location.host+window.location.pathname),r.unshift("::"),r.unshift(""+(0,i.getWindowType)().toLowerCase()),r.unshift("[post-robot]"),a.CONFIG.LOG_TO_PAGE&&u.writeToPage(e,r),!window.console)return;if(window.console[e]||(e="log"),!window.console[e])return;window.console[e].apply(window.console,r)}catch(n){}},debug:function(){u.logLevel("debug",arguments)},info:function(){u.logLevel("info",arguments)},warn:function(){u.logLevel("warn",arguments)},error:function(){u.logLevel("error",arguments)}}},function(e,r,n){"use strict";function t(e){for(var r=j.global.domainMatches,n=Array.isArray(r),t=0,r=n?r:r[Symbol.iterator]();;){var o;if(n){if(t>=r.length)break;o=r[t++]}else{if(t=r.next(),t.done)break;o=t.value}var i=o;if(i.win===e)return i.match}var a=void 0;try{a=C.util.getDomain(window)===C.util.getDomain(e)}catch(s){a=!1}return j.global.domainMatches.push({win:e,match:a}),I||(I=setTimeout(function(){j.global.domainMatches=[],I=null},1)),a}function o(e){if(e)try{return e.opener}catch(r){return}}function i(e){if(e)try{if(e.parent&&e.parent!==e)return e.parent}catch(r){return}}function a(e){var r=[];try{for(;e.parent!==e;)r.push(e.parent),e=e.parent}catch(n){}return r}function s(e,r){if(!e||!r)return!1;var n=i(r);return n?n===e:-1!==a(r).indexOf(e)}function u(e){var r=[],n=void 0;try{n=e.frames}catch(t){n=e}var o=void 0;try{o=n.length}catch(t){}if(0===o)return r;if(o){for(var i=0;o>i;i++){var a=void 0;try{a=n[i]}catch(t){continue}r.push(a)}return r}for(var s=0;100>s;s++){var u=void 0;try{u=n[s]}catch(t){return r}if(!u)return r;r.push(u)}return r}function c(e){for(var r=[],n=u(e),t=Array.isArray(n),o=0,n=t?n:n[Symbol.iterator]();;){var i;if(t){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var a=i;r.push(a);for(var s=c(a),d=Array.isArray(s),f=0,s=d?s:s[Symbol.iterator]();;){var l;if(d){if(f>=s.length)break;l=s[f++]}else{if(f=s.next(),f.done)break;l=f.value}var w=l;r.push(w)}}return r}function d(e){var r=c(e);r.push(e);for(var n=a(e),t=Array.isArray(n),o=0,n=t?n:n[Symbol.iterator]();;){var i;if(t){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var s=i;r.push(s);for(var d=u(s),f=Array.isArray(d),l=0,d=f?d:d[Symbol.iterator]();;){var w;if(f){if(l>=d.length)break;w=d[l++]}else{if(l=d.next(),l.done)break;w=l.value}var p=w;-1===r.indexOf(p)&&r.push(p)}}return r}function f(e){if(e){try{if(e.top)return e.top}catch(r){}if(i(e)===e)return e;try{if(s(window,e))return window.top}catch(r){}try{if(s(e,window))return window.top}catch(r){}for(var n=c(e),t=Array.isArray(n),o=0,n=t?n:n[Symbol.iterator]();;){var a;if(t){if(o>=n.length)break;a=n[o++]}else{if(o=n.next(),o.done)break;a=o.value}var u=a;try{if(u.top)return u.top}catch(r){}if(i(u)===u)return u}}}function l(e){var r=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];if(e===window)return!1;try{if(!e)return!0}catch(n){return!0}try{if(e.closed)return!0}catch(n){return!n||"Call was rejected by callee.\r\n"!==n.message}return!!(r&&t(e)&&C.util.safeGet(e,"mockclosed"))}function w(e){return e=e||window,e.navigator.mockUserAgent||e.navigator.userAgent}function p(e,r){for(var n=u(e),o=n,i=Array.isArray(o),a=0,o=i?o:o[Symbol.iterator]();;){var s;if(i){if(a>=o.length)break;s=o[a++]}else{if(a=o.next(),a.done)break;s=a.value}var c=s;try{if(t(c)&&c.name===r&&-1!==n.indexOf(c))return c}catch(d){}}try{if(-1!==n.indexOf(e.frames[r]))return e.frames[r]}catch(d){}try{if(-1!==n.indexOf(e[r]))return e[r]}catch(d){}}function m(e,r){var n=p(e,r);if(n)return n;for(var t=u(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var s=a,c=m(s,r);if(c)return c}}function h(e,r){var n=void 0;return n=p(e,r),n?n:m(f(e),r)}function g(e,r){var n=i(r);if(n)return n===e;for(var t=u(e),o=Array.isArray(t),a=0,t=o?t:t[Symbol.iterator]();;){var s;if(o){if(a>=t.length)break;s=t[a++]}else{if(a=t.next(),a.done)break;s=a.value}var c=s;if(c===r)return!0}return!1}function v(e,r){return e===o(r)}function O(e){e=e||window;var r=o(e);if(r)return r;var n=i(e);return n?n:void 0}function S(e){for(var r=[],n=e;n;)n=O(n),n&&r.push(n);return r}function y(e,r){var n=O(r);if(n)return n===e;if(r===e)return!1;if(f(r)===r)return!1;for(var t=u(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var s=a;if(s===r)return!0}return!1}function b(){return Boolean(o(window))}function E(){return Boolean(i(window))}function T(){return Boolean(!E()&&!b())}function _(){return b()?R.CONSTANTS.WINDOW_TYPES.POPUP:E()?R.CONSTANTS.WINDOW_TYPES.IFRAME:R.CONSTANTS.WINDOW_TYPES.FULLPAGE}function P(e,r){for(var n=e,t=Array.isArray(n),o=0,n=t?n:n[Symbol.iterator]();;){var i;if(t){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}for(var a=i,s=r,u=Array.isArray(s),c=0,s=u?s:s[Symbol.iterator]();;){var d;if(u){if(c>=s.length)break;d=s[c++]}else{if(c=s.next(),c.done)break;d=c.value}var f=d;if(a===f)return!0}}}function A(e,r){var n=f(e),t=f(r);try{if(n&&t)return n===t}catch(i){}var a=d(e),s=d(r);if(P(a,s))return!0;var u=o(n),c=o(t);return u&&P(d(u),s)?!1:c&&P(d(c),a)?!1:void 0}function N(){var e=void 0,r=void 0;try{if("{}"!==JSON.stringify({})&&(e=Object.prototype.toJSON,delete Object.prototype.toJSON),"{}"!==JSON.stringify({}))throw new Error("Can not correctly serialize JSON objects");if("[]"!==JSON.stringify([])&&(r=Array.prototype.toJSON,delete Array.prototype.toJSON),"[]"!==JSON.stringify([]))throw new Error("Can not correctly serialize JSON objects")}catch(n){throw new Error("Can not repair JSON.stringify: "+n.message)}var t=JSON.stringify.apply(this,arguments);try{e&&(Object.prototype.toJSON=e),r&&(Array.prototype.toJSON=r)}catch(n){throw new Error("Can not repair JSON.stringify: "+n.message)}return t}function M(){return JSON.parse.apply(this,arguments)}Object.defineProperty(r,"__esModule",{value:!0}),r.isSameDomain=t,r.getOpener=o,r.getParent=i,r.getParents=a,r.isAncestorParent=s,r.getFrames=u,r.getAllChildFrames=c,r.getAllFramesInWindow=d,r.getTop=f,r.isWindowClosed=l,r.getUserAgent=w,r.getFrameByName=p,r.findChildFrameByName=m,r.findFrameByName=h,r.isParent=g,r.isOpener=v,r.getAncestor=O,r.getAncestors=S,r.isAncestor=y,r.isPopup=b,r.isIframe=E,r.isFullpage=T,r.getWindowType=_,r.isSameTopWindow=A,r.jsonStringify=N,r.jsonParse=M;var C=n(12),j=n(15),R=n(3);j.global.domainMatches=j.global.domainMatches||[];var I=void 0},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.global=void 0;var t=n(3);r.global=window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT]=window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT]||{}},function(e,r,n){"use strict";function t(e){return"object"===("undefined"==typeof e?"undefined":u(e))&&null!==e&&e.__type__===c.CONSTANTS.SERIALIZATION_TYPES.METHOD&&e.__id__}function o(e,r,n,t){var o=d.util.uniqueID();return p.global.methods[o]={destination:e,domain:r,method:n},{__type__:c.CONSTANTS.SERIALIZATION_TYPES.METHOD,__id__:o,__name__:t}}function i(e,r,n){return d.util.replaceObject({obj:n},function(n,t){return"function"==typeof n?o(e,r,n,t):void 0}).obj}function a(e,r,n){function t(){var t=Array.prototype.slice.call(arguments);return l.log.debug("Call foreign method",n.__name__,t),(0,f.send)(e,c.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{id:n.__id__,name:n.__name__,args:t},{domain:r}).then(function(e){var r=e.data;return l.log.debug("Got foreign method result",n.__name__,r.result),r.result})}return t.__name__=n.__name__,t}function s(e,r,n){return d.util.replaceObject({obj:n},function(n,o){return t(n)?a(e,r,n):void 0}).obj}Object.defineProperty(r,"__esModule",{value:!0}),r.listenForMethods=void 0;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};r.serializeMethod=o,r.serializeMethods=i,r.deserializeMethod=a,r.deserializeMethods=s;var c=n(3),d=n(12),f=n(1),l=n(13),w=n(9),p=n(15);p.global.methods=p.global.methods||{};r.listenForMethods=d.util.once(function(){(0,f.on)(c.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{window:"*",origin:"*"},function(e){var r=e.source,n=e.origin,t=e.data,o=p.global.methods[t.id];if(!o)throw new Error("Could not find method with id: "+t.id);if(o.destination!==r)throw new Error("Method window does not match");if(o.domain&&"*"!==o.domain&&n!==o.domain)throw new Error("Method domain "+o.domain+" does not match origin "+n);return l.log.debug("Call local method",t.name,t.args),w.promise.run(function(){return o.method.apply({source:r,origin:n,data:t},t.args)}).then(function(e){return{result:e,id:t.id,name:t.name}})})})},function(e,r,n){"use strict";function t(){(0,s.on)(i.CONSTANTS.POST_MESSAGE_NAMES.READY,{window:"*",domain:"*"},function(e){for(var r=d.global.readyPromises,n=Array.isArray(r),t=0,r=n?r:r[Symbol.iterator]();;){var o;if(n){if(t>=r.length)break;o=r[t++]}else{if(t=r.next(),t.done)break;o=t.value}var i=o;if(i.win===e.source)return void i.promise.resolve(e)}d.global.readyPromises.push({win:e.source,promise:(new c.SyncPromise).resolve(e)})});var e=(0,a.getAncestor)();e&&(0,s.send)(e,i.CONSTANTS.POST_MESSAGE_NAMES.READY,{},{domain:"*"})["catch"](function(e){u.log.debug(e.stack||e.toString())})}function o(e){for(var r=arguments.length<=1||void 0===arguments[1]?5e3:arguments[1],n=arguments.length<=2||void 0===arguments[2]?"Window":arguments[2],t=d.global.readyPromises,o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var s=a;if(s.win===e)return s.promise}var u=new c.SyncPromise;return d.global.readyPromises.push({win:e,promise:u}),setTimeout(function(){return u.reject(new Error(n+" did not load after "+r+"ms"))},r),u}Object.defineProperty(r,"__esModule",{value:!0}),r.initOnReady=t,r.onWindowReady=o;var i=n(3),a=n(14),s=n(1),u=n(13),c=n(10),d=n(15);d.global.readyPromises=d.global.readyPromises||[]},function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=n(19);Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})})},function(e,r,n){"use strict";function t(e,r){if(!o.CONFIG.ALLOW_POSTMESSAGE_POPUP&&(0,i.isSameTopWindow)(e,r)===!1)throw new Error("Can not send and receive post messages between two different windows (disabled to emulate IE)")}Object.defineProperty(r,"__esModule",{value:!0}),r.emulateIERestrictions=t;var o=n(3),i=n(8)},function(e,r,n){"use strict";function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){return"string"==typeof e?"*"===e||r===e:"[object RegExp]"===Object.prototype.toString.call(e)?r.match(e):Array.isArray(e)?-1!==e.indexOf(r):!1}Object.defineProperty(r,"__esModule",{value:!0}),r.RECEIVE_MESSAGE_TYPES=void 0;var i,a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},s=n(3),u=n(8),c=n(21),d=n(24);r.RECEIVE_MESSAGE_TYPES=(i={},t(i,s.CONSTANTS.POST_MESSAGE_TYPE.ACK,function(e,r,n){var t=d.listeners.response[n.hash];if(!t)throw new Error("No handler found for post message ack for message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!o(t.domain,r))throw new Error("Ack origin "+r+" does not match domain "+t.domain);t.ack=!0}),t(i,s.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,function(e,r,n){function t(t){return n.fireAndForget||(0,u.isWindowClosed)(e)?u.promise.Promise.resolve():(0,c.sendMessage)(e,a({target:n.originalSource,hash:n.hash,name:n.name},t),r)}var i=(0,d.getRequestListener)(n.name,e,r);return u.promise.Promise.all([t({type:s.CONSTANTS.POST_MESSAGE_TYPE.ACK}),u.promise.run(function(){if(!i)throw new Error("No handler found for post message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!o(i.domain,r))throw new Error("Request origin "+r+" does not match domain "+i.domain);var t=n.data;return u.promise.deNodeify(i.handler,{source:e,origin:r,data:t})}).then(function(e){return t({type:s.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:s.CONSTANTS.POST_MESSAGE_ACK.SUCCESS,data:e})},function(e){return t({type:s.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:s.CONSTANTS.POST_MESSAGE_ACK.ERROR,error:e.stack?e.message+"\n"+e.stack:e.toString()})})])["catch"](function(e){return i&&i.handleError?i.handleError(e):void u.log.error(e.stack||e.toString());
})}),t(i,s.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,function(e,r,n){var t=d.listeners.response[n.hash];if(!t)throw new Error("No handler found for post message response for message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!o(t.domain,r))throw new Error("Response origin "+r+" does not match domain "+t.domain);if(delete d.listeners.response[n.hash],n.ack===s.CONSTANTS.POST_MESSAGE_ACK.ERROR)return t.respond(new Error(n.error));if(n.ack===s.CONSTANTS.POST_MESSAGE_ACK.SUCCESS){var i=n.data||n.response;return t.respond(null,{source:e,origin:r,data:i})}}),i)},function(e,r,n){"use strict";function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],t=u.util.uniqueID(),o=(0,u.getWindowType)(),i=u.util.getDomain(window);return a({},r,n,{sourceDomain:i,id:r.id||t,windowType:o})}function i(e,r,n){return u.promise.run(function(){r=o(e,r,{data:(0,u.serializeMethods)(e,n,r.data),domain:n});var i=void 0;if(i=-1!==s.POST_MESSAGE_NAMES_LIST.indexOf(r.name)||r.type===s.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===r.ack?"error":"info",u.log.logLevel(i,["\n\n	","#send",r.type.replace(/^postrobot_message_/,""),"::",r.name,"::",n||"*","\n\n",r]),s.CONFIG.MOCK_MODE)return delete r.target,window[s.CONSTANTS.WINDOW_PROPS.POSTROBOT].postMessage({origin:u.util.getDomain(window),source:window,data:(0,u.jsonStringify)(r,0,2)});if(e===window)throw new Error("Attemping to send message to self");if((0,u.isWindowClosed)(e))throw new Error("Window is closed");u.log.debug("Running send message strategies",r);var a=[],d=(0,u.jsonStringify)(t({},s.CONSTANTS.WINDOW_PROPS.POSTROBOT,r),0,2);return u.promise.map(Object.keys(c.SEND_MESSAGE_STRATEGIES),function(r){return u.promise.run(function(){if(!s.CONFIG.ALLOWED_POST_MESSAGE_METHODS[r])throw new Error("Strategy disallowed: "+r);return c.SEND_MESSAGE_STRATEGIES[r](e,d,n)}).then(function(){return a.push(r+": success"),!0},function(e){return a.push(r+": "+(e.stack||e.toString())+"\n"),!1})}).then(function(e){var n=u.util.some(e),t=r.type+" "+r.name+" "+(n?"success":"error")+":\n  - "+a.join("\n  - ")+"\n";if(u.log.debug(t),!n)throw new Error(t)})})}Object.defineProperty(r,"__esModule",{value:!0});var a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e};r.buildMessage=o,r.sendMessage=i;var s=n(3),u=n(8),c=n(22)},function(e,r,n){"use strict";function t(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}Object.defineProperty(r,"__esModule",{value:!0}),r.SEND_MESSAGE_STRATEGIES=void 0;var o,i=n(3),a=n(8),s=n(18),u=n(23);r.SEND_MESSAGE_STRATEGIES=(o={},t(o,i.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE,function(e,r,n){return(0,s.emulateIERestrictions)(window,e),n&&0===n.indexOf(i.CONSTANTS.MOCK_PROTOCOL)&&(n=e.location.protocol+"//"+e.location.host),n&&0===n.indexOf(i.CONSTANTS.FILE_PROTOCOL)&&(n="*"),e.postMessage(r,n)}),t(o,i.CONSTANTS.SEND_STRATEGIES.BRIDGE,function(e,r,n){if((0,a.isSameDomain)(e))throw new Error("Post message through bridge disabled between same domain windows");if((0,a.isSameTopWindow)(window,e)!==!1)throw new Error("Can only use bridge to communicate between two different windows, not between frames");return(0,u.sendBridgeMessage)(e,r,n)}),t(o,i.CONSTANTS.SEND_STRATEGIES.GLOBAL,function(e,r,n){if(!(0,a.isSameDomain)(e))throw new Error("Post message through global disabled between different domain windows");if((0,a.isSameTopWindow)(window,e)!==!1)throw new Error("Can only use global to communicate between two different windows, not between frames");var t=e[i.CONSTANTS.WINDOW_PROPS.POSTROBOT];if(!t)throw new Error("Can not find postRobot global on foreign window");return t.receiveMessage({source:window,origin:n,data:r})}),o)},function(e,r,n){"use strict";function t(){return(0,E.getUserAgent)(window).match(/MSIE|trident|edge/i)?!0:!b.CONFIG.ALLOW_POSTMESSAGE_POPUP}function o(e){return e&&(0,E.isSameTopWindow)(window,e)?!1:!e||!(0,E.isSameDomain)(e)}function i(e){return!e||E.util.getDomain()!==E.util.getDomainFromUrl(e)}function a(e){var r=e.win,n=e.domain;return t()&&o(r)&&i(n)}function s(e){e=e||E.util.getDomainFromUrl(e);var r=e.replace(/[^a-zA-Z0-9]+/g,"_"),n=b.CONSTANTS.BRIDGE_NAME_PREFIX+"_"+r;return n}function u(e){try{var r=(0,E.getFrames)(e);if(!r||!r.length)return;for(var n=0;n<r.length;n++)try{var t=r[n];if(t&&t!==window&&(0,E.isSameDomain)(t)&&t[b.CONSTANTS.WINDOW_PROPS.POSTROBOT])return t}catch(o){continue}}catch(o){}}function c(e){var r=(arguments.length<=1||void 0===arguments[1]?b.CONFIG.BRIDGE_TIMEOUT:arguments[1],new E.promise.Promise);T.global.remoteWindows.push({win:e,sendMessagePromise:r})}function d(e){for(var r=0;r<T.global.remoteWindows.length;r++)if(T.global.remoteWindows[r].win===e)return T.global.remoteWindows[r]}function f(e,r,n){var t=d(e);if(!t)throw new Error("Window not found to register sendMessage to");var o=function(t,o,i){if(t!==e)throw new Error("Remote window does not match window");if("*"!==i&&i!==r)throw new Error("Remote domain "+i+" does not match domain "+r);n(o)};t.sendMessagePromise.resolve(o),t.sendMessagePromise=E.promise.Promise.resolve(o)}function l(e,r){var n=d(e);if(!n)throw new Error("Window not found on which to reject sendMessage");return n.sendMessagePromise.asyncReject(r)}function w(e,r,n){var t=(0,E.isOpener)(window,e),o=(0,E.isOpener)(e,window);if(!t&&!o)throw new Error("Can only send messages to and from parent and popup windows");var i=d(e);if(!i)throw new Error("Window not found to send message to");return i.sendMessagePromise.then(function(t){return t(e,r,n)})}function p(e,r){for(var n=Object.keys(T.global.popupWindows),t=Array.isArray(n),o=0,n=t?n:n[Symbol.iterator]();;){var i;if(t){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var a=i,s=T.global.popupWindows[a];if(s.win===e){s.domain=E.util.getDomainFromUrl(r),c(e);break}}}function m(e,r){(0,_.on)(b.CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL,{source:e,domain:r},function(e){var n=e.origin,t=e.data;if(n!==r)throw new Error("Domain "+r+" does not match origin "+n);if(!t.name)throw new Error("Register window expected to be passed window name");if(!t.sendMessage)throw new Error("Register window expected to be passed sendMessage method");var o=T.global.popupWindows[t.name];if(!o)throw new Error("Window with name "+t.name+" does not exist, or was not opened by this window");if(!o.domain)throw new Error("We do not have a registered domain for window "+t.name);if(o.domain!==n)throw new Error("Message origin "+n+" does not matched registered window origin "+o.domain);return f(o.win,r,t.sendMessage),{sendMessage:function(e){window&&!window.closed&&(0,P.receiveMessage)({data:e,origin:o.domain,source:o.win})}}})}function h(){return y.SyncPromise["try"](function(){var e=(0,E.getOpener)(window);if(e&&a({win:e})){c(e);var r=u(e);return r?window.name?r[b.CONSTANTS.WINDOW_PROPS.POSTROBOT].openTunnelToParent({name:window.name,source:window,canary:function(){},sendMessage:function(e){window&&!window.closed&&(0,P.receiveMessage)({data:e,origin:this.origin,source:this.source})}}).then(function(r){var n=r.source,t=r.origin,o=r.data;if(n!==e)throw new Error("Source does not match opener");f(n,t,o.sendMessage)})["catch"](function(r){throw l(e,r),r}):l(e,new Error("Can not register with opener: window does not have a name")):l(e,new Error("Can not register with opener: no bridge found in opener"))}})}function g(e,r){E.log.debug("Opening bridge:",e,r);var n=document.createElement("iframe");return n.setAttribute("name",e),n.setAttribute("id",e),n.setAttribute("style","display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;"),n.setAttribute("frameborder","0"),n.setAttribute("border","0"),n.setAttribute("scrolling","no"),n.setAttribute("allowTransparency","true"),n.setAttribute("tabindex","-1"),n.setAttribute("hidden","true"),n.setAttribute("title",""),n.setAttribute("role","presentation"),n.src=r,n}function v(e,r){return r=r||E.util.getDomainFromUrl(e),T.global.bridges[r]?T.global.bridges[r]:(T.global.bridges[r]=E.promise.run(function(){if(E.util.getDomain()===r)throw new Error("Can not open bridge on the same domain as current domain: "+r);var n=s(r),t=(0,E.getFrameByName)(window,n);if(t)throw new Error("Frame with name "+n+" already exists on page");var o=g(n,e);return A.then(function(n){return new E.promise.Promise(function(e,r){setTimeout(e,1)}).then(function(){n.appendChild(o);var t=o.contentWindow;return m(t,r),new E.promise.Promise(function(e,r){o.onload=e,o.onerror=r}).then(function(){return(0,E.onWindowReady)(t,b.CONFIG.BRIDGE_TIMEOUT,"Bridge "+e)}).then(function(){return t})})})}),T.global.bridges[r])}function O(){return window.name&&window.name===s(E.util.getDomain())}Object.defineProperty(r,"__esModule",{value:!0});var S=function(){function e(e,r){var n=[],t=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(t=(a=s.next()).done)&&(n.push(a.value),!r||n.length!==r);t=!0);}catch(u){o=!0,i=u}finally{try{!t&&s["return"]&&s["return"]()}finally{if(o)throw i}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();r.needsBridgeForBrowser=t,r.needsBridgeForWin=o,r.needsBridgeForDomain=i,r.needsBridge=a,r.sendBridgeMessage=w,r.linkUrl=p,r.openTunnelToOpener=h,r.openBridge=v,r.isBridge=O;var y=n(10),b=n(3),E=n(8),T=n(15),_=n(1),P=n(6),A=new E.promise.Promise(function(e){if(window.document&&window.document.body)return e(window.document.body);var r=setInterval(function(){return window.document&&window.document.body?(clearInterval(r),e(window.document.body)):void 0},10)});T.global.remoteWindows=T.global.remoteWindows||[],T.global.popupWindows=T.global.popupWindows||{};var N=window.open;window.open=function(e,r,n,t){var o=e;if(e&&0===e.indexOf(b.CONSTANTS.MOCK_PROTOCOL)){var i=e.split("|"),a=S(i,2);o=a[0],e=a[1]}o&&(o=E.util.getDomainFromUrl(o));var s=N.call(this,e,r,n,t);return e&&c(s),r&&(T.global.popupWindows[r]={win:s,domain:o}),s},T.global.openTunnelToParent=function(e){var r=e.name,n=e.source,t=e.canary,o=e.sendMessage,i=(0,E.getParent)(window);if(!i)throw new Error("No parent window found to open tunnel to");return(0,_.send)(i,b.CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL,{name:r,sendMessage:function(){if(!(0,E.isWindowClosed)(n)){try{t()}catch(e){return}o.apply(this,arguments)}}},{domain:"*"})},T.global.receiveMessage=function(e){return(0,P.receiveMessage)(e)},T.global.bridges=T.global.bridges||{}},function(e,r,n){"use strict";function t(){c.global.listeners.request=[],c.global.listeners.response=[]}function o(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function i(e,r){return"string"==typeof e?o(r)?!1:Array.isArray(r)?!1:"*"===e||r===e:o(e)?o(r)?e.toString()===r.toString():Array.isArray(r)?!1:r.match(e):Array.isArray(e)?o(r)?!1:Array.isArray(r)?JSON.stringify(e)===JSON.stringify(r):-1!==e.indexOf(r):!1}function a(e,r,n){for(var t={},o=c.global.listeners.request,a=Array.isArray(o),s=0,o=a?o:o[Symbol.iterator]();;){var u;if(a){if(s>=o.length)break;u=o[s++]}else{if(s=o.next(),s.done)break;u=s.value}var d=u;if(d.name===e){var f=d.win&&"*"!==d.win,l=d.domain&&"*"!==d.domain,w=f&&d.win===r,p=l&&i(d.domain,n);f&&l?w&&p&&(t.all=t.all||d.options):l?p&&(t.domain=t.domain||d.options):f?w&&(t.win=t.win||d.options):t.name=t.name||d.options}}return t.all||t.domain||t.win||t.name}function s(e){for(var r=c.global.listeners.request,n=Array.isArray(r),t=0,r=n?r:r[Symbol.iterator]();;){var o;if(n){if(t>=r.length)break;o=r[t++]}else{if(t=r.next(),t.done)break;o=t.value}var i=o;i.options===e&&c.global.listeners.request.splice(c.global.listeners.request.indexOf(i),1)}}function u(e,r,n,t,o){var i=a(e,r,n);if(i){if(!o){if(r)throw new Error("Request listener already exists for "+e+" on domain "+n+" for specified window: "+(i.win===r));throw new Error("Request listener already exists for "+e+" on domain "+n)}s(i)}d.request.push({name:e,win:r,domain:n,options:t})}Object.defineProperty(r,"__esModule",{value:!0}),r.listeners=void 0,r.resetListeners=t,r.getRequestListener=a,r.removeRequestListener=s,r.addRequestListener=u;var c=n(15);c.global.listeners=c.global.listeners||{request:[],response:[]};var d=r.listeners=c.global.listeners},function(e,r,n){"use strict";function t(e){if(!e.name)throw new Error("Expected options.name");e.handler=e.handler||u.util.noop,e.errorHandler=e.errorHandler||function(e){throw e},e.once&&!function(){var r=e.handler;e.handler=u.util.once(function(){return(0,c.removeRequestListener)(e),r.apply(this,arguments)})}();var r=e.override||s.CONFIG.MOCK_MODE;return e.source&&(e.window=e.source),e.domain=e.domain||"*",(0,c.addRequestListener)(e.name,e.window,e.domain,e,r),e.handleError=function(r){e.errorHandler(r)},e.window&&e.errorOnClose&&!function(){var r=u.util.safeInterval(function(){(0,u.isWindowClosed)(e.window)&&(r.cancel(),e.handleError(new Error("Post message target window is closed")))},50)}(),{cancel:function(){(0,c.removeRequestListener)(e)}}}function o(e,r,n,o){return"function"==typeof r&&(o=n,n=r,r={}),r=r||{},r.name=e,r.handler=n||r.handler,r.errorHandler=o||r.errorHandler,t(r)}function i(e,r,n,o){"function"==typeof r&&(o=n,n=r,r={}),r=r||{},r.name=e,r.handler=n||r.handler,r.errorHandler=o||r.errorHandler,r.once=!0;var i=new u.promise.Promise(function(e,n){r.handler=r.handler||function(r){return e(r)},r.errorHandler=r.errorHandler||n}),a=t(r);return u.util.extend(i,a),i}function a(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{on:function(r,n,t){return o(r,e,n,t)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.on=void 0,r.listen=t,r.once=i,r.listener=a;var s=n(3),u=n(8),c=n(6);r.on=o},function(e,r,n){"use strict";function t(){a.CONFIG.MOCK_MODE=!0}function o(){a.CONFIG.MOCK_MODE=!1}function i(){delete window[a.CONSTANTS.WINDOW_PROPS.POSTROBOT],window.removeEventListener("message",s.messageListener)}Object.defineProperty(r,"__esModule",{value:!0}),r.CONSTANTS=r.CONFIG=void 0,r.enableMockMode=t,r.disableMockMode=o;var a=n(3);Object.defineProperty(r,"CONFIG",{enumerable:!0,get:function(){return a.CONFIG}}),Object.defineProperty(r,"CONSTANTS",{enumerable:!0,get:function(){return a.CONSTANTS}}),r.disable=i;var s=n(6)}])});