!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("postRobot",[],r):"object"==typeof exports?exports.postRobot=r():e.postRobot=r()}("undefined"!=typeof self?self:this,function(){return function(e){function r(o){if(n[o])return n[o].exports;var t=n[o]={i:o,l:!1,exports:{}};return e[o].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var n={};return r.m=e,r.c=n,r.d=function(e,n,o){r.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s="./src/index.js")}({"./node_modules/cross-domain-safe-weakmap/src/index.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("./node_modules/cross-domain-safe-weakmap/src/interface.js");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var t=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}(o);r.default=t},"./node_modules/cross-domain-safe-weakmap/src/interface.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("./node_modules/cross-domain-safe-weakmap/src/weakmap.js");Object.defineProperty(r,"WeakMap",{enumerable:!0,get:function(){return o.CrossDomainSafeWeakMap}})},"./node_modules/cross-domain-safe-weakmap/src/native.js":function(e,r,n){"use strict";function o(){if(!window.WeakMap)return!1;if(!window.Object.freeze)return!1;try{var e=new window.WeakMap,r={};return window.Object.freeze(r),e.set(r,"__testvalue__"),"__testvalue__"===e.get(r)}catch(e){return!1}}Object.defineProperty(r,"__esModule",{value:!0}),r.hasNativeWeakMap=o},"./node_modules/cross-domain-safe-weakmap/src/util.js":function(e,r,n){"use strict";function o(e,r){for(var n=0;n<e.length;n++)try{if(e[n]===r)return n}catch(e){}return-1}function t(){}Object.defineProperty(r,"__esModule",{value:!0}),r.safeIndexOf=o,r.noop=t},"./node_modules/cross-domain-safe-weakmap/src/weakmap.js":function(e,r,n){"use strict";function o(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.CrossDomainSafeWeakMap=void 0;var t=function(){function e(e,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,n,o){return n&&e(r.prototype,n),o&&e(r,o),r}}(),i=n("./node_modules/cross-domain-utils/src/index.js"),s=n("./node_modules/cross-domain-safe-weakmap/src/native.js"),a=n("./node_modules/cross-domain-safe-weakmap/src/util.js"),c=Object.defineProperty,u=Date.now()%1e9;r.CrossDomainSafeWeakMap=function(){function e(){if(o(this,e),u+=1,this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__"+u,(0,s.hasNativeWeakMap)())try{this.weakmap=new window.WeakMap}catch(e){}this.keys=[],this.values=[]}return t(e,[{key:"_cleanupClosedWindows",value:function(){for(var e=this.weakmap,r=this.keys,n=0;n<r.length;n++){var o=r[n];if((0,i.isWindow)(o)&&(0,i.isWindowClosed)(o)){if(e)try{e.delete(o)}catch(e){}r.splice(n,1),this.values.splice(n,1),n-=1}}}},{key:"isSafeToReadWrite",value:function(e){if((0,i.isWindow)(e))return!1;try{(0,a.noop)(e&&e.self),(0,a.noop)(e&&e[this.name])}catch(e){return!1}return!0}},{key:"set",value:function(e,r){if(!e)throw new Error("WeakMap expected key");var n=this.weakmap;if(n)try{n.set(e,r)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var o=this.name,t=e[o];t&&t[0]===e?t[1]=r:c(e,o,{value:[e,r],writable:!0})}else{this._cleanupClosedWindows();var i=this.keys,s=this.values,u=(0,a.safeIndexOf)(i,e);-1===u?(i.push(e),s.push(r)):s[u]=r}}},{key:"get",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{if(r.has(e))return r.get(e)}catch(e){delete this.weakmap}if(!this.isSafeToReadWrite(e)){this._cleanupClosedWindows();var n=this.keys,o=(0,a.safeIndexOf)(n,e);if(-1===o)return;return this.values[o]}var t=e[this.name];if(t&&t[0]===e)return t[1]}},{key:"delete",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{r.delete(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var n=e[this.name];n&&n[0]===e&&(n[0]=n[1]=void 0)}else{this._cleanupClosedWindows();var o=this.keys,t=(0,a.safeIndexOf)(o,e);-1!==t&&(o.splice(t,1),this.values.splice(t,1))}}},{key:"has",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{return r.has(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var n=e[this.name];return!(!n||n[0]!==e)}return this._cleanupClosedWindows(),-1!==(0,a.safeIndexOf)(this.keys,e)}}]),e}()},"./node_modules/cross-domain-utils/src/index.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("./node_modules/cross-domain-utils/src/utils.js");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var t=n("./node_modules/cross-domain-utils/src/types.js");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})})},"./node_modules/cross-domain-utils/src/types.js":function(e,r,n){"use strict"},"./node_modules/cross-domain-utils/src/util.js":function(e,r,n){"use strict";function o(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function t(){}Object.defineProperty(r,"__esModule",{value:!0}),r.isRegex=o,r.noop=t},"./node_modules/cross-domain-utils/src/utils.js":function(e,r,n){"use strict";function o(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window).location.protocol===K.FILE_PROTOCOL}function t(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window).location.protocol===K.ABOUT_PROTOCOL}function i(e){if(e)try{if(e.parent&&e.parent!==e)return e.parent}catch(e){}}function s(e){if(e&&!i(e))try{return e.opener}catch(e){}}function a(e){try{return(0,Y.noop)(e&&e.location&&e.location.href),!0}catch(e){}return!1}function c(e){var r=e.location;if(!r)throw new Error("Can not read window location");var n=r.protocol;if(!n)throw new Error("Can not read window protocol");if(n===K.FILE_PROTOCOL)return K.FILE_PROTOCOL+"//";if(n===K.ABOUT_PROTOCOL){var o=i(e);return o&&a(e)?c(o):K.ABOUT_PROTOCOL+"//"}var t=r.host;if(!t)throw new Error("Can not read window host");return n+"//"+t}function u(e){e=e||window;var r=c(e);return r&&e.mockDomain&&0===e.mockDomain.indexOf(K.MOCK_PROTOCOL)?e.mockDomain:r}function d(e){try{if(!e.location.href)return!0;if("about:blank"===e.location.href)return!0}catch(e){}return!1}function l(e){try{if(e===window)return!0}catch(e){}try{var r=Object.getOwnPropertyDescriptor(e,"location");if(r&&!1===r.enumerable)return!1}catch(e){}try{if(t(e)&&a(e))return!0}catch(e){}try{if(c(e)===c(window))return!0}catch(e){}return!1}function f(e){if(!l(e))return!1;try{if(e===window)return!0;if(t(e)&&a(e))return!0;if(u(window)===u(e))return!0}catch(e){}return!1}function m(e){var r=[];try{for(;e.parent!==e;)r.push(e.parent),e=e.parent}catch(e){}return r}function g(e,r){if(!e||!r)return!1;var n=i(r);return n?n===e:-1!==m(r).indexOf(e)}function p(e){var r=[],n=void 0;try{n=e.frames}catch(r){n=e}var o=void 0;try{o=n.length}catch(e){}if(0===o)return r;if(o){for(var t=0;t<o;t++){var i=void 0;try{i=n[t]}catch(e){continue}r.push(i)}return r}for(var s=0;s<100;s++){var a=void 0;try{a=n[s]}catch(e){return r}if(!a)return r;r.push(a)}return r}function w(e){for(var r=[],n=p(e),o=Array.isArray(n),t=0,n=o?n:n[Symbol.iterator]();;){var i;if(o){if(t>=n.length)break;i=n[t++]}else{if(t=n.next(),t.done)break;i=t.value}var s=i;r.push(s);for(var a=w(s),c=Array.isArray(a),u=0,a=c?a:a[Symbol.iterator]();;){var d;if(c){if(u>=a.length)break;d=a[u++]}else{if(u=a.next(),u.done)break;d=u.value}var l=d;r.push(l)}}return r}function b(e){if(e){try{if(e.top)return e.top}catch(e){}if(i(e)===e)return e;try{if(g(window,e)&&window.top)return window.top}catch(e){}try{if(g(e,window)&&window.top)return window.top}catch(e){}for(var r=w(e),n=Array.isArray(r),o=0,r=n?r:r[Symbol.iterator]();;){var t;if(n){if(o>=r.length)break;t=r[o++]}else{if(o=r.next(),o.done)break;t=o.value}var s=t;try{if(s.top)return s.top}catch(e){}if(i(s)===s)return s}}}function y(e){var r=b(e);return w(r).concat(r)}function v(e){return e===b(e)}function h(e){if(!e.contentWindow)return!0;if(!e.parentNode)return!0;var r=e.ownerDocument;return!(!r||!r.body||r.body.contains(e))}function _(e,r){for(var n=0;n<e.length;n++)try{if(e[n]===r)return n}catch(e){}return-1}function O(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{if(e===window)return!1}catch(e){return!0}try{if(!e)return!0}catch(e){return!0}try{if(e.closed)return!0}catch(e){return!e||e.message!==J}if(r&&f(e))try{if(e.mockclosed)return!0}catch(e){}try{if(!e.parent||!e.top)return!0}catch(e){}try{(0,Y.noop)(e===e)}catch(e){return!0}var n=_(V,e);if(-1!==n){var o=Q[n];if(o&&h(o))return!0}return!1}function S(){for(var e=0;e<Q.length;e++)h(Q[e])&&(Q.splice(e,1),V.splice(e,1));for(var r=0;r<V.length;r++)O(V[r])&&(Q.splice(r,1),V.splice(r,1))}function E(e){if(S(),e&&e.contentWindow)try{V.push(e.contentWindow),Q.push(e)}catch(e){}}function T(e){return e=e||window,e.navigator.mockUserAgent||e.navigator.userAgent}function j(e,r){for(var n=p(e),o=n,t=Array.isArray(o),i=0,o=t?o:o[Symbol.iterator]();;){var s;if(t){if(i>=o.length)break;s=o[i++]}else{if(i=o.next(),i.done)break;s=i.value}var a=s;try{if(f(a)&&a.name===r&&-1!==n.indexOf(a))return a}catch(e){}}try{if(-1!==n.indexOf(e.frames[r]))return e.frames[r]}catch(e){}try{if(-1!==n.indexOf(e[r]))return e[r]}catch(e){}}function P(e,r){var n=j(e,r);if(n)return n;for(var o=p(e),t=Array.isArray(o),i=0,o=t?o:o[Symbol.iterator]();;){var s;if(t){if(i>=o.length)break;s=o[i++]}else{if(i=o.next(),i.done)break;s=i.value}var a=s,c=P(a,r);if(c)return c}}function A(e,r){var n=void 0;return(n=j(e,r))?n:P(b(e)||e,r)}function N(e,r){var n=i(r);if(n)return n===e;for(var o=p(e),t=Array.isArray(o),s=0,o=t?o:o[Symbol.iterator]();;){var a;if(t){if(s>=o.length)break;a=o[s++]}else{if(s=o.next(),s.done)break;a=s.value}if(a===r)return!0}return!1}function M(e,r){return e===s(r)}function C(e){e=e||window;var r=s(e);if(r)return r;var n=i(e);return n||void 0}function R(e){for(var r=[],n=e;n;)(n=C(n))&&r.push(n);return r}function W(e,r){var n=C(r);if(n)return n===e;if(r===e)return!1;if(b(r)===r)return!1;for(var o=p(e),t=Array.isArray(o),i=0,o=t?o:o[Symbol.iterator]();;){var s;if(t){if(i>=o.length)break;s=o[i++]}else{if(i=o.next(),i.done)break;s=i.value}if(s===r)return!0}return!1}function x(){return Boolean(s(window))}function k(){return Boolean(i(window))}function I(){return Boolean(!k()&&!x())}function L(e,r){for(var n=e,o=Array.isArray(n),t=0,n=o?n:n[Symbol.iterator]();;){var i;if(o){if(t>=n.length)break;i=n[t++]}else{if(t=n.next(),t.done)break;i=t.value}for(var s=i,a=r,c=Array.isArray(a),u=0,a=c?a:a[Symbol.iterator]();;){var d;if(c){if(u>=a.length)break;d=a[u++]}else{if(u=a.next(),u.done)break;d=u.value}if(s===d)return!0}}return!1}function D(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,r=0,n=e;n;)(n=i(n))&&(r+=1);return r}function G(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e,o=0;o<r;o++){if(!n)return;n=i(n)}return n}function B(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return G(e,D(e)-r)}function F(e,r){var n=b(e)||e,o=b(r)||r;try{if(n&&o)return n===o}catch(e){}var t=y(e),i=y(r);if(L(t,i))return!0;var a=s(n),c=s(o);return(!a||!L(y(a),i))&&(c&&L(y(c),t),!1)}function U(e,r){if("string"==typeof e){if("string"==typeof r)return e===K.WILDCARD||r===e;if((0,Y.isRegex)(r))return!1;if(Array.isArray(r))return!1}return(0,Y.isRegex)(e)?(0,Y.isRegex)(r)?e.toString()===r.toString():!Array.isArray(r)&&Boolean(r.match(e)):!!Array.isArray(e)&&(Array.isArray(r)?JSON.stringify(e)===JSON.stringify(r):!(0,Y.isRegex)(r)&&e.some(function(e){return U(e,r)}))}function z(e){return Array.isArray(e)?"("+e.join(" | ")+")":(0,Y.isRegex)(e)?"RegExp("+e.toString():e.toString()}function Z(e){var r=void 0;return e.match(/^(https?|mock|file):\/\//)?(r=e,r=r.split("/").slice(0,3).join("/")):u()}function H(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,t=void 0;return function i(){if(O(e))return t&&clearTimeout(t),r();o<=0?clearTimeout(t):(o-=n,t=setTimeout(i,n))}(),{cancel:function(){t&&clearTimeout(t)}}}function q(e){try{if(e===window)return!0}catch(e){if(e&&e.message===J)return!0}try{if("[object Window]"===Object.prototype.toString.call(e))return!0}catch(e){if(e&&e.message===J)return!0}try{if(window.Window&&e instanceof window.Window)return!0}catch(e){if(e&&e.message===J)return!0}try{if(e&&e.self===e)return!0}catch(e){if(e&&e.message===J)return!0}try{if(e&&e.parent===e)return!0}catch(e){if(e&&e.message===J)return!0}try{if(e&&e.top===e)return!0}catch(e){if(e&&e.message===J)return!0}try{(0,Y.noop)(e===e)}catch(e){return!0}try{(0,Y.noop)(e&&e.__cross_domain_utils_window_check__)}catch(e){return!0}return!1}Object.defineProperty(r,"__esModule",{value:!0}),r.isFileProtocol=o,r.isAboutProtocol=t,r.getParent=i,r.getOpener=s,r.canReadFromWindow=a,r.getActualDomain=c,r.getDomain=u,r.isBlankDomain=d,r.isActuallySameDomain=l,r.isSameDomain=f,r.getParents=m,r.isAncestorParent=g,r.getFrames=p,r.getAllChildFrames=w,r.getTop=b,r.getAllFramesInWindow=y,r.isTop=v,r.isFrameWindowClosed=h,r.isWindowClosed=O,r.linkFrameWindow=E,r.getUserAgent=T,r.getFrameByName=j,r.findChildFrameByName=P,r.findFrameByName=A,r.isParent=N,r.isOpener=M,r.getAncestor=C,r.getAncestors=R,r.isAncestor=W,r.isPopup=x,r.isIframe=k,r.isFullpage=I,r.getDistanceFromTop=D,r.getNthParent=G,r.getNthParentFromTop=B,r.isSameTopWindow=F,r.matchDomain=U,r.stringifyDomainPattern=z,r.getDomainFromUrl=Z,r.onCloseWindow=H,r.isWindow=q;var Y=n("./node_modules/cross-domain-utils/src/util.js"),K={MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",ABOUT_PROTOCOL:"about:",WILDCARD:"*"},J="Call was rejected by callee.\r\n",V=[],Q=[]},"./node_modules/webpack/buildin/global.js":function(e,r,n){"use strict";var o,t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};o=function(){return this}();try{o=o||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":t(window))&&(o=window)}e.exports=o},"./node_modules/zalgo-promise/src/exceptions.js":function(e,r,n){"use strict";function o(e){if(-1===(0,i.getGlobal)().dispatchedErrors.indexOf(e)){(0,i.getGlobal)().dispatchedErrors.push(e),setTimeout(function(){throw e},1);for(var r=0;r<(0,i.getGlobal)().possiblyUnhandledPromiseHandlers.length;r++)(0,i.getGlobal)().possiblyUnhandledPromiseHandlers[r](e)}}function t(e){return(0,i.getGlobal)().possiblyUnhandledPromiseHandlers.push(e),{cancel:function(){(0,i.getGlobal)().possiblyUnhandledPromiseHandlers.splice((0,i.getGlobal)().possiblyUnhandledPromiseHandlers.indexOf(e),1)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.dispatchPossiblyUnhandledError=o,r.onPossiblyUnhandledException=t;var i=n("./node_modules/zalgo-promise/src/global.js")},"./node_modules/zalgo-promise/src/global.js":function(e,r,n){"use strict";(function(e){function n(){var r=void 0;if("undefined"!=typeof window)r=window;else{if(void 0===e)throw new TypeError("Can not find global");r=e}var n=r.__zalgopromise__=r.__zalgopromise__||{};return n.flushPromises=n.flushPromises||[],n.activeCount=n.activeCount||0,n.possiblyUnhandledPromiseHandlers=n.possiblyUnhandledPromiseHandlers||[],n.dispatchedErrors=n.dispatchedErrors||[],n}Object.defineProperty(r,"__esModule",{value:!0}),r.getGlobal=n}).call(r,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/zalgo-promise/src/index.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("./node_modules/zalgo-promise/src/promise.js");Object.defineProperty(r,"ZalgoPromise",{enumerable:!0,get:function(){return o.ZalgoPromise}})},"./node_modules/zalgo-promise/src/promise.js":function(e,r,n){"use strict";function o(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.ZalgoPromise=void 0;var t=function(){function e(e,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,n,o){return n&&e(r.prototype,n),o&&e(r,o),r}}(),i=n("./node_modules/zalgo-promise/src/utils.js"),s=n("./node_modules/zalgo-promise/src/exceptions.js"),a=n("./node_modules/zalgo-promise/src/global.js"),c=function(){function e(r){var n=this;if(o(this,e),this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],r){var t=void 0,i=void 0,s=!1,a=!1,c=!1;try{r(function(e){c?n.resolve(e):(s=!0,t=e)},function(e){c?n.reject(e):(a=!0,i=e)})}catch(e){return void this.reject(e)}c=!0,s?this.resolve(t):a&&this.reject(i)}}return t(e,[{key:"resolve",value:function(e){if(this.resolved||this.rejected)return this;if((0,i.isPromise)(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this}},{key:"reject",value:function(e){var r=this;if(this.resolved||this.rejected)return this;if((0,i.isPromise)(e))throw new Error("Can not reject promise with another promise");if(!e){var n=e&&"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);e=new Error("Expected reject to be called with Error, got "+n)}return this.rejected=!0,this.error=e,this.errorHandled||setTimeout(function(){r.errorHandled||(0,s.dispatchPossiblyUnhandledError)(e)},1),this.dispatch(),this}},{key:"asyncReject",value:function(e){this.errorHandled=!0,this.reject(e)}},{key:"dispatch",value:function(){var r=this,n=this.dispatching,o=this.resolved,t=this.rejected,s=this.handlers;if(!n&&(o||t)){this.dispatching=!0,(0,a.getGlobal)().activeCount+=1;for(var c=0;c<s.length;c++){(function(n){var a=s[n],c=a.onSuccess,u=a.onError,d=a.promise,l=void 0;if(o)try{l=c?c(r.value):r.value}catch(e){return d.reject(e),"continue"}else if(t){if(!u)return d.reject(r.error),"continue";try{l=u(r.error)}catch(e){return d.reject(e),"continue"}}l instanceof e&&(l.resolved||l.rejected)?(l.resolved?d.resolve(l.value):d.reject(l.error),l.errorHandled=!0):(0,i.isPromise)(l)?l instanceof e&&(l.resolved||l.rejected)?l.resolved?d.resolve(l.value):d.reject(l.error):l.then(function(e){d.resolve(e)},function(e){d.reject(e)}):d.resolve(l)})(c)}s.length=0,this.dispatching=!1,(0,a.getGlobal)().activeCount-=1,0===(0,a.getGlobal)().activeCount&&e.flushQueue()}}},{key:"then",value:function(r,n){if(r&&"function"!=typeof r&&!r.call)throw new Error("Promise.then expected a function for success handler");if(n&&"function"!=typeof n&&!n.call)throw new Error("Promise.then expected a function for error handler");var o=new e;return this.handlers.push({promise:o,onSuccess:r,onError:n}),this.errorHandled=!0,this.dispatch(),o}},{key:"catch",value:function(e){return this.then(void 0,e)}},{key:"finally",value:function(r){return this.then(function(n){return e.try(r).then(function(){return n})},function(n){return e.try(r).then(function(){throw n})})}},{key:"timeout",value:function(e,r){var n=this;if(this.resolved||this.rejected)return this;var o=setTimeout(function(){n.resolved||n.rejected||n.reject(r||new Error("Promise timed out after "+e+"ms"))},e);return this.then(function(e){return clearTimeout(o),e})}},{key:"toPromise",value:function(){if("undefined"==typeof Promise)throw new TypeError("Could not find Promise");return Promise.resolve(this)}}],[{key:"resolve",value:function(r){return r instanceof e?r:(0,i.isPromise)(r)?new e(function(e,n){return r.then(e,n)}):(new e).resolve(r)}},{key:"reject",value:function(r){return(new e).reject(r)}},{key:"all",value:function(r){var n=new e,o=r.length,t=[];if(!o)return n.resolve(t),n;for(var s=0;s<r.length;s++){(function(s){var a=r[s];if(a instanceof e){if(a.resolved)return t[s]=a.value,o-=1,"continue"}else if(!(0,i.isPromise)(a))return t[s]=a,o-=1,"continue";e.resolve(a).then(function(e){t[s]=e,0===(o-=1)&&n.resolve(t)},function(e){n.reject(e)})})(s)}return 0===o&&n.resolve(t),n}},{key:"hash",value:function(r){var n={};return e.all(Object.keys(r).map(function(o){return e.resolve(r[o]).then(function(e){n[o]=e})})).then(function(){return n})}},{key:"map",value:function(r,n){return e.all(r.map(n))}},{key:"onPossiblyUnhandledException",value:function(e){return(0,s.onPossiblyUnhandledException)(e)}},{key:"try",value:function(r,n,o){var t=void 0;try{t=r.apply(n,o||[])}catch(r){return e.reject(r)}return e.resolve(t)}},{key:"delay",value:function(r){return new e(function(e){setTimeout(e,r)})}},{key:"isPromise",value:function(r){return!!(r&&r instanceof e)||(0,i.isPromise)(r)}},{key:"flush",value:function(){var r=new e;return(0,a.getGlobal)().flushPromises.push(r),0===(0,a.getGlobal)().activeCount&&e.flushQueue(),r}},{key:"flushQueue",value:function(){var e=(0,a.getGlobal)().flushPromises;(0,a.getGlobal)().flushPromises=[];for(var r=e,n=Array.isArray(r),o=0,r=n?r:r[Symbol.iterator]();;){var t;if(n){if(o>=r.length)break;t=r[o++]}else{if(o=r.next(),o.done)break;t=o.value}t.resolve()}}}]),e}();r.ZalgoPromise=c},"./node_modules/zalgo-promise/src/utils.js":function(e,r,n){"use strict";function o(e){try{if(!e)return!1;if("undefined"!=typeof Promise&&e instanceof Promise)return!0;if("undefined"!=typeof window&&window.Window&&e instanceof window.Window)return!1;if("undefined"!=typeof window&&window.constructor&&e instanceof window.constructor)return!1;var r={}.toString;if(r){var n=r.call(e);if("[object Window]"===n||"[object global]"===n||"[object DOMWindow]"===n)return!1}if("function"==typeof e.then)return!0}catch(e){return!1}return!1}Object.defineProperty(r,"__esModule",{value:!0}),r.isPromise=o},"./src/bridge/bridge.js":function(e,r,n){"use strict";function o(e){try{d.global.tunnelWindows[e]&&delete d.global.tunnelWindows[e].source}catch(e){}delete d.global.tunnelWindows[e]}function t(){for(var e=d.global.tunnelWindows,r=Object.keys(e),n=Array.isArray(r),t=0,r=n?r:r[Symbol.iterator]();;){var i;if(n){if(t>=r.length)break;i=r[t++]}else{if(t=r.next(),t.done)break;i=t.value}var s=i,c=e[s];try{(0,u.noop)(c.source)}catch(e){o(s);continue}(0,a.isWindowClosed)(c.source)&&o(s)}}function i(e){var r=e.name,n=e.source,o=e.canary,i=e.sendMessage;return t(),d.global.tunnelWindowId+=1,d.global.tunnelWindows[d.global.tunnelWindowId]={name:r,source:n,canary:o,sendMessage:i},d.global.tunnelWindowId}function s(e){return d.global.tunnelWindows[e]}n("./node_modules/zalgo-promise/src/index.js");var a=n("./node_modules/cross-domain-utils/src/index.js"),c=n("./src/conf/index.js"),u=n("./src/lib/index.js"),d=n("./src/global.js");d.global.tunnelWindows=d.global.tunnelWindows||{},d.global.tunnelWindowId=0,d.global.openTunnelToParent=function(e){var r=e.name,n=e.source,t=e.canary,l=e.sendMessage,f=(0,a.getParent)(window);if(!f)throw new Error("No parent window found to open tunnel to");var m=i({name:r,source:n,canary:t,sendMessage:l});return d.global.send(f,c.CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL,{name:r,sendMessage:function(){var e=s(m);try{(0,u.noop)(e&&e.source)}catch(e){return void o(m)}if(e&&e.source&&!(0,a.isWindowClosed)(e.source)){try{e.canary()}catch(e){return}e.sendMessage.apply(this,arguments)}}},{domain:c.CONSTANTS.WILDCARD})}},"./src/bridge/child.js":function(e,r,n){"use strict";function o(){return t.ZalgoPromise.try(function(){var e=(0,i.getOpener)(window);if(e&&(0,u.needsBridge)({win:e}))return(0,u.registerRemoteWindow)(e),d(e).then(function(r){return r?window.name?r[s.CONSTANTS.WINDOW_PROPS.POSTROBOT].openTunnelToParent({name:window.name,source:window,canary:function(){},sendMessage:function(e){try{(0,a.noop)(window)}catch(e){return}if(window&&!window.closed)try{c.global.receiveMessage({data:e,origin:this.origin,source:this.source})}catch(e){t.ZalgoPromise.reject(e)}}}).then(function(r){var n=r.source,o=r.origin,t=r.data;if(n!==e)throw new Error("Source does not match opener");(0,u.registerRemoteSendMessage)(n,o,t.sendMessage)}).catch(function(r){throw(0,u.rejectRemoteSendMessage)(e,r),r}):(0,u.rejectRemoteSendMessage)(e,new Error("Can not register with opener: window does not have a name")):(0,u.rejectRemoteSendMessage)(e,new Error("Can not register with opener: no bridge found in opener"))})})}Object.defineProperty(r,"__esModule",{value:!0}),r.openTunnelToOpener=o;var t=n("./node_modules/zalgo-promise/src/index.js"),i=n("./node_modules/cross-domain-utils/src/index.js"),s=n("./src/conf/index.js"),a=n("./src/lib/index.js"),c=n("./src/global.js"),u=n("./src/bridge/common.js"),d=(0,a.weakMapMemoize)(function(e){return t.ZalgoPromise.try(function(){for(var r=(0,i.getFrames)(e),n=Array.isArray(r),o=0,r=n?r:r[Symbol.iterator]();;){var a;if(n){if(o>=r.length)break;a=r[o++]}else{if(o=r.next(),o.done)break;a=o.value}var c=a;try{if(c&&c!==window&&(0,i.isSameDomain)(c)&&c[s.CONSTANTS.WINDOW_PROPS.POSTROBOT])return c}catch(e){continue}}try{var d=(0,i.getFrameByName)(e,(0,u.getBridgeName)((0,i.getDomain)()));if(!d)return;return(0,i.isSameDomain)(d)&&d[s.CONSTANTS.WINDOW_PROPS.POSTROBOT]?d:new t.ZalgoPromise(function(e){var r=void 0,n=void 0;r=setInterval(function(){if(d&&(0,i.isSameDomain)(d)&&d[s.CONSTANTS.WINDOW_PROPS.POSTROBOT])return clearInterval(r),clearTimeout(n),e(d)},100),n=setTimeout(function(){return clearInterval(r),e()},2e3)})}catch(e){}})})},"./src/bridge/common.js":function(e,r,n){"use strict";function o(){return!!(0,w.getUserAgent)(window).match(/MSIE|trident|edge\/12|edge\/13/i)||!b.CONFIG.ALLOW_POSTMESSAGE_POPUP}function t(e){return!(0,w.isSameTopWindow)(window,e)}function i(e,r){if(e){if((0,w.getDomain)()!==(0,w.getDomainFromUrl)(e))return!0}else if(r&&!(0,w.isSameDomain)(r))return!0;return!1}function s(e){var r=e.win,n=e.domain;return!!o()&&(!(n&&!i(n,r))&&!(r&&!t(r)))}function a(e){e=e||(0,w.getDomainFromUrl)(e);var r=e.replace(/[^a-zA-Z0-9]+/g,"_");return b.CONSTANTS.BRIDGE_NAME_PREFIX+"_"+r}function c(){return Boolean(window.name&&window.name===a((0,w.getDomain)()))}function u(e){y.global.remoteWindows.set(e,{sendMessagePromise:new p.ZalgoPromise})}function d(e){return y.global.remoteWindows.get(e)}function l(e,r,n){var o=d(e);if(!o)throw new Error("Window not found to register sendMessage to");var t=function(o,t,i){if(o!==e)throw new Error("Remote window does not match window");if(!(0,w.matchDomain)(i,r))throw new Error("Remote domain "+i+" does not match domain "+r);n(t)};o.sendMessagePromise.resolve(t),o.sendMessagePromise=p.ZalgoPromise.resolve(t)}function f(e,r){var n=d(e);if(!n)throw new Error("Window not found on which to reject sendMessage");n.sendMessagePromise.asyncReject(r)}function m(e,r,n){var o=(0,w.isOpener)(window,e),t=(0,w.isOpener)(e,window);if(!o&&!t)throw new Error("Can only send messages to and from parent and popup windows");var i=d(e);if(!i)throw new Error("Window not found to send message to");return i.sendMessagePromise.then(function(o){return o(e,r,n)})}Object.defineProperty(r,"__esModule",{value:!0}),r.documentBodyReady=void 0,r.needsBridgeForBrowser=o,r.needsBridgeForWin=t,r.needsBridgeForDomain=i,r.needsBridge=s,r.getBridgeName=a,r.isBridge=c,r.registerRemoteWindow=u,r.findRemoteWindow=d,r.registerRemoteSendMessage=l,r.rejectRemoteSendMessage=f,r.sendBridgeMessage=m;var g=n("./node_modules/cross-domain-safe-weakmap/src/index.js"),p=n("./node_modules/zalgo-promise/src/index.js"),w=n("./node_modules/cross-domain-utils/src/index.js"),b=n("./src/conf/index.js"),y=n("./src/global.js");r.documentBodyReady=new p.ZalgoPromise(function(e){if(window.document&&window.document.body)return e(window.document.body);var r=setInterval(function(){if(window.document&&window.document.body)return clearInterval(r),e(window.document.body)},10)});y.global.remoteWindows=y.global.remoteWindows||new g.WeakMap},"./src/bridge/index.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("./src/bridge/child.js");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var t=n("./src/bridge/common.js");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var i=n("./src/bridge/parent.js");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})}),n("./src/bridge/bridge.js")},"./src/bridge/interface.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("./src/bridge/index.js");Object.defineProperty(r,"openBridge",{enumerable:!0,get:function(){return o.openBridge}}),Object.defineProperty(r,"linkUrl",{enumerable:!0,get:function(){return o.linkUrl}}),Object.defineProperty(r,"isBridge",{enumerable:!0,get:function(){return o.isBridge}}),Object.defineProperty(r,"needsBridge",{enumerable:!0,get:function(){return o.needsBridge}}),Object.defineProperty(r,"needsBridgeForBrowser",{enumerable:!0,get:function(){return o.needsBridgeForBrowser}}),Object.defineProperty(r,"hasBridge",{enumerable:!0,get:function(){return o.hasBridge}}),Object.defineProperty(r,"needsBridgeForWin",{enumerable:!0,get:function(){return o.needsBridgeForWin}}),Object.defineProperty(r,"needsBridgeForDomain",{enumerable:!0,get:function(){return o.needsBridgeForDomain}}),Object.defineProperty(r,"openTunnelToOpener",{enumerable:!0,get:function(){return o.openTunnelToOpener}}),Object.defineProperty(r,"destroyBridges",{enumerable:!0,get:function(){return o.destroyBridges}})},"./src/bridge/parent.js":function(e,r,n){"use strict";function o(e,r){p.global.on(m.CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL,{window:e,domain:r},function(e){var n=e.origin,o=e.data;if(n!==r)throw new Error("Domain "+r+" does not match origin "+n);if(!o.name)throw new Error("Register window expected to be passed window name");if(!o.sendMessage)throw new Error("Register window expected to be passed sendMessage method");if(!p.global.popupWindowsByName[o.name])throw new Error("Window with name "+o.name+" does not exist, or was not opened by this window");if(!p.global.popupWindowsByName[o.name].domain)throw new Error("We do not have a registered domain for window "+o.name);if(p.global.popupWindowsByName[o.name].domain!==n)throw new Error("Message origin "+n+" does not matched registered window origin "+p.global.popupWindowsByName[o.name].domain);return(0,w.registerRemoteSendMessage)(p.global.popupWindowsByName[o.name].win,r,o.sendMessage),{sendMessage:function(e){if(window&&!window.closed){var r=p.global.popupWindowsByName[o.name];if(r)try{p.global.receiveMessage({data:e,origin:r.domain,source:r.win})}catch(e){l.ZalgoPromise.reject(e)}}}}})}function t(e,r){g.log.debug("Opening bridge:",e,r);var n=document.createElement("iframe");return n.setAttribute("name",e),n.setAttribute("id",e),n.setAttribute("style","display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;"),n.setAttribute("frameborder","0"),n.setAttribute("border","0"),n.setAttribute("scrolling","no"),n.setAttribute("allowTransparency","true"),n.setAttribute("tabindex","-1"),n.setAttribute("hidden","true"),n.setAttribute("title",""),n.setAttribute("role","presentation"),n.src=r,n}function i(e,r){return r=r||(0,f.getDomainFromUrl)(e),Boolean(p.global.bridges[r])}function s(e,r){return r=r||(0,f.getDomainFromUrl)(e),p.global.bridges[r]?p.global.bridges[r]:(p.global.bridges[r]=l.ZalgoPromise.try(function(){if((0,f.getDomain)()===r)throw new Error("Can not open bridge on the same domain as current domain: "+r);var n=(0,w.getBridgeName)(r);if((0,f.getFrameByName)(window,n))throw new Error("Frame with name "+n+" already exists on page");var i=t(n,e);return p.global.bridgeFrames[r]=i,w.documentBodyReady.then(function(n){n.appendChild(i);var t=i.contentWindow;return o(t,r),new l.ZalgoPromise(function(e,r){i.onload=e,i.onerror=r}).then(function(){return(0,g.onChildWindowReady)(t,m.CONFIG.BRIDGE_TIMEOUT,"Bridge "+e)}).then(function(){return t})})}),p.global.bridges[r])}function a(e,r){var n=p.global.popupWindowsByWin.get(e);n&&(n.domain=(0,f.getDomainFromUrl)(r),(0,w.registerRemoteWindow)(e))}function c(){for(var e=Object.keys(p.global.bridgeFrames),r=Array.isArray(e),n=0,e=r?e:e[Symbol.iterator]();;){var o;if(r){if(n>=e.length)break;o=e[n++]}else{if(n=e.next(),n.done)break;o=n.value}var t=o,i=p.global.bridgeFrames[t];i.parentNode&&i.parentNode.removeChild(i)}p.global.bridgeFrames={},p.global.bridges={}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function e(e,r){var n=[],o=!0,t=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!r||n.length!==r);o=!0);}catch(e){t=!0,i=e}finally{try{!o&&a.return&&a.return()}finally{if(t)throw i}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();r.hasBridge=i,r.openBridge=s,r.linkUrl=a,r.destroyBridges=c;var d=n("./node_modules/cross-domain-safe-weakmap/src/index.js"),l=n("./node_modules/zalgo-promise/src/index.js"),f=n("./node_modules/cross-domain-utils/src/index.js"),m=n("./src/conf/index.js"),g=n("./src/lib/index.js"),p=n("./src/global.js"),w=n("./src/bridge/common.js");p.global.bridges=p.global.bridges||{},p.global.bridgeFrames=p.global.bridgeFrames||{},p.global.popupWindowsByWin=p.global.popupWindowsByWin||new d.WeakMap,p.global.popupWindowsByName=p.global.popupWindowsByName||{};var b=window.open;window.open=function(e,r,n,o){var t=e;if(e&&0===e.indexOf(m.CONSTANTS.MOCK_PROTOCOL)){var i=e.split("|"),s=u(i,2);t=s[0],e=s[1]}t&&(t=(0,f.getDomainFromUrl)(t));var a=b.call(this,e,r,n,o);if(!a)return a;e&&(0,w.registerRemoteWindow)(a);for(var c=Object.keys(p.global.popupWindowsByName),d=Array.isArray(c),l=0,c=d?c:c[Symbol.iterator]();;){var g;if(d){if(l>=c.length)break;g=c[l++]}else{if(l=c.next(),l.done)break;g=l.value}var y=g;(0,f.isWindowClosed)(p.global.popupWindowsByName[y].win)&&delete p.global.popupWindowsByName[y]}if(r&&a){var v=p.global.popupWindowsByWin.get(a)||p.global.popupWindowsByName[r]||{};v.name=v.name||r,v.win=v.win||a,v.domain=v.domain||t,p.global.popupWindowsByWin.set(a,v),p.global.popupWindowsByName[r]=v}return a}},"./src/clean.js":function(e,r,n){"use strict";function o(e){var r=t.global.requestPromises.get(e);if(r)for(var n=r,o=Array.isArray(n),i=0,n=o?n:n[Symbol.iterator]();;){var s;if(o){if(i>=n.length)break;s=n[i++]}else{if(i=n.next(),i.done)break;s=i.value}var a=s;a.reject(new Error("No response from window - cleaned up"))}t.global.popupWindowsByWin&&t.global.popupWindowsByWin.delete(e),t.global.remoteWindows&&t.global.remoteWindows.delete(e),t.global.requestPromises.delete(e),t.global.methods.delete(e),t.global.readyPromises.delete(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.cleanUpWindow=o,n("./node_modules/cross-domain-utils/src/index.js");var t=n("./src/global.js")},"./src/conf/config.js":function(e,r,n){"use strict";function o(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}Object.defineProperty(r,"__esModule",{value:!0}),r.CONFIG=void 0;var t,i=n("./src/conf/constants.js"),s=r.CONFIG={ALLOW_POSTMESSAGE_POPUP:!("__ALLOW_POSTMESSAGE_POPUP__"in window)||window.__ALLOW_POSTMESSAGE_POPUP__,LOG_LEVEL:"info",BRIDGE_TIMEOUT:5e3,CHILD_WINDOW_TIMEOUT:5e3,ACK_TIMEOUT:-1!==window.navigator.userAgent.match(/MSIE/i)?2e3:1e3,RES_TIMEOUT:1/0,LOG_TO_PAGE:!1,ALLOWED_POST_MESSAGE_METHODS:(t={},o(t,i.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE,!0),o(t,i.CONSTANTS.SEND_STRATEGIES.BRIDGE,!0),o(t,i.CONSTANTS.SEND_STRATEGIES.GLOBAL,!0),t),ALLOW_SAME_ORIGIN:!1};0===window.location.href.indexOf(i.CONSTANTS.FILE_PROTOCOL)&&(s.ALLOW_POSTMESSAGE_POPUP=!0)},"./src/conf/constants.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=(r.CONSTANTS={POST_MESSAGE_TYPE:{REQUEST:"postrobot_message_request",RESPONSE:"postrobot_message_response",ACK:"postrobot_message_ack"},POST_MESSAGE_ACK:{SUCCESS:"success",ERROR:"error"},POST_MESSAGE_NAMES:{METHOD:"postrobot_method",HELLO:"postrobot_hello",OPEN_TUNNEL:"postrobot_open_tunnel"},WINDOW_TYPES:{FULLPAGE:"fullpage",POPUP:"popup",IFRAME:"iframe"},WINDOW_PROPS:{POSTROBOT:"__postRobot__"},SERIALIZATION_TYPES:{METHOD:"postrobot_method",ERROR:"postrobot_error",PROMISE:"postrobot_promise",ZALGO_PROMISE:"postrobot_zalgo_promise",REGEX:"regex"},SEND_STRATEGIES:{POST_MESSAGE:"postrobot_post_message",BRIDGE:"postrobot_bridge",GLOBAL:"postrobot_global"},MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",BRIDGE_NAME_PREFIX:"__postrobot_bridge__",POSTROBOT_PROXY:"__postrobot_proxy__",WILDCARD:"*"},r.POST_MESSAGE_NAMES={METHOD:"postrobot_method",HELLO:"postrobot_hello",OPEN_TUNNEL:"postrobot_open_tunnel"});r.POST_MESSAGE_NAMES_LIST=Object.keys(o).map(function(e){return o[e]})},"./src/conf/index.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("./src/conf/config.js");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var t=n("./src/conf/constants.js");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})})},"./src/drivers/index.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("./src/drivers/receive/index.js");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var t=n("./src/drivers/send/index.js");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var i=n("./src/drivers/listeners.js");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})})},"./src/drivers/listeners.js":function(e,r,n){"use strict";function o(){m.global.responseListeners={},m.global.requestListeners={}}function t(e,r){m.global.responseListeners[e]=r}function i(e){return m.global.responseListeners[e]}function s(e){delete m.global.responseListeners[e]}function a(e){m.global.erroredResponseListeners[e]=!0}function c(e){return Boolean(m.global.erroredResponseListeners[e])}function u(e){var r=e.name,n=e.win,o=e.domain;if(n===p.CONSTANTS.WILDCARD&&(n=null),o===p.CONSTANTS.WILDCARD&&(o=null),!r)throw new Error("Name required to get request listener");var t=m.global.requestListeners[r];if(t)for(var i=[n,m.global.WINDOW_WILDCARD],s=0;s<i.length;s++){var a=i[s],c=a&&t.get(a);if(c){if(o&&"string"==typeof o){if(c[o])return c[o];if(c[w])for(var u=c[w],d=Array.isArray(u),l=0,u=d?u:u[Symbol.iterator]();;){var g;if(d){if(l>=u.length)break;g=u[l++]}else{if(l=u.next(),l.done)break;g=l.value}var b=g,y=b.regex,v=b.listener;if((0,f.matchDomain)(y,o))return v}}if(c[p.CONSTANTS.WILDCARD])return c[p.CONSTANTS.WILDCARD]}}}function d(e,r){var n=e.name,o=e.win,t=e.domain;if(!n||"string"!=typeof n)throw new Error("Name required to add request listener");if(Array.isArray(o)){for(var i=[],s=o,a=Array.isArray(s),c=0,s=a?s:s[Symbol.iterator]();;){var f;if(a){if(c>=s.length)break;f=s[c++]}else{if(c=s.next(),c.done)break;f=c.value}var b=f;i.push(d({name:n,domain:t,win:b},r))}return{cancel:function(){for(var e=i,r=Array.isArray(e),n=0,e=r?e:e[Symbol.iterator]();;){var o;if(r){if(n>=e.length)break;o=e[n++]}else{if(n=e.next(),n.done)break;o=n.value}o.cancel()}}}}if(Array.isArray(t)){for(var y=[],v=t,h=Array.isArray(v),_=0,v=h?v:v[Symbol.iterator]();;){var O;if(h){if(_>=v.length)break;O=v[_++]}else{if(_=v.next(),_.done)break;O=_.value}var S=O;y.push(d({name:n,win:o,domain:S},r))}return{cancel:function(){for(var e=y,r=Array.isArray(e),n=0,e=r?e:e[Symbol.iterator]();;){var o;if(r){if(n>=e.length)break;o=e[n++]}else{if(n=e.next(),n.done)break;o=n.value}o.cancel()}}}}var E=u({name:n,win:o,domain:t});if(o&&o!==p.CONSTANTS.WILDCARD||(o=m.global.WINDOW_WILDCARD),t=t||p.CONSTANTS.WILDCARD,E)throw o&&t?new Error("Request listener already exists for "+n+" on domain "+t.toString()+" for "+(o===m.global.WINDOW_WILDCARD?"wildcard":"specified")+" window"):o?new Error("Request listener already exists for "+n+" for "+(o===m.global.WINDOW_WILDCARD?"wildcard":"specified")+" window"):t?new Error("Request listener already exists for "+n+" on domain "+t.toString()):new Error("Request listener already exists for "+n);var T=m.global.requestListeners,j=T[n];j||(j=new l.WeakMap,T[n]=j);var P=j.get(o);P||(P={},j.set(o,P));var A=t.toString(),N=P[w],M=void 0;return(0,g.isRegex)(t)?(N||(N=[],P[w]=N),M={regex:t,listener:r},N.push(M)):P[A]=r,{cancel:function(){P&&(delete P[A],o&&0===Object.keys(P).length&&j.delete(o),M&&N.splice(N.indexOf(M,1)))}}}Object.defineProperty(r,"__esModule",{value:!0}),r.resetListeners=o,r.addResponseListener=t,r.getResponseListener=i,r.deleteResponseListener=s,r.markResponseListenerErrored=a,r.isResponseListenerErrored=c,r.getRequestListener=u,r.addRequestListener=d,n("./node_modules/zalgo-promise/src/index.js");var l=n("./node_modules/cross-domain-safe-weakmap/src/index.js"),f=n("./node_modules/cross-domain-utils/src/index.js"),m=n("./src/global.js"),g=n("./src/lib/index.js"),p=n("./src/conf/index.js");m.global.responseListeners=m.global.responseListeners||{},m.global.requestListeners=m.global.requestListeners||{},m.global.WINDOW_WILDCARD=m.global.WINDOW_WILDCARD||new function(){},m.global.erroredResponseListeners=m.global.erroredResponseListeners||{};var w="__domain_regex__"},"./src/drivers/receive/index.js":function(e,r,n){"use strict";function o(e){var r=void 0;try{r=(0,d.jsonParse)(e)}catch(e){return}if(r&&"object"===(void 0===r?"undefined":a(r))&&null!==r&&(r=r[u.CONSTANTS.WINDOW_PROPS.POSTROBOT])&&"object"===(void 0===r?"undefined":a(r))&&null!==r&&r.type&&"string"==typeof r.type&&f.RECEIVE_MESSAGE_TYPES[r.type])return r}function t(e){if(!window||window.closed)throw new Error("Message recieved in closed window");try{if(!e.source)return}catch(e){return}var r=e.source,n=e.origin,t=e.data,i=o(t);if(i){if(!i.sourceDomain||"string"!=typeof i.sourceDomain)throw new Error("Expected message to have sourceDomain");if(0!==i.sourceDomain.indexOf(u.CONSTANTS.MOCK_PROTOCOL)&&0!==i.sourceDomain.indexOf(u.CONSTANTS.FILE_PROTOCOL)||(n=i.sourceDomain),-1===l.global.receivedMessages.indexOf(i.id)){l.global.receivedMessages.push(i.id);var s=void 0;if(s=-1!==u.POST_MESSAGE_NAMES_LIST.indexOf(i.name)||i.type===u.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===i.ack?"error":"info",d.log.logLevel(s,["\n\n\t","#receive",i.type.replace(/^postrobot_message_/,""),"::",i.name,"::",n,"\n\n",i]),(0,c.isWindowClosed)(r)&&!i.fireAndForget)return void d.log.debug("Source window is closed - can not send "+i.type+" "+i.name);i.data&&(i.data=(0,d.deserializeMethods)(r,n,i.data)),f.RECEIVE_MESSAGE_TYPES[i.type](r,n,i)}}}function i(e){try{(0,d.noop)(e.source)}catch(e){return}var r={source:e.source||e.sourceElement,origin:e.origin||e.originalEvent&&e.originalEvent.origin,data:e.data};t(r)}function s(){(0,d.addEventListener)(window,"message",i)}Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.receiveMessage=t,r.messageListener=i,r.listenForMessages=s;var c=n("./node_modules/cross-domain-utils/src/index.js"),u=n("./src/conf/index.js"),d=n("./src/lib/index.js"),l=n("./src/global.js"),f=n("./src/drivers/receive/types.js");l.global.receivedMessages=l.global.receivedMessages||[],l.global.receiveMessage=t},"./src/drivers/receive/types.js":function(e,r,n){"use strict";function o(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}Object.defineProperty(r,"__esModule",{value:!0}),r.RECEIVE_MESSAGE_TYPES=void 0;var t,i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s=n("./node_modules/zalgo-promise/src/index.js"),a=n("./node_modules/cross-domain-utils/src/index.js"),c=n("./src/conf/index.js"),u=n("./src/lib/index.js"),d=n("./src/drivers/send/index.js"),l=n("./src/drivers/listeners.js");r.RECEIVE_MESSAGE_TYPES=(t={},o(t,c.CONSTANTS.POST_MESSAGE_TYPE.ACK,function(e,r,n){if(!(0,l.isResponseListenerErrored)(n.hash)){var o=(0,l.getResponseListener)(n.hash);if(!o)throw new Error("No handler found for post message ack for message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,a.matchDomain)(o.domain,r))throw new Error("Ack origin "+r+" does not match domain "+o.domain.toString());o.ack=!0}}),o(t,c.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,function(e,r,n){function o(o){return n.fireAndForget||(0,a.isWindowClosed)(e)?s.ZalgoPromise.resolve():(0,d.sendMessage)(e,i({target:n.originalSource,hash:n.hash,name:n.name},o),r)}var t=(0,l.getRequestListener)({name:n.name,win:e,domain:r});return s.ZalgoPromise.all([o({type:c.CONSTANTS.POST_MESSAGE_TYPE.ACK}),s.ZalgoPromise.try(function(){if(!t)throw new Error("No handler found for post message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,a.matchDomain)(t.domain,r))throw new Error("Request origin "+r+" does not match domain "+t.domain.toString());var o=n.data;return t.handler({source:e,origin:r,data:o})}).then(function(e){return o({type:c.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:c.CONSTANTS.POST_MESSAGE_ACK.SUCCESS,data:e})},function(e){var r=(0,u.stringifyError)(e).replace(/^Error: /,""),n=e.code;return o({type:c.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:c.CONSTANTS.POST_MESSAGE_ACK.ERROR,error:r,code:n})})]).then(u.noop).catch(function(e){if(t&&t.handleError)return t.handleError(e);u.log.error((0,u.stringifyError)(e))})}),o(t,c.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,function(e,r,n){if(!(0,l.isResponseListenerErrored)(n.hash)){var o=(0,l.getResponseListener)(n.hash);if(!o)throw new Error("No handler found for post message response for message: "+n.name+" from "+r+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!(0,a.matchDomain)(o.domain,r))throw new Error("Response origin "+r+" does not match domain "+(0,a.stringifyDomainPattern)(o.domain));if((0,l.deleteResponseListener)(n.hash),n.ack===c.CONSTANTS.POST_MESSAGE_ACK.ERROR){var t=new Error(n.error);return n.code&&(t.code=n.code),o.respond(t,null)}if(n.ack===c.CONSTANTS.POST_MESSAGE_ACK.SUCCESS){var i=n.data||n.response;return o.respond(null,{source:e,origin:r,data:i})}}}),t)},"./src/drivers/send/index.js":function(e,r,n){"use strict";function o(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,d.uniqueID)(),t=(0,d.getWindowType)(),i=(0,a.getDomain)(window);return s({},r,n,{sourceDomain:i,id:r.id||o,windowType:t})}function i(e,r,n){return c.ZalgoPromise.try(function(){r=t(e,r,{data:(0,d.serializeMethods)(e,n,r.data),domain:n});var i=void 0;if(i=-1!==u.POST_MESSAGE_NAMES_LIST.indexOf(r.name)||r.type===u.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===r.ack?"error":"info",d.log.logLevel(i,["\n\n\t","#send",r.type.replace(/^postrobot_message_/,""),"::",r.name,"::",n||u.CONSTANTS.WILDCARD,"\n\n",r]),e===window&&!u.CONFIG.ALLOW_SAME_ORIGIN)throw new Error("Attemping to send message to self");if((0,a.isWindowClosed)(e))throw new Error("Window is closed");d.log.debug("Running send message strategies",r);var s=[],f=(0,d.jsonStringify)(o({},u.CONSTANTS.WINDOW_PROPS.POSTROBOT,r),null,2);return c.ZalgoPromise.map(Object.keys(l.SEND_MESSAGE_STRATEGIES),function(r){return c.ZalgoPromise.try(function(){if(!u.CONFIG.ALLOWED_POST_MESSAGE_METHODS[r])throw new Error("Strategy disallowed: "+r);return l.SEND_MESSAGE_STRATEGIES[r](e,f,n)}).then(function(){return s.push(r+": success"),!0},function(e){return s.push(r+": "+(0,d.stringifyError)(e)+"\n"),!1})}).then(function(e){var n=e.some(Boolean),o=r.type+" "+r.name+" "+(n?"success":"error")+":\n  - "+s.join("\n  - ")+"\n";if(d.log.debug(o),!n)throw new Error(o)})})}Object.defineProperty(r,"__esModule",{value:!0});var s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};r.sendMessage=i;var a=n("./node_modules/cross-domain-utils/src/index.js"),c=n("./node_modules/zalgo-promise/src/index.js"),u=n("./src/conf/index.js"),d=n("./src/lib/index.js"),l=n("./src/drivers/send/strategies.js")},"./src/drivers/send/strategies.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SEND_MESSAGE_STRATEGIES=void 0;var o=n("./node_modules/cross-domain-utils/src/index.js"),t=n("./src/conf/index.js"),i=r.SEND_MESSAGE_STRATEGIES={};i[t.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE]=function(e,r,n){var i=void 0;i=Array.isArray(n)?n:"string"==typeof n?[n]:[t.CONSTANTS.WILDCARD],i=i.map(function(r){if(0===r.indexOf(t.CONSTANTS.MOCK_PROTOCOL)){if(window.location.protocol===t.CONSTANTS.FILE_PROTOCOL)return t.CONSTANTS.WILDCARD;if(!(0,o.isActuallySameDomain)(e))throw new Error("Attempting to send messsage to mock domain "+r+", but window is actually cross-domain");return(0,o.getActualDomain)(e)}return 0===r.indexOf(t.CONSTANTS.FILE_PROTOCOL)?t.CONSTANTS.WILDCARD:r}),i.forEach(function(n){return e.postMessage(r,n)})}},"./src/global.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.global=void 0;var o=n("./src/conf/index.js");(r.global=window[o.CONSTANTS.WINDOW_PROPS.POSTROBOT]=window[o.CONSTANTS.WINDOW_PROPS.POSTROBOT]||{}).registerSelf=function(){}},"./src/index.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("./src/interface.js");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var t=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r}(o);r.default=t},"./src/interface.js":function(e,r,n){"use strict";function o(){u.global.initialized||((0,c.listenForMessages)(),(0,a.initOnReady)(),(0,a.listenForMethods)({on:t.on,send:t.send})),u.global.initialized=!0}Object.defineProperty(r,"__esModule",{value:!0}),r.bridge=r.Promise=r.cleanUpWindow=void 0;var t=n("./src/public/index.js");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var i=n("./src/clean.js");Object.defineProperty(r,"cleanUpWindow",{enumerable:!0,get:function(){return i.cleanUpWindow}});var s=n("./node_modules/zalgo-promise/src/index.js");Object.defineProperty(r,"Promise",{enumerable:!0,get:function(){return s.ZalgoPromise}}),r.init=o;var a=n("./src/lib/index.js"),c=n("./src/drivers/index.js"),u=n("./src/global.js"),d=n("./src/bridge/interface.js");(function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);r.default=e})(d),r.bridge=null;o()},"./src/lib/index.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=n("./src/lib/util.js");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var t=n("./src/lib/log.js");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var i=n("./src/lib/serialize.js");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var s=n("./src/lib/ready.js");Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}})})},"./src/lib/log.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.log=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=n("./src/conf/index.js"),i=n("./src/lib/util.js"),s=["debug","info","warn","error"];Function.prototype.bind&&window.console&&"object"===o(console.log)&&["log","info","warn","error"].forEach(function(e){console[e]=this.bind(console[e],console)},Function.prototype.call);var a=r.log={clearLogs:function(){if(window.console&&window.console.clear&&window.console.clear(),t.CONFIG.LOG_TO_PAGE){var e=document.getElementById("postRobotLogs");e&&e.parentNode&&e.parentNode.removeChild(e)}},writeToPage:function(e,r){setTimeout(function(){var n=document.getElementById("postRobotLogs");n||(n=document.createElement("div"),n.id="postRobotLogs",n.style.cssText="width: 800px; font-family: monospace; white-space: pre-wrap;",document.body&&document.body.appendChild(n));var o=document.createElement("div"),t=(new Date).toString().split(" ")[4],s=Array.prototype.slice.call(r).map(function(e){if("string"==typeof e)return e;if(!e)return Object.prototype.toString.call(e);var r=void 0;try{r=(0,i.jsonStringify)(e,null,2)}catch(e){r="[object]"}return"\n\n"+r+"\n\n"}).join(" "),a=t+" "+e+" "+s;o.innerHTML=a;var c={log:"#ddd",warn:"orange",error:"red",info:"blue",debug:"#aaa"}[e];o.style.cssText="margin-top: 10px; color: "+c+";",n.childNodes.length?n.insertBefore(o,n.childNodes[0]):n.appendChild(o)})},logLevel:function(e,r){setTimeout(function(){try{var n=window.LOG_LEVEL||t.CONFIG.LOG_LEVEL;if("disabled"===n||s.indexOf(e)<s.indexOf(n))return;if(r=Array.prototype.slice.call(r),r.unshift(""+window.location.host+window.location.pathname),r.unshift("::"),r.unshift(""+(0,i.getWindowType)().toLowerCase()),r.unshift("[post-robot]"),t.CONFIG.LOG_TO_PAGE&&a.writeToPage(e,r),!window.console)return;if(window.console[e]||(e="log"),!window.console[e])return;window.console[e].apply(window.console,r)}catch(e){}},1)},debug:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];a.logLevel("debug",r)},info:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];a.logLevel("info",r)},warn:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];a.logLevel("warn",r)},error:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];a.logLevel("error",r)}}},"./src/lib/ready.js":function(e,r,n){"use strict";function o(e){l.global.on(d.CONSTANTS.POST_MESSAGE_NAMES.HELLO,{domain:d.CONSTANTS.WILDCARD},function(r){var n=r.source,o=r.origin;return e({source:n,origin:o})})}function t(e){return l.global.send(e,d.CONSTANTS.POST_MESSAGE_NAMES.HELLO,{},{domain:d.CONSTANTS.WILDCARD,timeout:1/0}).then(function(e){return{origin:e.origin}})}function i(){o(function(e){var r=e.source,n=e.origin,o=l.global.readyPromises.get(r)||new u.ZalgoPromise;o.resolve({origin:n}),l.global.readyPromises.set(r,o)});var e=(0,c.getAncestor)();e&&t(e).catch(function(e){f.log.debug((0,m.stringifyError)(e))})}function s(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Window",o=l.global.readyPromises.get(e);return o||(o=new u.ZalgoPromise,l.global.readyPromises.set(e,o),-1!==r&&setTimeout(function(){return o.reject(new Error(n+" did not load after "+r+"ms"))},r),o)}Object.defineProperty(r,"__esModule",{value:!0}),r.onHello=o,r.sayHello=t,r.initOnReady=i,r.onChildWindowReady=s;var a=n("./node_modules/cross-domain-safe-weakmap/src/index.js"),c=n("./node_modules/cross-domain-utils/src/index.js"),u=n("./node_modules/zalgo-promise/src/index.js"),d=n("./src/conf/index.js"),l=n("./src/global.js"),f=n("./src/lib/log.js"),m=n("./src/lib/util.js");l.global.readyPromises=l.global.readyPromises||new a.WeakMap},"./src/lib/serialize.js":function(e,r,n){"use strict";function o(e,r){return"object"===(void 0===e?"undefined":w(e))&&null!==e&&e.__type__===r}function t(e,r,n,o){var t=(0,O.uniqueID)(),i=_.global.methods.get(e);return i||(i={},_.global.methods.set(e,i)),i[t]={domain:r,method:n},{__type__:h.CONSTANTS.SERIALIZATION_TYPES.METHOD,__id__:t,__name__:o}}function i(e){return{__type__:h.CONSTANTS.SERIALIZATION_TYPES.ERROR,__message__:(0,O.stringifyError)(e),__code__:e.code}}function s(e,r,n,o){return{__type__:h.CONSTANTS.SERIALIZATION_TYPES.PROMISE,__then__:t(e,r,function(e,r){return n.then(e,r)},o+".then")}}function a(e,r,n,o){return{__type__:h.CONSTANTS.SERIALIZATION_TYPES.ZALGO_PROMISE,__then__:t(e,r,function(e,r){return n.then(e,r)},o+".then")}}function c(e){return{__type__:h.CONSTANTS.SERIALIZATION_TYPES.REGEX,__source__:e.source}}function u(e,r,n){return(0,O.replaceObject)({obj:n},function(n,o){return"function"==typeof n?t(e,r,n,o.toString()):n instanceof Error?i(n):window.Promise&&n instanceof window.Promise?s(e,r,n,o.toString()):v.ZalgoPromise.isPromise(n)?a(e,r,n,o.toString()):(0,O.isRegex)(n)?c(n):void 0}).obj}function d(e,r,n){function o(){var o=Array.prototype.slice.call(arguments);return S.log.debug("Call foreign method",n.__name__,o),_.global.send(e,h.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{id:n.__id__,name:n.__name__,args:o},{domain:r,timeout:1/0}).then(function(e){var r=e.data;return S.log.debug("Got foreign method result",n.__name__,r.result),r.result},function(e){throw S.log.debug("Got foreign method error",(0,O.stringifyError)(e)),e})}return o.__name__=n.__name__,o.__xdomain__=!0,o.source=e,o.origin=r,o}function l(e,r,n){var o=new Error(n.__message__);return n.__code__&&(o.code=n.__code__),o}function f(e,r,n){return new v.ZalgoPromise(function(o,t){return d(e,r,n.__then__)(o,t)})}function m(e,r,n){return window.Promise?new window.Promise(function(o,t){return d(e,r,n.__then__)(o,t)}):f(e,r,n)}function g(e,r,n){return new RegExp(n.__source__)}function p(e,r,n){return(0,O.replaceObject)({obj:n},function(n){if("object"===(void 0===n?"undefined":w(n))&&null!==n)return o(n,h.CONSTANTS.SERIALIZATION_TYPES.METHOD)?d(e,r,n):o(n,h.CONSTANTS.SERIALIZATION_TYPES.ERROR)?l(e,r,n):o(n,h.CONSTANTS.SERIALIZATION_TYPES.PROMISE)?m(e,r,n):o(n,h.CONSTANTS.SERIALIZATION_TYPES.ZALGO_PROMISE)?f(e,r,n):o(n,h.CONSTANTS.SERIALIZATION_TYPES.REGEX)?g(e,r,n):void 0}).obj}Object.defineProperty(r,"__esModule",{value:!0}),r.listenForMethods=void 0;var w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.serializeMethod=t,r.serializeMethods=u,r.deserializeMethod=d,r.deserializeError=l,r.deserializeZalgoPromise=f,r.deserializePromise=m,r.deserializeRegex=g,r.deserializeMethods=p;var b=n("./node_modules/cross-domain-safe-weakmap/src/index.js"),y=n("./node_modules/cross-domain-utils/src/index.js"),v=n("./node_modules/zalgo-promise/src/index.js"),h=n("./src/conf/index.js"),_=n("./src/global.js"),O=n("./src/lib/util.js"),S=n("./src/lib/log.js");_.global.methods=_.global.methods||new b.WeakMap;r.listenForMethods=(0,O.once)(function(){_.global.on(h.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{origin:h.CONSTANTS.WILDCARD},function(e){var r=e.source,n=e.origin,o=e.data,t=_.global.methods.get(r);if(!t)throw new Error("Could not find any methods this window has privileges to call");var i=t[o.id];if(!i)throw new Error("Could not find method with id: "+o.id);if(!(0,y.matchDomain)(i.domain,n))throw new Error("Method domain "+i.domain+" does not match origin "+n);return S.log.debug("Call local method",o.name,o.args),v.ZalgoPromise.try(function(){return i.method.apply({source:r,origin:n,data:o},o.args)}).then(function(e){return{result:e,id:o.id,name:o.name}})})})},"./src/lib/util.js":function(e,r,n){"use strict";function o(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(r>=3)return"stringifyError stack overflow";try{if(!e)return"<unknown error: "+Object.prototype.toString.call(e)+">";if("string"==typeof e)return e;if(e instanceof Error){var n=e&&e.stack,t=e&&e.message;if(n&&t)return-1!==n.indexOf(t)?n:t+"\n"+n;if(n)return n;if(t)return t}return"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e)}catch(e){return"Error while stringifying error: "+o(e,r+1)}}function t(){}function i(e,r,n){return e.addEventListener?e.addEventListener(r,n):e.attachEvent("on"+r,n),{cancel:function(){e.removeEventListener?e.removeEventListener(r,n):e.detachEvent("on"+r,n)}}}function s(){var e="0123456789abcdef";return"xxxxxxxxxx".replace(/./g,function(){return e.charAt(Math.floor(Math.random()*e.length))})}function a(e,r){for(var n=0;n<e.length;n++)r(e[n],n)}function c(e,r){for(var n in e)e.hasOwnProperty(n)&&r(e[n],n)}function u(e,r){Array.isArray(e)?a(e,r):"object"===(void 0===e?"undefined":w(e))&&null!==e&&c(e,r)}function d(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(n>=100)throw new Error("Self-referential object passed, or object contained too many layers");var o=void 0;if("object"!==(void 0===e?"undefined":w(e))||null===e||Array.isArray(e)){if(!Array.isArray(e))throw new TypeError("Invalid type: "+(void 0===e?"undefined":w(e)));o=[]}else o={};return u(e,function(e,t){var i=r(e,t);void 0!==i?o[t]=i:"object"===(void 0===e?"undefined":w(e))&&null!==e?o[t]=d(e,r,n+1):o[t]=e}),o}function l(e,r){function n(){o=setTimeout(n,r),e.call()}var o=void 0;return o=setTimeout(n,r),{cancel:function(){clearTimeout(o)}}}function f(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function m(){return(0,y.isPopup)()?v.CONSTANTS.WINDOW_TYPES.POPUP:(0,y.isIframe)()?v.CONSTANTS.WINDOW_TYPES.IFRAME:v.CONSTANTS.WINDOW_TYPES.FULLPAGE}function g(e,r,n){var o=void 0,t=void 0;try{if("{}"!==JSON.stringify({})&&(o=Object.prototype.toJSON,delete Object.prototype.toJSON),"{}"!==JSON.stringify({}))throw new Error("Can not correctly serialize JSON objects");if("[]"!==JSON.stringify([])&&(t=Array.prototype.toJSON,delete Array.prototype.toJSON),"[]"!==JSON.stringify([]))throw new Error("Can not correctly serialize JSON objects")}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}var i=JSON.stringify.call(this,e,r,n);try{o&&(Object.prototype.toJSON=o),t&&(Array.prototype.toJSON=t)}catch(e){throw new Error("Can not repair JSON.stringify: "+e.message)}return i}function p(e){return JSON.parse(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.weakMapMemoize=r.once=void 0;var w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.stringifyError=o,r.noop=t,r.addEventListener=i,r.uniqueID=s,r.eachArray=a,r.eachObject=c,r.each=u,r.replaceObject=d,r.safeInterval=l,r.isRegex=f,r.getWindowType=m,r.jsonStringify=g,r.jsonParse=p;var b=n("./node_modules/cross-domain-safe-weakmap/src/index.js"),y=n("./node_modules/cross-domain-utils/src/index.js"),v=n("./src/conf/index.js");r.once=function(e){if(!e)return e;var r=!1;return function(){if(!r)return r=!0,e.apply(this,arguments)}},r.weakMapMemoize=function(e){var r=new b.WeakMap;return function(n){var o=r.get(n);return void 0!==o?o:(o=e.call(this,n),void 0!==o&&r.set(n,o),o)}}},"./src/public/client.js":function(e,r,n){"use strict";function o(e){return c.ZalgoPromise.try(function(){if(!e.name)throw new Error("Expected options.name");var r=e.name,n=void 0,o=void 0;if("string"==typeof e.window){var t=document.getElementById(e.window);if(!t)throw new Error("Expected options.window "+Object.prototype.toString.call(e.window)+" to be a valid element id");if("iframe"!==t.tagName.toLowerCase())throw new Error("Expected options.window "+Object.prototype.toString.call(e.window)+" to be an iframe");if(!t.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");n=t.contentWindow}else if(e.window instanceof HTMLIFrameElement){if("iframe"!==e.window.tagName.toLowerCase())throw new Error("Expected options.window "+Object.prototype.toString.call(e.window)+" to be an iframe");if(e.window&&!e.window.contentWindow)throw new Error("Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.");e.window&&e.window.contentWindow&&(n=e.window.contentWindow)}else n=e.window;if(!n)throw new Error("Expected options.window to be a window object, iframe, or iframe element id.");var i=n;o=e.domain||d.CONSTANTS.WILDCARD;var s=e.name+"_"+(0,f.uniqueID)();if((0,u.isWindowClosed)(i))throw new Error("Target window is closed");var a=!1,g=m.global.requestPromises.get(i);g||(g=[],m.global.requestPromises.set(i,g));var p=c.ZalgoPromise.try(function(){if((0,u.isAncestor)(window,i))return(0,f.onChildWindowReady)(i,e.timeout||d.CONFIG.CHILD_WINDOW_TIMEOUT)}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.origin;if((0,f.isRegex)(o)&&!r)return(0,f.sayHello)(i)}).then(function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.origin;if((0,f.isRegex)(o)){if(!(0,u.matchDomain)(o,t))throw new Error("Remote window domain "+t+" does not match regex: "+o.toString());o=t}if("string"!=typeof o&&!Array.isArray(o))throw new TypeError("Expected domain to be a string or array");var m=o;return new c.ZalgoPromise(function(n,o){var t=void 0;if(e.fireAndForget||(t={name:r,window:i,domain:m,respond:function(e,r){e||(a=!0,g.splice(g.indexOf(p,1))),e?o(e):n(r)}},(0,l.addResponseListener)(s,t)),(0,l.sendMessage)(i,{type:d.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,hash:s,name:r,data:e.data,fireAndForget:e.fireAndForget},m).catch(o),e.fireAndForget)return n();var c=d.CONFIG.ACK_TIMEOUT,f=e.timeout||d.CONFIG.RES_TIMEOUT,w=100,b=function n(){if(!a){if((0,u.isWindowClosed)(i))return o(t.ack?new Error("Window closed for "+r+" before response"):new Error("Window closed for "+r+" before ack"));c-=w,f-=w;if(t.ack){if(f===1/0)return;w=Math.min(f,2e3)}else{if(c<=0)return o(new Error("No ack for postMessage "+r+" in "+(0,u.getDomain)()+" in "+d.CONFIG.ACK_TIMEOUT+"ms"));if(f<=0)return o(new Error("No response for postMessage "+r+" in "+(0,u.getDomain)()+" in "+(e.timeout||d.CONFIG.RES_TIMEOUT)+"ms"))}setTimeout(n,w)}};setTimeout(b,w)})});return p.catch(function(){(0,l.markResponseListenerErrored)(s),(0,l.deleteResponseListener)(s)}),g.push(p),p})}function t(e,r,n,t){return t=t||{},t.window=e,t.name=r,t.data=n,o(t)}function i(e,r,n){var o=(0,u.getAncestor)();return o?t(o,e,r,n):new c.ZalgoPromise(function(e,r){return r(new Error("Window does not have a parent"))})}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.window)throw new Error("Expected options.window");var r=e.window;return{send:function(n,o){return t(r,n,o,e)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.send=void 0,r.request=o,r.sendToParent=i,r.client=s;var a=n("./node_modules/cross-domain-safe-weakmap/src/index.js"),c=n("./node_modules/zalgo-promise/src/index.js"),u=n("./node_modules/cross-domain-utils/src/index.js"),d=n("./src/conf/index.js"),l=n("./src/drivers/index.js"),f=n("./src/lib/index.js"),m=n("./src/global.js");m.global.requestPromises=m.global.requestPromises||new a.WeakMap,r.send=t,m.global.send=t},"./src/public/config.js":function(e,r,n){"use strict";function o(){delete window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT],window.removeEventListener("message",i.messageListener)}Object.defineProperty(r,"__esModule",{value:!0}),r.CONSTANTS=r.CONFIG=void 0;var t=n("./src/conf/index.js");Object.defineProperty(r,"CONFIG",{enumerable:!0,get:function(){return t.CONFIG}}),Object.defineProperty(r,"CONSTANTS",{enumerable:!0,get:function(){return t.CONSTANTS}}),r.disable=o;var i=n("./src/drivers/index.js")},"./src/public/index.js":function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parent=void 0;var o=n("./src/public/client.js");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})});var t=n("./src/public/server.js");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return t[e]}})});var i=n("./src/public/config.js");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var s=n("./node_modules/cross-domain-utils/src/index.js");r.parent=(0,s.getAncestor)()},"./src/public/server.js":function(e,r,n){"use strict";function o(e){if(!e.name)throw new Error("Expected options.name");if(!e.handler)throw new Error("Expected options.handler");var r=e.name,n=e.window,o=e.domain,t={handler:e.handler,handleError:e.errorHandler||function(e){throw e},window:n,domain:o||f.CONSTANTS.WILDCARD,name:r},i=(0,l.addRequestListener)({name:r,win:n,domain:o},t);if(e.once){var s=t.handler;t.handler=(0,d.once)(function(){return i.cancel(),s.apply(this,arguments)})}if(t.window&&e.errorOnClose)var u=(0,d.safeInterval)(function(){n&&"object"===(void 0===n?"undefined":a(n))&&(0,c.isWindowClosed)(n)&&(u.cancel(),t.handleError(new Error("Post message target window is closed")))},50);return{cancel:function(){i.cancel()}}}function t(e,r,n){return"function"==typeof r&&(n=r,r={}),r=r||{},r.name=e,r.handler=n||r.handler,o(r)}function i(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];"function"==typeof r&&(n=r,r={}),r=r||{},n=n||r.handler;var t=r.errorHandler,i=new u.ZalgoPromise(function(o,i){r=r||{},r.name=e,r.once=!0,r.handler=function(e){if(o(e),n)return n(e)},r.errorHandler=function(e){if(i(e),t)return t(e)}}),s=o(r);return i.cancel=s.cancel,i}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{on:function(r,n){return t(r,e,n)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.on=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.listen=o,r.once=i,r.listener=s;var c=n("./node_modules/cross-domain-utils/src/index.js"),u=n("./node_modules/zalgo-promise/src/index.js"),d=n("./src/lib/index.js"),l=n("./src/drivers/index.js"),f=n("./src/conf/index.js"),m=n("./src/global.js");r.on=t,m.global.on=t}})});
//# sourceMappingURL=post-robot.min.js.map
//# sourceMappingURL=post-robot.min.js.map