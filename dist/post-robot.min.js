!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("postRobot",[],n):"object"==typeof exports?exports.postRobot=n():e.postRobot=n()}(this,function(){return function(e){function n(t){if(r[t])return r[t].exports;var o=r[t]={exports:{},id:t,loaded:!1};return e[t].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var r={};return n.m=e,n.c=r,n.p="",n(0)}([function(e,n,r){"use strict";function t(){s.global.initialized||((0,u.listenForMessages)(),(0,c.openTunnelToOpener)(),(0,a.initOnReady)(),(0,a.listenForMethods)()),s.global.initialized=!0}function o(){return s.global.clean.all().then(function(){return s.global.initialized=!1,t()})}Object.defineProperty(n,"__esModule",{value:!0}),n.Promise=void 0,n.init=t,n.reset=o;var i=r(1);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(8);Object.defineProperty(n,"Promise",{enumerable:!0,get:function(){return a.Promise}});var u=r(6),s=r(15),c=r(24);t(),n["default"]=e.exports},function(e,n,r){"use strict";function t(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n["default"]=e,n}Object.defineProperty(n,"__esModule",{value:!0}),n.winutil=n.util=n.destroyBridges=n.openTunnelToOpener=n.needsBridgeForDomain=n.needsBridgeForWin=n.needsBridgeForBrowser=n.needsBridge=n.isBridge=n.linkUrl=n.openBridge=n.parent=void 0;var o=r(2);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(30);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(31);Object.keys(a).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}})});var u=r(24);Object.defineProperty(n,"openBridge",{enumerable:!0,get:function(){return u.openBridge}}),Object.defineProperty(n,"linkUrl",{enumerable:!0,get:function(){return u.linkUrl}}),Object.defineProperty(n,"isBridge",{enumerable:!0,get:function(){return u.isBridge}}),Object.defineProperty(n,"needsBridge",{enumerable:!0,get:function(){return u.needsBridge}}),Object.defineProperty(n,"needsBridgeForBrowser",{enumerable:!0,get:function(){return u.needsBridgeForBrowser}}),Object.defineProperty(n,"needsBridgeForWin",{enumerable:!0,get:function(){return u.needsBridgeForWin}}),Object.defineProperty(n,"needsBridgeForDomain",{enumerable:!0,get:function(){return u.needsBridgeForDomain}}),Object.defineProperty(n,"openTunnelToOpener",{enumerable:!0,get:function(){return u.openTunnelToOpener}}),Object.defineProperty(n,"destroyBridges",{enumerable:!0,get:function(){return u.destroyBridges}});var s=r(12);Object.defineProperty(n,"util",{enumerable:!0,get:function(){return s.util}});var c=r(14),d=t(c);n.parent=(0,c.getAncestor)(),n.winutil=d},function(e,n,r){"use strict";function t(e){return d.promise.nodeify(new d.promise.Promise(function(n,r){if(!e.name)throw new Error("Expected options.name");if(!e.window)throw new Error("Expected options.window");if(u.CONFIG.MOCK_MODE)e.window=window;else if("string"==typeof e.window){var t=document.getElementById(e.window);if(!t)throw new Error("Expected options.window "+e.window+" to be a valid element id");if("iframe"!==t.tagName.toLowerCase())throw new Error("Expected options.window "+e.window+" to be an iframe");if(e.window=t.contentWindow,!e.window)throw new Error("Expected options.window")}e.domain=e.domain||"*";var o=e.name+"_"+d.util.uniqueID();if(c.global.clean.setItem(c.global.listeners.response,o,e),(0,d.isWindowClosed)(e.window))throw new Error("Target window is closed");var i=!1;return e.respond=function(e,t){return e||(i=!0),e?r(e):n(t)},d.promise.run(function(){return(0,d.isAncestor)(window,e.window)?(0,d.onWindowReady)(e.window):void 0}).then(function(){if((0,s.sendMessage)(e.window,{hash:o,type:u.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,name:e.name,data:e.data,fireAndForget:e.fireAndForget},e.domain)["catch"](r),e.fireAndForget)return n();var t=d.util.intervalTimeout(u.CONFIG.ACK_TIMEOUT,100,function(n){return e.ack||(0,d.isWindowClosed)(e.window)?t.cancel():n?void 0:r(new Error("No ack for postMessage "+e.name+" in "+u.CONFIG.ACK_TIMEOUT+"ms"))});e.timeout&&!function(){var n=d.util.intervalTimeout(e.timeout,100,function(t){return i||(0,d.isWindowClosed)(e.window)?n.cancel():t?void 0:r(new Error("Post message response timed out after "+e.timeout+" ms"))},e.timeout)}()})["catch"](r)}),e.callback)}function o(e,n,r,o,i){return i||(o||"function"!=typeof r?"function"==typeof o&&(i=o,o={}):(i=r,o={},r={})),o=o||{},o.window=e,o.name=n,o.data=r,o.callback=i,t(o)}function i(e,n,r,t){var i=(0,d.getAncestor)();return i?o(i,e,n,r,t):new d.promise.Promise(function(e,n){return n(new Error("Window does not have a parent"))})}function a(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!e.window)throw new Error("Expected options.window");return{send:function(n,r,t){return o(e.window,n,r,e,t)}}}Object.defineProperty(n,"__esModule",{value:!0}),n.send=void 0,n.request=t,n.sendToParent=i,n.client=a;var u=r(3),s=r(6),c=r(15),d=r(8);n.send=o},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(4);Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})});var o=r(5);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,n,r){"use strict";function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}Object.defineProperty(n,"__esModule",{value:!0}),n.CONFIG=void 0;var o,i=r(5),a=n.CONFIG={ALLOW_POSTMESSAGE_POPUP:!1,LOG_LEVEL:"info",BRIDGE_TIMEOUT:5e3,ACK_TIMEOUT:1e3,LOG_TO_PAGE:!1,MOCK_MODE:!1,ALLOWED_POST_MESSAGE_METHODS:(o={},t(o,i.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE,!0),t(o,i.CONSTANTS.SEND_STRATEGIES.BRIDGE,!0),t(o,i.CONSTANTS.SEND_STRATEGIES.GLOBAL,!0),o)};0===window.location.href.indexOf(i.CONSTANTS.FILE_PROTOCOL)&&(a.ALLOW_POSTMESSAGE_POPUP=!0)},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=n.CONSTANTS={POST_MESSAGE_TYPE:{REQUEST:"postrobot_message_request",RESPONSE:"postrobot_message_response",ACK:"postrobot_message_ack"},POST_MESSAGE_ACK:{SUCCESS:"success",ERROR:"error"},POST_MESSAGE_NAMES:{METHOD:"postrobot_method",READY:"postrobot_ready",OPEN_TUNNEL:"postrobot_open_tunnel"},WINDOW_TYPES:{FULLPAGE:"fullpage",POPUP:"popup",IFRAME:"iframe"},WINDOW_PROPS:{POSTROBOT:"__postRobot__"},SERIALIZATION_TYPES:{METHOD:"postrobot_method"},SEND_STRATEGIES:{POST_MESSAGE:"postrobot_post_message",BRIDGE:"postrobot_bridge",GLOBAL:"postrobot_global"},MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",BRIDGE_NAME_PREFIX:"__postrobot_bridge__",POSTROBOT_PROXY:"__postrobot_proxy__"};n.POST_MESSAGE_NAMES_LIST=Object.keys(r.POST_MESSAGE_NAMES).map(function(e){return r.POST_MESSAGE_NAMES[e]})},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(7);Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})});var o=r(22);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(29);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,n,r){"use strict";function t(e){try{e=(0,s.jsonParse)(e)}catch(n){return}if(e&&(e=e[u.CONSTANTS.WINDOW_PROPS.POSTROBOT],e&&e.type&&f.RECEIVE_MESSAGE_TYPES[e.type]))return e}function o(e){if(!window||window.closed)throw new Error("Message recieved in closed window");try{if(!e.source)return}catch(n){return}var r=e.source,o=e.origin,i=e.data,a=t(i);if(a&&(0!==a.sourceDomain.indexOf(u.CONSTANTS.MOCK_PROTOCOL)&&0!==a.sourceDomain.indexOf(u.CONSTANTS.FILE_PROTOCOL)||(o=a.sourceDomain),-1===d.global.receivedMessages.indexOf(a.id))){d.global.clean.push(d.global.receivedMessages,a.id);var c=void 0;if(c=-1!==u.POST_MESSAGE_NAMES_LIST.indexOf(a.name)||a.type===u.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===a.ack?"error":"info",s.log.logLevel(c,["\n\n	","#receive",a.type.replace(/^postrobot_message_/,""),"::",a.name,"::",o,"\n\n",a]),(0,s.isWindowClosed)(r))return s.log.debug("Source window is closed - can not send "+a.type+" "+a.name);a.data&&(a.data=(0,s.deserializeMethods)(r,o,a.data)),f.RECEIVE_MESSAGE_TYPES[a.type](r,o,a)}}function i(e){try{e.source}catch(n){return}e={source:e.source||e.sourceElement,origin:e.origin||e.originalEvent.origin,data:e.data};try{(0,c.emulateIERestrictions)(e.source,window)}catch(n){return}o(e)}function a(){var e=s.util.listen(window,"message",i);d.global.clean.register("listener",function(){e.cancel()})}Object.defineProperty(n,"__esModule",{value:!0}),n.receiveMessage=o,n.messageListener=i,n.listenForMessages=a;var u=r(3),s=r(8),c=r(19),d=r(15),f=r(21);d.global.receivedMessages=d.global.receivedMessages||[]},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(9);Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})});var o=r(12);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(13);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(14);Object.keys(a).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}})});var u=r(17);Object.keys(u).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return u[e]}})});var s=r(11);Object.keys(s).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[e]}})});var c=r(18);Object.keys(c).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return c[e]}})});var d=r(16);Object.keys(d).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return d[e]}})})},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.promise=n.Promise=void 0;var t=r(10),o=r(11),i=n.Promise=t.SyncPromise,a=n.promise={Promise:i,run:function(e){return i.resolve().then(e)},nextTick:function(e){return new i(function(n,r){(0,o.nextTick)(function(){return a.run(e).then(n,r)})})},method:function(e){return function(){var n=this,r=arguments;return i.resolve().then(function(){return e.apply(n,r)})}},nodeify:function(e,n){return n?void e.then(function(e){n(null,e)},function(e){n(e)}):e},deNodeify:function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),t=1;n>t;t++)r[t-1]=arguments[t];return new i(function(n,t){try{return r.length<e.length?e.apply(void 0,r.concat([function(e,r){return e?t(e):n(r)}])):a.run(function(){return e.apply(void 0,r)}).then(n,t)}catch(o){return t(o)}})},map:function(e,n){for(var r=[],t=function(t){r.push(a.run(function(){return n(e[t])}))},o=0;o<e.length;o++)t(o);return i.all(r)}}},function(e,n){"use strict";function r(e,n,r){function t(){if(a){if(s)return r(o);if(u)return n(i)}}var o,i,a=!1,u=!1,s=!1;try{e(function(e){i=e,u=!0,t()},function(e){o=e,s=!0,t()})}catch(c){return r(c)}a=!0,t()}function t(e){d.push(e),s=s||setTimeout(o,1)}function o(){s=null;var e=d;d=[];for(var n=0;n<e.length;n++){var r=e[n];r.hasHandlers||(r.handlers.push({onError:function(e){if(!r.hasHandlers){i(e);for(var n=0;n<c.length;n++)c[n](r.value)}}}),r.dispatch())}}function i(e){-1===f.indexOf(e)&&(f.push(e),setTimeout(function(){throw e},1))}function a(e){try{if(!e)return!1;if(window.Window&&e instanceof window.Window)return!1;if(window.constructor&&e instanceof window.constructor)return!1;if(l){var n=l.call(e);if("[object Window]"===n||"[object global]"===n||"[object DOMWindow]"===n)return!1}if(e&&e.then instanceof Function)return!0}catch(r){return!1}return!1}function u(){window.Promise=m}Object.defineProperty(n,"__esModule",{value:!0}),n.patchPromise=u;var s,c=[],d=[],f=[],l={}.toString,m=n.SyncPromise=function(e){if(this.resolved=!1,this.rejected=!1,this.hasHandlers=!1,this.handlers=[],t(this),e){var n=this;r(e,function(e){return n.resolve(e)},function(e){return n.reject(e)})}};m.resolve=function(e){return a(e)?e:(new m).resolve(e)},m.reject=function(e){return(new m).reject(e)},m.prototype.resolve=function(e){if(this.resolved||this.rejected)return this;if(a(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this},m.prototype.reject=function(e){if(this.resolved||this.rejected)return this;if(a(e))throw new Error("Can not reject promise with another promise");return this.rejected=!0,this.value=e,this.dispatch(),this},m.prototype.asyncReject=function(e){return this.hasHandlers=!0,this.reject(e)},m.prototype.dispatch=function(){var e=this;if(this.resolved||this.rejected)for(var n=function(){var n=e.handlers.shift();try{e.resolved?r=n.onSuccess?n.onSuccess(e.value):e.value:n.onError?r=n.onError(e.value):t=e.value}catch(o){t=o}if(r===e)throw new Error("Can not return a promise from the the then handler of the same promise");return n.promise?void(t?n.promise.reject(t):a(r)?r.then(function(e){n.promise.resolve(e)},function(e){n.promise.reject(e)}):n.promise.resolve(r)):"continue"};this.handlers.length;){var r,t;n()}},m.prototype.then=function(e,n){if(e&&"function"!=typeof e&&!e.call)throw new Error("Promise.then expected a function for success handler");if(n&&"function"!=typeof n&&!n.call)throw new Error("Promise.then expected a function for error handler");var r=new m(null,this);return this.handlers.push({promise:r,onSuccess:e,onError:n}),this.hasHandlers=!0,this.dispatch(),r},m.prototype["catch"]=function(e){return this.then(null,e)},m.prototype["finally"]=function(e){return this.then(function(n){return m["try"](e).then(function(){return n})},function(n){return m["try"](e).then(function(){throw n})})},m.all=function(e){for(var n=new m,r=e.length,t=[],o=function(o){var i=a(e[o])?e[o]:m.resolve(e[o]);i.then(function(e){t[o]=e,r-=1,0===r&&n.resolve(t)},function(e){n.reject(e)})},i=0;i<e.length;i++)o(i);return r||n.resolve(t),n},m.onPossiblyUnhandledException=function(e){c.push(e)},m["try"]=function(e){return m.resolve().then(e)},m.delay=function(e){return new m(function(n){setTimeout(n,e)})},m.hash=function(e){var n={},r=[];for(var t in e)e.hasOwnProperty(t)&&r.push(m.resolve(e[t]).then(function(e){n[t]=e}));return m.all(r).then(function(){return n})}},function(e,n,r){"use strict";function t(e){a.push(e),window.postMessage(i,"*")}Object.defineProperty(n,"__esModule",{value:!0}),n.nextTick=t;var o=r(12),i="__nextTick__postRobot__"+o.util.uniqueID(),a=[];window.addEventListener("message",function(e){if(e.data===i){var n=a.shift();n.call()}})},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.util=void 0;var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=r(3),i=n.util={once:function(e){if(!e)return e;var n=!1;return function(){return n?void 0:(n=!0,e.apply(this,arguments))}},noop:function(){},safeHasProp:function(e,n){try{return!!e[n]}catch(r){return!1}},safeGetProp:function(e,n){try{return e[n]}catch(r){return}},listen:function(e,n,r){return e.addEventListener?e.addEventListener(n,r):e.attachEvent("on"+n,r),{cancel:function(){e.removeEventListener?e.removeEventListener(n,r):e.detachEvent("on"+n,r)}}},apply:function(e,n,r){return"function"==typeof e.apply?e.apply(n,r):e(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9])},find:function(e,n,r){if(!e)return r;for(var t=0;t<e.length;t++)if(n(e[t]))return e[t];return r},map:function(e,n){for(var r=[],t=0;t<e.length;t++)r.push(n(e[t]));return r},some:function(e,n){n=n||Boolean;for(var r=0;r<e.length;r++)if(n(e[r]))return!0;return!1},keys:function(e){var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(r);return n},values:function(e){var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(e[r]);return n},getByValue:function(e,n){for(var r in e)if(e.hasOwnProperty(r)&&e[r]===n)return r},uniqueID:function(){var e="0123456789abcdef";return"xxxxxxxxxx".replace(/./g,function(){return e.charAt(Math.floor(Math.random()*e.length))})},memoize:function(e){var n={};return function(){var r=JSON.stringify(Array.prototype.slice.call(arguments));return n.hasOwnProperty(r)||(n[r]=e.apply(this,arguments)),n[r]}},extend:function(e,n){if(!n)return e;for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);return e},each:function(e,n){if(Array.isArray(e))for(var r=0;r<e.length;r++)n(e[r],r);else if("object"===("undefined"==typeof e?"undefined":t(e))&&null!==e)for(var o in e)e.hasOwnProperty(o)&&n(e[o],o)},replaceObject:function(e,n){var r=arguments.length<=2||void 0===arguments[2]?1:arguments[2];if(r>=100)throw new Error("Self-referential object passed, or object contained too many layers");var o=Array.isArray(e)?[]:{};return i.each(e,function(e,a){var u=n(e,a);void 0!==u?o[a]=u:"object"===("undefined"==typeof e?"undefined":t(e))&&null!==e?o[a]=i.replaceObject(e,n,r+1):o[a]=e}),o},safeInterval:function(e,n){function r(){t=setTimeout(r,n),e.call()}var t=void 0;return t=setTimeout(r,n),{cancel:function(){clearTimeout(t)}}},intervalTimeout:function(e,n,r){var t=i.safeInterval(function(){e-=n,e=0>=e?0:e,0===e&&t.cancel(),r(e)},n);return t},getDomain:function(e){if(e=e||window,e.mockDomain&&0===e.mockDomain.indexOf(o.CONSTANTS.MOCK_PROTOCOL))return e.mockDomain;if(!e.location.protocol)throw new Error("Can not read window protocol");if(e.location.protocol===o.CONSTANTS.FILE_PROTOCOL)return e.location.protocol+"//"+e.location.host;if(!e.location.host)throw new Error("Can not read window host");return e.location.protocol+"//"+e.location.host},getDomainFromUrl:function(e){var n=void 0;return e.match(/^(https?|mock|file):\/\//)?(n=e,n=n.split("/").slice(0,3).join("/")):this.getDomain()},safeGet:function(e,n){var r=void 0;try{r=e[n]}catch(t){}return r}}},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.log=void 0;var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=r(12),i=r(14),a=r(3),u=["debug","info","warn","error"];Function.prototype.bind&&window.console&&"object"===t(console.log)&&["log","info","warn","error"].forEach(function(e){console[e]=this.bind(console[e],console)},Function.prototype.call);var s=n.log={clearLogs:function(){if(window.console&&window.console.clear&&window.console.clear(),a.CONFIG.LOG_TO_PAGE){var e=document.getElementById("postRobotLogs");e&&e.parentNode.removeChild(e)}},writeToPage:function(e,n){setTimeout(function(){var r=document.getElementById("postRobotLogs");r||(r=document.createElement("div"),r.id="postRobotLogs",r.style.cssText="width: 800px; font-family: monospace; white-space: pre-wrap;",document.body.appendChild(r));var t=document.createElement("div"),a=(new Date).toString().split(" ")[4],u=o.util.map(n,function(e){if("string"==typeof e)return e;if(!e)return Object.prototype.toString.call(e);var n=void 0;try{n=(0,i.jsonStringify)(e,0,2)}catch(r){n="[object]"}return"\n\n"+n+"\n\n"}).join(" "),s=a+" "+e+" "+u;t.innerHTML=s;var c={log:"#ddd",warn:"orange",error:"red",info:"blue",debug:"#aaa"}[e];t.style.cssText="margin-top: 10px; color: "+c+";",r.childNodes.length?r.insertBefore(t,r.childNodes[0]):r.appendChild(t)})},logLevel:function(e,n){try{if(u.indexOf(e)<u.indexOf(a.CONFIG.LOG_LEVEL))return;if(n=Array.prototype.slice.call(n),n.unshift(""+window.location.host+window.location.pathname),n.unshift("::"),n.unshift(""+(0,i.getWindowType)().toLowerCase()),n.unshift("[post-robot]"),a.CONFIG.LOG_TO_PAGE&&s.writeToPage(e,n),!window.console)return;if(window.console[e]||(e="log"),!window.console[e])return;window.console[e].apply(window.console,n)}catch(r){}},debug:function(){s.logLevel("debug",arguments)},info:function(){s.logLevel("info",arguments)},warn:function(){s.logLevel("warn",arguments)},error:function(){s.logLevel("error",arguments)}}},function(e,n,r){"use strict";function t(e){for(var n=C.global.domainMatches,r=Array.isArray(n),t=0,n=r?n:n[Symbol.iterator]();;){var o;if(r){if(t>=n.length)break;o=n[t++]}else{if(t=n.next(),t.done)break;o=t.value}var i=o;if(i.win===e)return i.match}var a=void 0;try{a=j.util.getDomain(window)===j.util.getDomain(e)}catch(u){a=!1}return C.global.clean.push(C.global.domainMatches,{win:e,match:a}),I||(I=setTimeout(function(){C.global.domainMatches=[],I=null},1)),a}function o(e){if(e)try{return e.opener}catch(n){return}}function i(e){if(e)try{if(e.parent&&e.parent!==e)return e.parent}catch(n){return}}function a(e){var n=[];try{for(;e.parent!==e;)n.push(e.parent),e=e.parent}catch(r){}return n}function u(e,n){if(!e||!n)return!1;var r=i(n);return r?r===e:-1!==a(n).indexOf(e)}function s(e){var n=[],r=void 0;try{r=e.frames}catch(t){r=e}var o=void 0;try{o=r.length}catch(t){}if(0===o)return n;if(o){for(var i=0;o>i;i++){var a=void 0;try{a=r[i]}catch(t){continue}n.push(a)}return n}for(var u=0;100>u;u++){var s=void 0;try{s=r[u]}catch(t){return n}if(!s)return n;n.push(s)}return n}function c(e){for(var n=[],r=s(e),t=Array.isArray(r),o=0,r=t?r:r[Symbol.iterator]();;){var i;if(t){if(o>=r.length)break;i=r[o++]}else{if(o=r.next(),o.done)break;i=o.value}var a=i;n.push(a);for(var u=c(a),d=Array.isArray(u),f=0,u=d?u:u[Symbol.iterator]();;){var l;if(d){if(f>=u.length)break;l=u[f++]}else{if(f=u.next(),f.done)break;l=f.value}var m=l;n.push(m)}}return n}function d(e){var n=c(e);n.push(e);for(var r=a(e),t=Array.isArray(r),o=0,r=t?r:r[Symbol.iterator]();;){var i;if(t){if(o>=r.length)break;i=r[o++]}else{if(o=r.next(),o.done)break;i=o.value}var u=i;n.push(u);for(var d=s(u),f=Array.isArray(d),l=0,d=f?d:d[Symbol.iterator]();;){var m;if(f){if(l>=d.length)break;m=d[l++]}else{if(l=d.next(),l.done)break;m=l.value}var w=m;-1===n.indexOf(w)&&n.push(w)}}return n}function f(e){if(e){try{if(e.top)return e.top}catch(n){}if(i(e)===e)return e;try{if(u(window,e))return window.top}catch(n){}try{if(u(e,window))return window.top}catch(n){}for(var r=c(e),t=Array.isArray(r),o=0,r=t?r:r[Symbol.iterator]();;){var a;if(t){if(o>=r.length)break;a=r[o++]}else{if(o=r.next(),o.done)break;a=o.value}var s=a;try{if(s.top)return s.top}catch(n){}if(i(s)===s)return s}}}function l(e){var n=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];if(e===window)return!1;try{if(!e)return!0}catch(r){return!0}try{if(e.closed)return!0}catch(r){return!r||"Call was rejected by callee.\r\n"!==r.message}return!!(n&&t(e)&&j.util.safeGet(e,"mockclosed"))}function m(e){return e=e||window,e.navigator.mockUserAgent||e.navigator.userAgent}function w(e,n){for(var r=s(e),o=r,i=Array.isArray(o),a=0,o=i?o:o[Symbol.iterator]();;){var u;if(i){if(a>=o.length)break;u=o[a++]}else{if(a=o.next(),a.done)break;u=a.value}var c=u;try{if(t(c)&&c.name===n&&-1!==r.indexOf(c))return c}catch(d){}}try{if(-1!==r.indexOf(e.frames[n]))return e.frames[n]}catch(d){}try{if(-1!==r.indexOf(e[n]))return e[n]}catch(d){}}function p(e,n){var r=w(e,n);if(r)return r;for(var t=s(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var u=a,c=p(u,n);if(c)return c}}function g(e,n){var r=void 0;return r=w(e,n),r?r:p(f(e),n)}function v(e,n){var r=i(n);if(r)return r===e;for(var t=s(e),o=Array.isArray(t),a=0,t=o?t:t[Symbol.iterator]();;){var u;if(o){if(a>=t.length)break;u=t[a++]}else{if(a=t.next(),a.done)break;u=a.value}var c=u;if(c===n)return!0}return!1}function h(e,n){return e===o(n)}function O(e){e=e||window;var n=o(e);if(n)return n;var r=i(e);return r?r:void 0}function S(e){for(var n=[],r=e;r;)r=O(r),r&&n.push(r);return n}function y(e,n){var r=O(n);if(r)return r===e;if(n===e)return!1;if(f(n)===n)return!1;for(var t=s(e),o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var u=a;if(u===n)return!0}return!1}function b(){return Boolean(o(window))}function E(){return Boolean(i(window))}function T(){return Boolean(!E()&&!b())}function _(){return b()?R.CONSTANTS.WINDOW_TYPES.POPUP:E()?R.CONSTANTS.WINDOW_TYPES.IFRAME:R.CONSTANTS.WINDOW_TYPES.FULLPAGE}function P(e,n){for(var r=e,t=Array.isArray(r),o=0,r=t?r:r[Symbol.iterator]();;){var i;if(t){if(o>=r.length)break;i=r[o++]}else{if(o=r.next(),o.done)break;i=o.value}for(var a=i,u=n,s=Array.isArray(u),c=0,u=s?u:u[Symbol.iterator]();;){var d;if(s){if(c>=u.length)break;d=u[c++]}else{if(c=u.next(),c.done)break;d=c.value}var f=d;if(a===f)return!0}}}function A(e,n){var r=f(e),t=f(n);try{if(r&&t)return r===t}catch(i){}var a=d(e),u=d(n);if(P(a,u))return!0;var s=o(r),c=o(t);return s&&P(d(s),u)?!1:c&&P(d(c),a)?!1:void 0}function N(){var e=void 0,n=void 0;try{if("{}"!==JSON.stringify({})&&(e=Object.prototype.toJSON,delete Object.prototype.toJSON),"{}"!==JSON.stringify({}))throw new Error("Can not correctly serialize JSON objects");if("[]"!==JSON.stringify([])&&(n=Array.prototype.toJSON,delete Array.prototype.toJSON),"[]"!==JSON.stringify([]))throw new Error("Can not correctly serialize JSON objects")}catch(r){throw new Error("Can not repair JSON.stringify: "+r.message)}var t=JSON.stringify.apply(this,arguments);try{e&&(Object.prototype.toJSON=e),n&&(Array.prototype.toJSON=n)}catch(r){throw new Error("Can not repair JSON.stringify: "+r.message)}return t}function M(){return JSON.parse.apply(this,arguments)}Object.defineProperty(n,"__esModule",{value:!0}),n.isSameDomain=t,n.getOpener=o,n.getParent=i,n.getParents=a,n.isAncestorParent=u,n.getFrames=s,n.getAllChildFrames=c,n.getAllFramesInWindow=d,n.getTop=f,n.isWindowClosed=l,n.getUserAgent=m,n.getFrameByName=w,n.findChildFrameByName=p,n.findFrameByName=g,n.isParent=v,n.isOpener=h,n.getAncestor=O,n.getAncestors=S,n.isAncestor=y,n.isPopup=b,n.isIframe=E,n.isFullpage=T,n.getWindowType=_,n.isSameTopWindow=A,n.jsonStringify=N,n.jsonParse=M;var j=r(12),C=r(15),R=r(3);C.global.domainMatches=C.global.domainMatches||[];var I=void 0},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.global=void 0;var t=r(3),o=r(16),i=n.global=window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT]=window[t.CONSTANTS.WINDOW_PROPS.POSTROBOT]||{};i.clean=i.clean||(0,o.cleanup)(i)},function(e,n,r){"use strict";function t(e){var n=[];return{getters:{array:function(){return[]},object:function(){return{}}},set:function(n,r){return e[n]=r,this.register(function(){delete e[n]}),r},push:function(e,n){return e.push(n),this.register(function(){var r=e.indexOf(n);-1!==r&&e.splice(r,1)}),n},setItem:function(e,n,r){return e[n]=r,this.register(function(){delete e[n]}),r},register:function(e,r){r||(r=e,e=void 0),n.push({complete:!1,name:e,run:function(){return this.complete?void 0:(this.complete=!0,r())}})},hasTasks:function(){return Boolean(n.filter(function(e){return!e.complete}).length)},all:function(){for(var e=[];n.length;)e.push(n.pop().run());return o.SyncPromise.all(e).then(function(){})},run:function(e){for(var r=[],t=[],i=n,a=Array.isArray(i),u=0,i=a?i:i[Symbol.iterator]();;){var s;if(a){if(u>=i.length)break;s=i[u++]}else{if(u=i.next(),u.done)break;s=u.value}var c=s;c.name===e&&(t.push(c),r.push(c.run()))}for(var d=t,f=Array.isArray(d),l=0,d=f?d:d[Symbol.iterator]();;){var m;if(f){if(l>=d.length)break;m=d[l++]}else{if(l=d.next(),l.done)break;m=l.value}var w=m;n.splice(n.indexOf(w),1)}return o.SyncPromise.all(r).then(function(){})}}}Object.defineProperty(n,"__esModule",{value:!0}),n.cleanup=t;var o=r(10)},function(e,n,r){"use strict";function t(e){return"object"===("undefined"==typeof e?"undefined":s(e))&&null!==e&&e.__type__===c.CONSTANTS.SERIALIZATION_TYPES.METHOD&&e.__id__}function o(e,n,r,t){var o=d.util.uniqueID();return w.global.clean.setItem(w.global.methods,o,{destination:e,domain:n,method:r}),{__type__:c.CONSTANTS.SERIALIZATION_TYPES.METHOD,__id__:o,__name__:t}}function i(e,n,r){return d.util.replaceObject({obj:r},function(r,t){return"function"==typeof r?o(e,n,r,t):void 0}).obj}function a(e,n,r){function t(){var t=Array.prototype.slice.call(arguments);return l.log.debug("Call foreign method",r.__name__,t),(0,f.send)(e,c.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{id:r.__id__,name:r.__name__,args:t},{domain:n}).then(function(e){var n=e.data;return l.log.debug("Got foreign method result",r.__name__,n.result),n.result})}return t.__name__=r.__name__,t.source=e,t.origin=n,t}function u(e,n,r){return d.util.replaceObject({obj:r},function(r,o){return t(r)?a(e,n,r):void 0}).obj}Object.defineProperty(n,"__esModule",{value:!0}),n.listenForMethods=void 0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};n.serializeMethod=o,n.serializeMethods=i,n.deserializeMethod=a,n.deserializeMethods=u;var c=r(3),d=r(12),f=r(1),l=r(13),m=r(9),w=r(15);w.global.methods=w.global.methods||{};n.listenForMethods=d.util.once(function(){(0,f.on)(c.CONSTANTS.POST_MESSAGE_NAMES.METHOD,{window:"*",origin:"*"},function(e){var n=e.source,r=e.origin,t=e.data,o=w.global.methods[t.id];if(!o)throw new Error("Could not find method with id: "+t.id);if(o.destination!==n)throw new Error("Method window does not match");if(o.domain&&"*"!==o.domain&&r!==o.domain)throw new Error("Method domain "+o.domain+" does not match origin "+r);return l.log.debug("Call local method",t.name,t.args),m.promise.run(function(){return o.method.apply({source:n,origin:r,data:t},t.args)}).then(function(e){return{result:e,id:t.id,name:t.name}})})})},function(e,n,r){"use strict";function t(){(0,u.on)(i.CONSTANTS.POST_MESSAGE_NAMES.READY,{window:"*",domain:"*"},function(e){for(var n=d.global.readyPromises,r=Array.isArray(n),t=0,n=r?n:n[Symbol.iterator]();;){var o;if(r){if(t>=n.length)break;o=n[t++]}else{if(t=n.next(),t.done)break;o=t.value}var i=o;if(i.win===e.source)return void i.promise.resolve(e)}d.global.clean.push(d.global.readyPromises,{win:e.source,promise:(new c.SyncPromise).resolve(e)})});var e=(0,a.getAncestor)();e&&(0,u.send)(e,i.CONSTANTS.POST_MESSAGE_NAMES.READY,{},{domain:"*"})["catch"](function(e){s.log.debug(e.stack||e.toString())})}function o(e){for(var n=arguments.length<=1||void 0===arguments[1]?5e3:arguments[1],r=arguments.length<=2||void 0===arguments[2]?"Window":arguments[2],t=d.global.readyPromises,o=Array.isArray(t),i=0,t=o?t:t[Symbol.iterator]();;){var a;if(o){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var u=a;if(u.win===e)return u.promise}var s=new c.SyncPromise;return d.global.clean.push(d.global.readyPromises,{win:e,promise:s}),setTimeout(function(){return s.reject(new Error(r+" did not load after "+n+"ms"))},n),s}Object.defineProperty(n,"__esModule",{value:!0}),n.initOnReady=t,n.onWindowReady=o;var i=r(3),a=r(14),u=r(1),s=r(13),c=r(10),d=r(15);d.global.readyPromises=d.global.readyPromises||[]},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(20);Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})})},function(e,n,r){"use strict";function t(e,n){if(!o.CONFIG.ALLOW_POSTMESSAGE_POPUP&&(0,i.isSameTopWindow)(e,n)===!1)throw new Error("Can not send and receive post messages between two different windows (disabled to emulate IE)")}Object.defineProperty(n,"__esModule",{value:!0}),n.emulateIERestrictions=t;var o=r(3),i=r(8)},function(e,n,r){"use strict";function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){return"string"==typeof e?"*"===e||n===e:"[object RegExp]"===Object.prototype.toString.call(e)?n.match(e):Array.isArray(e)?-1!==e.indexOf(n):!1;
}Object.defineProperty(n,"__esModule",{value:!0}),n.RECEIVE_MESSAGE_TYPES=void 0;var i,a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},u=r(3),s=r(8),c=r(22),d=r(29);n.RECEIVE_MESSAGE_TYPES=(i={},t(i,u.CONSTANTS.POST_MESSAGE_TYPE.ACK,function(e,n,r){var t=d.listeners.response[r.hash];if(!t)throw new Error("No handler found for post message ack for message: "+r.name+" from "+n+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!o(t.domain,n))throw new Error("Ack origin "+n+" does not match domain "+t.domain);t.ack=!0}),t(i,u.CONSTANTS.POST_MESSAGE_TYPE.REQUEST,function(e,n,r){function t(t){return r.fireAndForget||(0,s.isWindowClosed)(e)?s.promise.Promise.resolve():(0,c.sendMessage)(e,a({target:r.originalSource,hash:r.hash,name:r.name},t),n)}var i=(0,d.getRequestListener)(r.name,e,n);return s.promise.Promise.all([t({type:u.CONSTANTS.POST_MESSAGE_TYPE.ACK}),s.promise.run(function(){if(!i)throw new Error("No handler found for post message: "+r.name+" from "+n+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!o(i.domain,n))throw new Error("Request origin "+n+" does not match domain "+i.domain);var t=r.data;return s.promise.deNodeify(i.handler,{source:e,origin:n,data:t})}).then(function(e){return t({type:u.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:u.CONSTANTS.POST_MESSAGE_ACK.SUCCESS,data:e})},function(e){return t({type:u.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,ack:u.CONSTANTS.POST_MESSAGE_ACK.ERROR,error:e.stack?e.message+"\n"+e.stack:e.toString()})})])["catch"](function(e){return i&&i.handleError?i.handleError(e):void s.log.error(e.stack||e.toString())})}),t(i,u.CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,function(e,n,r){var t=d.listeners.response[r.hash];if(!t)throw new Error("No handler found for post message response for message: "+r.name+" from "+n+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!o(t.domain,n))throw new Error("Response origin "+n+" does not match domain "+t.domain);if(delete d.listeners.response[r.hash],r.ack===u.CONSTANTS.POST_MESSAGE_ACK.ERROR)return t.respond(new Error(r.error));if(r.ack===u.CONSTANTS.POST_MESSAGE_ACK.SUCCESS){var i=r.data||r.response;return t.respond(null,{source:e,origin:n,data:i})}}),i)},function(e,n,r){"use strict";function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],t=s.util.uniqueID(),o=(0,s.getWindowType)(),i=s.util.getDomain(window);return a({},n,r,{sourceDomain:i,id:n.id||t,windowType:o})}function i(e,n,r){return s.promise.run(function(){n=o(e,n,{data:(0,s.serializeMethods)(e,r,n.data),domain:r});var i=void 0;if(i=-1!==u.POST_MESSAGE_NAMES_LIST.indexOf(n.name)||n.type===u.CONSTANTS.POST_MESSAGE_TYPE.ACK?"debug":"error"===n.ack?"error":"info",s.log.logLevel(i,["\n\n	","#send",n.type.replace(/^postrobot_message_/,""),"::",n.name,"::",r||"*","\n\n",n]),u.CONFIG.MOCK_MODE)return delete n.target,window[u.CONSTANTS.WINDOW_PROPS.POSTROBOT].postMessage({origin:s.util.getDomain(window),source:window,data:(0,s.jsonStringify)(n,0,2)});if(e===window)throw new Error("Attemping to send message to self");if((0,s.isWindowClosed)(e))throw new Error("Window is closed");s.log.debug("Running send message strategies",n);var a=[],d=(0,s.jsonStringify)(t({},u.CONSTANTS.WINDOW_PROPS.POSTROBOT,n),0,2);return s.promise.map(Object.keys(c.SEND_MESSAGE_STRATEGIES),function(n){return s.promise.run(function(){if(!u.CONFIG.ALLOWED_POST_MESSAGE_METHODS[n])throw new Error("Strategy disallowed: "+n);return c.SEND_MESSAGE_STRATEGIES[n](e,d,r)}).then(function(){return a.push(n+": success"),!0},function(e){return a.push(n+": "+(e.stack||e.toString())+"\n"),!1})}).then(function(e){var r=s.util.some(e),t=n.type+" "+n.name+" "+(r?"success":"error")+":\n  - "+a.join("\n  - ")+"\n";if(s.log.debug(t),!r)throw new Error(t)})})}Object.defineProperty(n,"__esModule",{value:!0});var a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e};n.buildMessage=o,n.sendMessage=i;var u=r(3),s=r(8),c=r(23)},function(e,n,r){"use strict";function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}Object.defineProperty(n,"__esModule",{value:!0}),n.SEND_MESSAGE_STRATEGIES=void 0;var o,i=r(3),a=r(8),u=r(19),s=r(24);n.SEND_MESSAGE_STRATEGIES=(o={},t(o,i.CONSTANTS.SEND_STRATEGIES.POST_MESSAGE,function(e,n,r){return(0,u.emulateIERestrictions)(window,e),r&&0===r.indexOf(i.CONSTANTS.MOCK_PROTOCOL)&&(r=e.location.protocol+"//"+e.location.host),r&&0===r.indexOf(i.CONSTANTS.FILE_PROTOCOL)&&(r="*"),e.postMessage(n,r)}),t(o,i.CONSTANTS.SEND_STRATEGIES.BRIDGE,function(e,n,r){if((0,a.isSameDomain)(e))throw new Error("Post message through bridge disabled between same domain windows");if((0,a.isSameTopWindow)(window,e)!==!1)throw new Error("Can only use bridge to communicate between two different windows, not between frames");return(0,s.sendBridgeMessage)(e,n,r)}),t(o,i.CONSTANTS.SEND_STRATEGIES.GLOBAL,function(e,n,r){if(!(0,a.isSameDomain)(e))throw new Error("Post message through global disabled between different domain windows");if((0,a.isSameTopWindow)(window,e)!==!1)throw new Error("Can only use global to communicate between two different windows, not between frames");var t=e[i.CONSTANTS.WINDOW_PROPS.POSTROBOT];if(!t)throw new Error("Can not find postRobot global on foreign window");return t.receiveMessage({source:window,origin:r,data:n})}),o)},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(25);Object.keys(t).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return t[e]}})});var o=r(26);Object.keys(o).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(27);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}})});var a=r(28);Object.keys(a).forEach(function(e){"default"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,n,r){"use strict";var t=r(3),o=r(8),i=r(15),a=r(1);i.global.openTunnelToParent=function(e){var n=e.name,r=e.source,i=e.canary,u=e.sendMessage,s=(0,o.getParent)(window);if(!s)throw new Error("No parent window found to open tunnel to");return(0,a.send)(s,t.CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL,{name:n,sendMessage:function(){if(!(0,o.isWindowClosed)(r)){try{i()}catch(e){return}u.apply(this,arguments)}}},{domain:"*"})}},function(e,n,r){"use strict";function t(e){return a.SyncPromise["try"](function(){for(var n=(0,s.getFrames)(e),r=Array.isArray(n),t=0,n=r?n:n[Symbol.iterator]();;){var o;if(r){if(t>=n.length)break;o=n[t++]}else{if(t=n.next(),t.done)break;o=t.value}var c=o;try{if(c&&c!==window&&(0,s.isSameDomain)(c)&&c[u.CONSTANTS.WINDOW_PROPS.POSTROBOT])return c}catch(f){continue}}try{var l=function(){var n=(0,s.getFrameByName)(e,(0,d.getBridgeName)(s.util.getDomain()));return n?(0,s.isSameDomain)(n)&&n[u.CONSTANTS.WINDOW_PROPS.POSTROBOT]?{v:n}:{v:new a.SyncPromise(function(e){var r=void 0,t=void 0;r=setInterval(function(){return(0,s.isSameDomain)(n)&&n[u.CONSTANTS.WINDOW_PROPS.POSTROBOT]?(clearInterval(r),clearTimeout(t),e(n)):void setTimeout(function(){return clearInterval(r),e()},2e3)},100)})}:{v:void 0}}();if("object"===("undefined"==typeof l?"undefined":i(l)))return l.v}catch(f){return}})}function o(){return a.SyncPromise["try"](function(){var e=(0,s.getOpener)(window);if(e&&(0,d.needsBridge)({win:e}))return(0,d.registerRemoteWindow)(e),t(e).then(function(n){return n?window.name?n[u.CONSTANTS.WINDOW_PROPS.POSTROBOT].openTunnelToParent({name:window.name,source:window,canary:function(){},sendMessage:function(e){window&&!window.closed&&(0,c.receiveMessage)({data:e,origin:this.origin,source:this.source})}}).then(function(n){var r=n.source,t=n.origin,o=n.data;if(r!==e)throw new Error("Source does not match opener");(0,d.registerRemoteSendMessage)(r,t,o.sendMessage)})["catch"](function(n){throw(0,d.rejectRemoteSendMessage)(e,n),n}):(0,d.rejectRemoteSendMessage)(e,new Error("Can not register with opener: window does not have a name")):(0,d.rejectRemoteSendMessage)(e,new Error("Can not register with opener: no bridge found in opener"))})})}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};n.openTunnelToOpener=o;var a=r(10),u=r(3),s=r(8),c=r(6),d=r(27)},function(e,n,r){"use strict";function t(){return(0,p.getUserAgent)(window).match(/MSIE|trident|edge/i)?!0:!w.CONFIG.ALLOW_POSTMESSAGE_POPUP}function o(e){return e&&(0,p.isSameTopWindow)(window,e)?!1:!e||!(0,p.isSameDomain)(e)}function i(e){return!e||p.util.getDomain()!==p.util.getDomainFromUrl(e)}function a(e){var n=e.win,r=e.domain;return t()&&o(n)&&i(r)}function u(e){e=e||p.util.getDomainFromUrl(e);var n=e.replace(/[^a-zA-Z0-9]+/g,"_"),r=w.CONSTANTS.BRIDGE_NAME_PREFIX+"_"+n;return r}function s(){return window.name&&window.name===u(p.util.getDomain())}function c(e){var n=(arguments.length<=1||void 0===arguments[1]?w.CONFIG.BRIDGE_TIMEOUT:arguments[1],new p.promise.Promise);g.global.clean.push(g.global.remoteWindows,{win:e,sendMessagePromise:n})}function d(e){for(var n=0;n<g.global.remoteWindows.length;n++)if(g.global.remoteWindows[n].win===e)return g.global.remoteWindows[n]}function f(e,n,r){var t=d(e);if(!t)throw new Error("Window not found to register sendMessage to");var o=function(t,o,i){if(t!==e)throw new Error("Remote window does not match window");if("*"!==i&&i!==n)throw new Error("Remote domain "+i+" does not match domain "+n);r(o)};t.sendMessagePromise.resolve(o),t.sendMessagePromise=p.promise.Promise.resolve(o)}function l(e,n){var r=d(e);if(!r)throw new Error("Window not found on which to reject sendMessage");return r.sendMessagePromise.asyncReject(n)}function m(e,n,r){var t=(0,p.isOpener)(window,e),o=(0,p.isOpener)(e,window);if(!t&&!o)throw new Error("Can only send messages to and from parent and popup windows");var i=d(e);if(!i)throw new Error("Window not found to send message to");return i.sendMessagePromise.then(function(t){return t(e,n,r)})}Object.defineProperty(n,"__esModule",{value:!0}),n.documentBodyReady=void 0,n.needsBridgeForBrowser=t,n.needsBridgeForWin=o,n.needsBridgeForDomain=i,n.needsBridge=a,n.getBridgeName=u,n.isBridge=s,n.registerRemoteWindow=c,n.findRemoteWindow=d,n.registerRemoteSendMessage=f,n.rejectRemoteSendMessage=l,n.sendBridgeMessage=m;var w=r(3),p=r(8),g=r(15),v=r(6);n.documentBodyReady=new p.promise.Promise(function(e){if(window.document&&window.document.body)return e(window.document.body);var n=setInterval(function(){return window.document&&window.document.body?(clearInterval(n),e(window.document.body)):void 0},10)});g.global.remoteWindows=g.global.remoteWindows||[],g.global.receiveMessage=function(e){return(0,v.receiveMessage)(e)}},function(e,n,r){"use strict";function t(e,n){(0,l.on)(c.CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL,{source:e,domain:n},function(e){var r=e.origin,t=e.data;if(r!==n)throw new Error("Domain "+n+" does not match origin "+r);if(!t.name)throw new Error("Register window expected to be passed window name");if(!t.sendMessage)throw new Error("Register window expected to be passed sendMessage method");var o=f.global.popupWindows[t.name];if(!o)throw new Error("Window with name "+t.name+" does not exist, or was not opened by this window");if(!o.domain)throw new Error("We do not have a registered domain for window "+t.name);if(o.domain!==r)throw new Error("Message origin "+r+" does not matched registered window origin "+o.domain);return(0,w.registerRemoteSendMessage)(o.win,n,t.sendMessage),{sendMessage:function(e){window&&!window.closed&&(0,m.receiveMessage)({data:e,origin:o.domain,source:o.win})}}})}function o(e,n){d.log.debug("Opening bridge:",e,n);var r=document.createElement("iframe");return r.setAttribute("name",e),r.setAttribute("id",e),r.setAttribute("style","display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;"),r.setAttribute("frameborder","0"),r.setAttribute("border","0"),r.setAttribute("scrolling","no"),r.setAttribute("allowTransparency","true"),r.setAttribute("tabindex","-1"),r.setAttribute("hidden","true"),r.setAttribute("title",""),r.setAttribute("role","presentation"),r.src=n,r}function i(e,n){return n=n||d.util.getDomainFromUrl(e),f.global.bridges[n]?f.global.bridges[n]:f.global.clean.setItem(f.global.bridges,n,d.promise.run(function(){if(d.util.getDomain()===n)throw new Error("Can not open bridge on the same domain as current domain: "+n);var r=(0,w.getBridgeName)(n),i=(0,d.getFrameByName)(window,r);if(i)throw new Error("Frame with name "+r+" already exists on page");var a=o(r,e);return w.documentBodyReady.then(function(r){return new d.promise.Promise(function(e,n){setTimeout(e,1)}).then(function(){r.appendChild(a),f.global.clean.register("bridgeFrames",function(){r.removeChild(a),delete f.global.bridges[n]});var o=a.contentWindow;return t(o,n),new d.promise.Promise(function(e,n){a.onload=e,a.onerror=n}).then(function(){return(0,d.onWindowReady)(o,c.CONFIG.BRIDGE_TIMEOUT,"Bridge "+e)}).then(function(){return o})})})}))}function a(){return f.global.clean.run("bridgeFrames")}function u(e,n){for(var r=Object.keys(f.global.popupWindows),t=Array.isArray(r),o=0,r=t?r:r[Symbol.iterator]();;){var i;if(t){if(o>=r.length)break;i=r[o++]}else{if(o=r.next(),o.done)break;i=o.value}var a=i,u=f.global.popupWindows[a];if(u.win===e){u.domain=d.util.getDomainFromUrl(n),(0,w.registerRemoteWindow)(e);break}}}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,n){var r=[],t=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(t=(a=u.next()).done)&&(r.push(a.value),!n||r.length!==n);t=!0);}catch(s){o=!0,i=s}finally{try{!t&&u["return"]&&u["return"]()}finally{if(o)throw i}}return r}return function(n,r){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.openBridge=i,n.destroyBridges=a,n.linkUrl=u;var c=r(3),d=r(8),f=r(15),l=r(1),m=r(6),w=r(27);f.global.bridges=f.global.bridges||{},f.global.popupWindows=f.global.popupWindows||{};var p=window.open;window.open=function(e,n,r,t){var o=e;if(e&&0===e.indexOf(c.CONSTANTS.MOCK_PROTOCOL)){var i=e.split("|"),a=s(i,2);o=a[0],e=a[1]}o&&(o=d.util.getDomainFromUrl(o));var u=p.call(this,e,n,r,t);return e&&(0,w.registerRemoteWindow)(u),n&&f.global.clean.setItem(f.global.popupWindows,n,{win:u,domain:o}),u}},function(e,n,r){"use strict";function t(){c.global.listeners.request=[],c.global.listeners.response=[]}function o(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function i(e,n){return"string"==typeof e?o(n)?!1:Array.isArray(n)?!1:"*"===e||n===e:o(e)?o(n)?e.toString()===n.toString():Array.isArray(n)?!1:n.match(e):Array.isArray(e)?o(n)?!1:Array.isArray(n)?JSON.stringify(e)===JSON.stringify(n):-1!==e.indexOf(n):!1}function a(e,n,r){for(var t={},o=c.global.listeners.request,a=Array.isArray(o),u=0,o=a?o:o[Symbol.iterator]();;){var s;if(a){if(u>=o.length)break;s=o[u++]}else{if(u=o.next(),u.done)break;s=u.value}var d=s;if(d.name===e){var f=d.win&&"*"!==d.win,l=d.domain&&"*"!==d.domain,m=f&&d.win===n,w=l&&i(d.domain,r);f&&l?m&&w&&(t.all=t.all||d.options):l?w&&(t.domain=t.domain||d.options):f?m&&(t.win=t.win||d.options):t.name=t.name||d.options}}return t.all||t.domain||t.win||t.name}function u(e){for(var n=c.global.listeners.request,r=Array.isArray(n),t=0,n=r?n:n[Symbol.iterator]();;){var o;if(r){if(t>=n.length)break;o=n[t++]}else{if(t=n.next(),t.done)break;o=t.value}var i=o;i.options===e&&c.global.listeners.request.splice(c.global.listeners.request.indexOf(i),1)}}function s(e,n,r,t,o){var i=a(e,n,r);if(i){if(!o){if(n)throw new Error("Request listener already exists for "+e+" on domain "+r+" for specified window: "+(i.win===n));throw new Error("Request listener already exists for "+e+" on domain "+r)}u(i)}c.global.clean.push(c.global.listeners.request,{name:e,win:n,domain:r,options:t})}Object.defineProperty(n,"__esModule",{value:!0}),n.listeners=void 0,n.resetListeners=t,n.getRequestListener=a,n.removeRequestListener=u,n.addRequestListener=s;var c=r(15);c.global.listeners=c.global.listeners||{request:[],response:[]};n.listeners=c.global.listeners},function(e,n,r){"use strict";function t(e){if(!e.name)throw new Error("Expected options.name");e.handler=e.handler||s.util.noop,e.errorHandler=e.errorHandler||function(e){throw e},e.once&&!function(){var n=e.handler;e.handler=s.util.once(function(){return(0,c.removeRequestListener)(e),n.apply(this,arguments)})}();var n=e.override||u.CONFIG.MOCK_MODE;return e.source&&(e.window=e.source),e.domain=e.domain||"*",(0,c.addRequestListener)(e.name,e.window,e.domain,e,n),e.handleError=function(n){e.errorHandler(n)},e.window&&e.errorOnClose&&!function(){var n=s.util.safeInterval(function(){(0,s.isWindowClosed)(e.window)&&(n.cancel(),e.handleError(new Error("Post message target window is closed")))},50)}(),{cancel:function(){(0,c.removeRequestListener)(e)}}}function o(e,n,r,o){return"function"==typeof n&&(o=r,r=n,n={}),n=n||{},n.name=e,n.handler=r||n.handler,n.errorHandler=o||n.errorHandler,t(n)}function i(e,n,r,o){"function"==typeof n&&(o=r,r=n,n={}),n=n||{},n.name=e,n.handler=r||n.handler,n.errorHandler=o||n.errorHandler,n.once=!0;var i=new s.promise.Promise(function(e,r){n.handler=n.handler||function(n){return e(n)},n.errorHandler=n.errorHandler||r}),a=t(n);return s.util.extend(i,a),i}function a(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{on:function(n,r,t){return o(n,e,r,t)}}}Object.defineProperty(n,"__esModule",{value:!0}),n.on=void 0,n.listen=t,n.once=i,n.listener=a;var u=r(3),s=r(8),c=r(6);n.on=o},function(e,n,r){"use strict";function t(){a.CONFIG.MOCK_MODE=!0}function o(){a.CONFIG.MOCK_MODE=!1}function i(){delete window[a.CONSTANTS.WINDOW_PROPS.POSTROBOT],window.removeEventListener("message",u.messageListener)}Object.defineProperty(n,"__esModule",{value:!0}),n.CONSTANTS=n.CONFIG=void 0,n.enableMockMode=t,n.disableMockMode=o;var a=r(3);Object.defineProperty(n,"CONFIG",{enumerable:!0,get:function(){return a.CONFIG}}),Object.defineProperty(n,"CONSTANTS",{enumerable:!0,get:function(){return a.CONSTANTS}}),n.disable=i;var u=r(6)}])});